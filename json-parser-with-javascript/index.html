<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://twitter.com/lihautan" rel="me" />
		<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#bd93f9" />
		<link rel="apple-touch-icon" sizes="48x48" href="/icon-48x48.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="/icon-256x256.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />
		<link rel="icon" href="/icon-48x48.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="preload"
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&family=Noto+Sans+SC:wght@500&display=swap" as="style"
			onload="this.rel='stylesheet'">
		<link rel="alternate" type="application/rss+xml" title="Tan Li Hau&#x27;s RSS Feed" href="/rss.xml"/>
		<link rel="sitemap" type="application/xml" href="/sitemap.xml"/>
		<link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
		<link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6Y89Q69VY"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-Z6Y89Q69VY');
		</script>
		<meta http-equiv="content-security-policy" content=""><title>JSON Parser with JavaScript | Tan Li Hau</title><meta name="description" content="Step-by-step guide on implementing a JSON parser" data-svelte="svelte-1jsbgzp"><meta name="image" content="https://lihautan.com/_app/assets/hero-twitter-57f7bb48.jpg" data-svelte="svelte-1jsbgzp"><meta name="og:image" content="https://lihautan.com/_app/assets/hero-twitter-57f7bb48.jpg" data-svelte="svelte-1jsbgzp"><meta name="og:title" content="JSON Parser with JavaScript" data-svelte="svelte-1jsbgzp"><meta name="og:description" content="Step-by-step guide on implementing a JSON parser" data-svelte="svelte-1jsbgzp"><meta name="og:type" content="website" data-svelte="svelte-1jsbgzp"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-1jsbgzp"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-1jsbgzp"><meta name="twitter:title" content="JSON Parser with JavaScript" data-svelte="svelte-1jsbgzp"><meta name="twitter:description" content="Step-by-step guide on implementing a JSON parser" data-svelte="svelte-1jsbgzp"><meta name="twitter:image" content="https://lihautan.com/_app/assets/hero-twitter-57f7bb48.jpg" data-svelte="svelte-1jsbgzp"><meta name="keywords" content="JavaScript" data-svelte="svelte-1jsbgzp"><meta name="keywords" content="AST" data-svelte="svelte-1jsbgzp"><meta itemprop="url" content="https://lihautan.com/json-parser-with-javascript/" data-svelte="svelte-1jsbgzp"><meta itemprop="image" content="https://lihautan.com/_app/assets/hero-twitter-57f7bb48.jpg" data-svelte="svelte-1jsbgzp"><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightYear":"2022","creator":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"publisher":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"description":"Step-by-step guide on implementing a JSON parser","headline":"JSON Parser with JavaScript","name":"JSON Parser with JavaScript","inLanguage":"en"}</script><!-- HTML_TAG_END --><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https://lihautan.com/json-parser-with-javascript/","name":"JSON Parser with JavaScript"},"name":"JSON Parser with JavaScript","position":2}]}</script><!-- HTML_TAG_END -->
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/vendor-cb7fd1e3.css">
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/pages/__layout.svelte-b5830581.css">
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/Links-79a96fb3.css">
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/code-snippet-c7c00025.css">
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/BlogLayout-115058b0.css">
	<link rel="stylesheet" href="https://lihautan.com/_app/assets/ldjson-f7523d2e.css">
	<link rel="modulepreload" href="https://lihautan.com/_app/start-c7a2dfb9.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/chunks/vendor-da4388d4.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/pages/__layout.svelte-c3db4d7b.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/chunks/stores-1fad7c36.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/chunks/Links-79c47f65.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/pages/json-parser-with-javascript/index.md-d5f85f35.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/chunks/BlogLayout-14cfab6f.js">
	<link rel="modulepreload" href="https://lihautan.com/_app/chunks/ldjson-b0805387.js">
	</head>
	<body>
		<div id="svelte">




<a href="#content" class="skip svelte-1x8iuzz">Skip to content</a>

	<header class="svelte-1x8iuzz"><nav><ul class="mode-sidebar svelte-2qf5mw"><li class="svelte-2qf5mw"><a href="/" class="svelte-2qf5mw">Tan Li Hau</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/about" class="svelte-2qf5mw">About</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/blogs" class="svelte-2qf5mw">Writings</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/talks" class="svelte-2qf5mw">Talks</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/notes" class="svelte-2qf5mw">Notes</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/newsletter" class="svelte-2qf5mw">Newsletter</a></li>
	<li class="social svelte-2qf5mw"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
  10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
  4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
		<a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
  0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
  5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
  5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
  3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
		<a aria-label="YouTube account" href="https://youtube.com/c/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 461.001 461.001" width="1em" height="1em" class="svelte-2qf5mw"><path d="M365.257 67.393H95.744C42.866 67.393 0 110.259 0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878 0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zm-64.751 169.663-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881c3.748 1.899 3.683 7.274-.109 9.082z"></path></svg></a></li>
</ul></nav></header>

	<div class="sidebar svelte-s9hlkv"><div class="float svelte-s9hlkv"><svg viewBox="0 0 30 50" width="30" height="50"><circle fill="currentColor" cy="15" cx="15" r="3"></circle><circle fill="currentColor" cy="25" cx="15" r="3"></circle><circle fill="currentColor" cy="35" cx="15" r="3"></circle></svg></div>
</div>

<main id="content" class="svelte-1x8iuzz">

<h1>JSON Parser with JavaScript</h1>

<div class="date svelte-13b38er">December 12, 2019</div>

<a class="tag series svelte-13b38er" href="/series/AST/">Series: AST</a>

<a class="tag svelte-13b38er" href="/tags/JavaScript/">JavaScript</a><a class="tag svelte-13b38er" href="/tags/AST/">AST</a>

<section role="navigation" aria-label="Table of Contents" class="svelte-zmasws"><ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#understand-the-grammar" class="svelte-zmasws">Understand the grammar</a>
				
			</li><li class="svelte-zmasws"><a href="#implementing-the-parser" class="svelte-zmasws">Implementing the parser</a>
				
			</li><li class="svelte-zmasws"><a href="#handling-the-unexpected-input" class="svelte-zmasws">Handling the unexpected input</a>
				<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#unexpected-token" class="svelte-zmasws">Unexpected token</a>
								
							</li><li class="svelte-zmasws"><a href="#unexpected-end-of-string" class="svelte-zmasws">Unexpected end of string</a>
								
							</li>
					</ol>
			</li><li class="svelte-zmasws"><a href="#going-the-extra-mile" class="svelte-zmasws">Going the extra mile</a>
				<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#error-code-and-standard-error-message" class="svelte-zmasws">Error code and standard error message</a>
								
							</li><li class="svelte-zmasws"><a href="#a-better-view-of-what-went-wrong" class="svelte-zmasws">A better view of what went wrong</a>
								
							</li><li class="svelte-zmasws"><a href="#suggestions-for-error-recovery" class="svelte-zmasws">Suggestions for error recovery</a>
								
							</li>
					</ol>
			</li><li class="svelte-zmasws"><a href="#summary" class="svelte-zmasws">Summary</a>
				
			</li></ol>
</section>

<article class="blog"><p>The interview question of the week for this week on Cassidoo&#39;s weekly newsletter is,</p>
<blockquote><p>Write a function that takes in a string of valid JSON and converts it to an object (or whatever your chosen language uses, dicts, maps, etc).
Example input:</p></blockquote>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-"><code><span class="line">fakeParseJSON(&#39;&#123; &quot;data&quot;: &#123; &quot;fish&quot;: &quot;cake&quot;, &quot;array&quot;: [1,2,3], &quot;children&quot;: [ &#123; &quot;something&quot;: &quot;else&quot; &#125;, &#123; &quot;candy&quot;: &quot;cane&quot; &#125;, &#123; &quot;sponge&quot;: &quot;bob&quot; &#125; ] &#125; &#125; &#39;)</span></code></pre><!-- HTML_TAG_END --></div>
<p>At one point, I was tempted to just to write:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">fakeParseJSON</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">JSON</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-function)">parse</span><span style="color: var(--shiki-color-text)">;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>But, I thought, I&#39;ve written quite a few articles about AST:</p>
<ul><li><a href="/creating-custom-javascript-syntax-with-babel">Creating custom JavaScript syntax with Babel</a></li>
<li><a href="/step-by-step-guide-for-writing-a-babel-transformation">Step-by-step guide for writing a custom babel transformation</a></li>
<li><a href="/manipulating-ast-with-javascript">Manipulating AST with JavaScript</a></li></ul>
<p>which covers the overview of the compiler pipeline, as well as how to manipulate AST, but I haven&#39;t covered much on how to implement a parser.</p>
<p>That&#39;s because, implementing a JavaScript compiler in an article is a task too daunting for me.</p>
<p>Well, fret not. JSON is also a language. It has its own grammar, which you can refer from <a href="https://www.json.org/json-en.html" rel="nofollow">the specifications</a>. The knowledge and technique you need to write a JSON parser is transferrable to writing a JS parser.</p>
<p>So, let&#39;s start writing a JSON parser!</p>
<section><h2><a href="#understand-the-grammar" id="understand-the-grammar">Understand the grammar</a></h2>
<p>If you look at <a href="https://www.json.org/json-en.html" rel="nofollow">the specification page</a>, there&#39;s 2 diagrams:</p>
<ul><li><a href="https://en.wikipedia.org/wiki/Syntax_diagram" rel="nofollow">The syntax diagram (or railroad diagram)</a> on the left,</li></ul>
<p><img src="https://www.json.org/img/object.png" alt="https://www.json.org/img/object.png"></p>
<small>Image source: https://www.json.org/img/object.png</small>
<ul><li><a href="https://www.crockford.com/mckeeman.html" rel="nofollow">The McKeeman Form</a>, a variant of <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form" rel="nofollow">Backus-Naur Form (BNF)</a>, on the right</li></ul>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-"><code><span class="line">json</span>
<span class="line">  element</span>
<span class="line"></span>
<span class="line">value</span>
<span class="line">  object</span>
<span class="line">  array</span>
<span class="line">  string</span>
<span class="line">  number</span>
<span class="line">  &quot;true&quot;</span>
<span class="line">  &quot;false&quot;</span>
<span class="line">  &quot;null&quot;</span>
<span class="line"></span>
<span class="line">object</span>
<span class="line">  &#39;&#123;&#39; ws &#39;&#125;&#39;</span>
<span class="line">  &#39;&#123;&#39; members &#39;&#125;&#39;</span></code></pre><!-- HTML_TAG_END --></div>
<p>Both diagrams are equivalent.</p>
<p>One is visual and one is text based. The text based grammar syntax, Backus-Naur Form, is usually fed to another parser that parse this grammar and generate a parser for it. Speaking of parser-ception! ðŸ¤¯</p>
<p>In this article, we will focus on the railroad diagram, because it is visual and seemed to be more friendly to me.</p>
<p>Lets&#39; look at the first railroad diagram:</p>
<p><img src="https://www.json.org/img/object.png" alt="https://www.json.org/img/object.png"></p>
<small>Image source: https://www.json.org/img/object.png</small>
<p>So this is the grammar for <strong>&quot;object&quot;</strong> in JSON.</p>
<p>We start from the left, following the arrow, and then we end at the right.</p>
<p>The circles, eg <code class="inline">{</code>, <code class="inline">,</code>, <code class="inline">:</code>, <code class="inline">}</code>, are the characters, and the boxes eg: <code class="inline">whitespace</code>, <code class="inline">string</code>, and <code class="inline">value</code> is a placeholder for another grammar. So to parse the &quot;whitespace&quot;, we will need to look at the grammar for <strong>&quot;whitepsace&quot;</strong>.</p>
<p>So, starting from the left, for an object, the first character has to be an open curly bracket, <code class="inline">{</code>. and then we have 2 options from here:</p>
<ul><li><code class="inline">whitespace</code> â†’ <code class="inline">}</code> â†’ end, or</li>
<li><code class="inline">whitespace</code> â†’ <code class="inline">string</code> â†’ <code class="inline">whitespace</code> â†’ <code class="inline">:</code> â†’ <code class="inline">value</code> â†’ <code class="inline">}</code> â†’ end</li></ul>
<p>Of course, when you reach &quot;value&quot;, you can choose to go to:</p>
<ul><li>â†’ <code class="inline">}</code> â†’ end, or</li>
<li>â†’ <code class="inline">,</code> â†’ <code class="inline">whitespace</code> â†’ ... â†’ value</li></ul>
<p>and you can keep looping, until you decide to go to:</p>
<ul><li>â†’ <code class="inline">}</code> â†’ end.</li></ul>
<p>So, I guess we are now acquainted with the railroad diagram, let&#39;s carry on to the next section.</p></section>
<section><h2><a href="#implementing-the-parser" id="implementing-the-parser">Implementing the parser</a></h2>
<p>Let&#39;s start with the following structure:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// TODO</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>We initialise <code class="inline">i</code> as the index for the current character, we will end as soon as <code class="inline">i</code> reaches the end of the <code class="inline">str</code>.</p>
<p>Let&#39;s implement the grammar for the <strong>&quot;object&quot;:</strong></p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#123;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// if it is not &#39;&#125;&#39;,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// we take the path of string -&gt; whitespace -&gt; &#39;:&#39; -&gt; value -&gt; ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#125;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseString</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">eatColon</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">value</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>In the <code class="inline">parseObject</code>, we will call parse of other grammars, like &quot;string&quot; and &quot;whitespace&quot;, when we implement them, everything will work ðŸ¤ž.</p>
<p>One thing that I forgot to add is the comma, <code class="inline">,</code>. The <code class="inline">,</code> only appears before we start the second loop of <code class="inline">whitespace</code> â†’ <code class="inline">string</code> â†’ <code class="inline">whitespace</code> â†’ <code class="inline">:</code> â†’ ...</p>
<p>Based on that, we add the following lines:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#123;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// if it is not &#39;&#125;&#39;,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// we take the path of string -&gt; whitespace -&gt; &#39;:&#39; -&gt; value -&gt; ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#125;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-color-text)">initial) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">eatComma</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseString</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">eatColon</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">value</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// move to the next character of &#39;&#125;&#39;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Some naming convention:</p>
<ul><li>We call <code class="inline">parseSomething</code>, when we parse the code based on grammar and use the return value</li>
<li>We call <code class="inline">eatSomething</code>, when we expect the character(s) to be there, but we are not using the character(s)</li>
<li>We call <code class="inline">skipSomething</code>, when we are okay if the character(s) is not there.</li></ul>
<p>Let&#39;s implement the <code class="inline">eatComma</code> and <code class="inline">eatColon</code>:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">eatComma</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;,&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">throw</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Error</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Expected &quot;,&quot;.&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">eatColon</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;:&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">throw</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Error</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Expected &quot;:&quot;.&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>So we have finished implemented the <code class="inline">parseObject</code> grammar, but what is the return value from this parse function?</p>
<p>Well, we need to return a JavaScript object:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#123;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">result</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> &#123;&#125;;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// if it is not &#39;&#125;&#39;,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// we take the path of string -&gt; whitespace -&gt; &#39;:&#39; -&gt; value -&gt; ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#125;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-color-text)">initial) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">eatComma</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseString</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">eatColon</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">value</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        result[key] </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> value;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// move to the next character of &#39;&#125;&#39;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> result;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Now that you&#39;ve seen me implementing the &quot;object&quot; grammar, it&#39;s time for you to try out the &quot;array&quot; grammar:</p>
<p><img src="https://www.json.org/img/array.png" alt="https://www.json.org/img/array.png"></p>
<small>Image source: https://www.json.org/img/array.png</small>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseArray</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;[&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">result</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> [];</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;]&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-color-text)">initial) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">eatComma</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">value</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">result</span><span style="color: var(--shiki-token-function)">.push</span><span style="color: var(--shiki-color-text)">(value);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        initial </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// move to the next character of &#39;]&#39;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> result;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Now, move on to a more interesting grammar, &quot;value&quot;:</p>
<p><img src="https://www.json.org/img/value.png" alt="https://www.json.org/img/value.png"></p>
<small>Image source: https://www.json.org/img/value.png</small>
<p>A value starts with &quot;whitespace&quot;, then any of the following: &quot;string&quot;, &quot;number&quot;, &quot;object&quot;, &quot;array&quot;, &quot;true&quot;, &quot;false&quot; or &quot;null&quot;, and then end with a &quot;whitespace&quot;:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">value</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseString</span><span style="color: var(--shiki-color-text)">() </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseNumber</span><span style="color: var(--shiki-color-text)">() </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseArray</span><span style="color: var(--shiki-color-text)">() </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseKeyword</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;true&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseKeyword</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;false&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">??</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">parseKeyword</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;null&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">skipWhitespace</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> value;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>The <code class="inline">??</code> is called the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator" rel="nofollow">nullish coalescing operator</a>, it is like the <code class="inline">||</code> that we used to use for defaulting a value <code class="inline">foo || default</code>, except that <code class="inline">||</code> will return the <code class="inline">default</code> as long as <code class="inline">foo</code> is falsy, whereas the nullish coalescing operator will only return <code class="inline">default</code> when <code class="inline">foo</code> is either <code class="inline">null</code> or <code class="inline">undefined</code>.</p>
<p>The parseKeyword will check whether the current <code class="inline">str.slice(i)</code> matches the keyword string, if so, it will return the keyword value:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseKeyword</span><span style="color: var(--shiki-color-text)">(name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> value) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">str</span><span style="color: var(--shiki-token-function)">.slice</span><span style="color: var(--shiki-color-text)">(i</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">name</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">length</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> name) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      i </span><span style="color: var(--shiki-token-keyword)">+=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">name</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">length</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> value;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>That&#39;s it for <code class="inline">parseValue</code>!</p>
<p>We still have 3 more grammars to go, but I will save the length of this article, and implement them in the following CodeSandbox:</p>
<iframe src="https://codesandbox.io/embed/json-parser-k4c3w?expanddevtools=1&fontsize=14&hidenavigation=1&theme=dark&view=editor" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="JSON parser" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
<p>After we have finished implementing all the grammars, now let&#39;s return the value of the json, which is return by the <code class="inline">parseValue</code>:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseValue</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>That&#39;s it!</p>
<p>Well, not so fast my friend, we&#39;ve just finished the happy path, what about unhappy path?</p></section>
<section><h2><a href="#handling-the-unexpected-input" id="handling-the-unexpected-input">Handling the unexpected input</a></h2>
<p>As a good developer, we need to handle the unhappy path gracefully as well. For a parser, that means shouting at the developer with appropriate error message.</p>
<p>Let&#39;s handle the 2 most common error cases:</p>
<ul><li>Unexpected token</li>
<li>Unexpected end of string</li></ul></section>
<section><h3><a href="#unexpected-token" id="unexpected-token">Unexpected token</a></h3></section>
<section><h3><a href="#unexpected-end-of-string" id="unexpected-end-of-string">Unexpected end of string</a></h3>
<p>In all the while loops, for example the while loop in <code class="inline">parseObject</code>:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)">(str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#125;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>We need to make sure that we don&#39;t access the character beyond the length of the string. This happens when the string ended unexpectedly, while we are still waiting for a closing character, &quot;}&quot; in this example:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">parseObject</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (i </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">str</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">length</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> str[i] </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#125;&#39;</span><span style="color: var(--shiki-color-text)">) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">checkUnexpectedEndOfInput</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// move to the next character of &#39;&#125;&#39;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    i</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> result;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div></section>
<section><h2><a href="#going-the-extra-mile" id="going-the-extra-mile">Going the extra mile</a></h2>
<p>Do you remember the time you were a junior developer, every time when you encounter Syntax error with cryptic messages, you are completely clueless of what went wrong?</p>
<p>Now you are more experienced, it is time to stop this virtuous cycle and stop yelling</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>and leave the user staring at the screen confounded.</p>
<p>There&#39;s a lot of better ways of handling error messages than yelling, here are some points you can consider adding to your parser:</p></section>
<section><h3><a href="#error-code-and-standard-error-message" id="error-code-and-standard-error-message">Error code and standard error message</a></h3>
<p>This is useful as a standard keyword for user to Google for help.</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// instead of</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Unexpected end </span><span style="color: var(--shiki-token-keyword)">of</span><span style="color: var(--shiki-color-text)"> input</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// show</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">JSON_ERROR_001</span><span style="color: var(--shiki-color-text)"> Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">JSON_ERROR_002</span><span style="color: var(--shiki-color-text)"> Unexpected end </span><span style="color: var(--shiki-token-keyword)">of</span><span style="color: var(--shiki-color-text)"> input</span></span></code></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#a-better-view-of-what-went-wrong" id="a-better-view-of-what-went-wrong">A better view of what went wrong</a></h3>
<p>Parser like Babel, will show you a code frame, a snippet of your code with underline, arrow or highlighting of what went wrong</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// instead of</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span><span style="color: var(--shiki-color-text)"> at position </span><span style="color: var(--shiki-token-constant)">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// show</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#123; </span><span style="color: var(--shiki-token-string-expression)">&quot;b&quot;</span><span style="color: var(--shiki-color-text)">a</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">^</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">JSON_ERROR_001</span><span style="color: var(--shiki-color-text)"> Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>An example on how you can print out the code snippet:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(str) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">printCodeSnippet</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Math</span><span style="color: var(--shiki-token-function)">.max</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">trimmed</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> from </span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">padding</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> (trimmed </span><span style="color: var(--shiki-token-keyword)">?</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> (i </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-color-text)"> from);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">snippet</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> [</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      (trimmed </span><span style="color: var(--shiki-token-keyword)">?</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;...&#39;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#39;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">str</span><span style="color: var(--shiki-token-function)">.slice</span><span style="color: var(--shiki-color-text)">(from</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> i </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-string-expression)">&#39; &#39;</span><span style="color: var(--shiki-token-function)">.repeat</span><span style="color: var(--shiki-color-text)">(padding) </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;^&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-string-expression)">&#39; &#39;</span><span style="color: var(--shiki-token-function)">.repeat</span><span style="color: var(--shiki-color-text)">(padding) </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> message</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    ]</span><span style="color: var(--shiki-token-function)">.join</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;&#92;n&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(snippet);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#suggestions-for-error-recovery" id="suggestions-for-error-recovery">Suggestions for error recovery</a></h3>
<p>If possible, explain what went wrong and give suggestions on how to fix them</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// instead of</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span><span style="color: var(--shiki-color-text)"> at position </span><span style="color: var(--shiki-token-constant)">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// show</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#123; </span><span style="color: var(--shiki-token-string-expression)">&quot;b&quot;</span><span style="color: var(--shiki-color-text)">a</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">^</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">JSON_ERROR_001</span><span style="color: var(--shiki-color-text)"> Unexpected token </span><span style="color: var(--shiki-token-string-expression)">&quot;a&quot;</span><span style="color: var(--shiki-color-text)">.</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Expecting a </span><span style="color: var(--shiki-token-string-expression)">&quot;:&quot;</span><span style="color: var(--shiki-color-text)"> over here</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> eg</span><span style="color: var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#123; </span><span style="color: var(--shiki-token-string-expression)">&quot;b&quot;</span><span style="color: var(--shiki-color-text)">: </span><span style="color: var(--shiki-token-string-expression)">&quot;bar&quot;</span><span style="color: var(--shiki-color-text)"> &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">^</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">You can learn more about valid </span><span style="color: var(--shiki-token-constant)">JSON</span><span style="color: var(--shiki-color-text)"> string </span><span style="color: var(--shiki-token-keyword)">in</span><span style="color: var(--shiki-color-text)"> http</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-token-comment)">//goo.gl/xxxxx</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>If possible, provide suggestions based on the context that the parser has collected so far</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-function)">fakeParseJSON</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;&quot;Lorem ipsum&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// instead of</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Expecting a </span><span style="color: var(--shiki-token-string-expression)">&#96;&quot;&#96;</span><span style="color: var(--shiki-color-text)"> over here</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> eg</span><span style="color: var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color: var(--shiki-token-string-expression)">&quot;Foo Bar&quot;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">^</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// show</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">Expecting a </span><span style="color: var(--shiki-token-string-expression)">&#96;&quot;&#96;</span><span style="color: var(--shiki-color-text)"> over here</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> eg</span><span style="color: var(--shiki-token-punctuation)">:</span></span>
<span class="line"><span style="color: var(--shiki-token-string-expression)">&quot;Lorem ipsum&quot;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">^</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>The suggestion that based on the context will feel more relatable and actionable.</p>
<p>With all the suggestions in mind, check out the updated CodeSandbox with</p>
<ul><li>Meaningful error message</li>
<li>Code snippet with error pointing point of failure</li>
<li>Provide suggestions for error recovery</li></ul>
<iframe src="https://codesandbox.io/embed/json-parser-hjwxk?expanddevtools=1&fontsize=14&hidenavigation=1&theme=dark&view=editor" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="JSON parser (with error handling)" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
<p>Also, read the <a href="https://elm-lang.org/news/compiler-errors-for-humans" rel="nofollow">&quot;Compiler Errors for Humans&quot;</a> by <a href="https://twitter.com/czaplic" rel="nofollow">Evan Czaplicki</a> for how Elm improves the UX problems of the Elm compiler.</p></section>
<section><h2><a href="#summary" id="summary">Summary</a></h2>
<p>To implement a parser, you need to start with the grammar.</p>
<p>You can formalise the grammar with the railroad diagrams or the Backus-Naur Form. Designing the grammar is the hardest step.</p>
<p>Once you&#39;ve settled with the grammar, you can start implementing the parser based on it.</p>
<p>Error handling is important, what&#39;s more important is to have meaningful error messages, so that the user knows how to fix it.</p>
<p>Now you know how a simple parser is implemented, it&#39;s time to set eyes on a more complex one:</p>
<ul><li><a href="https://github.com/babel/babel/tree/master/packages/babel-parser" rel="nofollow">Babel parser</a></li>
<li><a href="https://github.com/sveltejs/svelte/tree/master/src/compiler/parse" rel="nofollow">Svelte parser</a></li></ul>
<p>Lastly, do follow <a href="https://twitter.com/cassidoo" rel="nofollow">@cassidoo</a>, her weekly newsletter is awesome!</p>
</section></article>

<div style="height: 1px; width: 100%"></div>

</main>

<footer class="svelte-1x8iuzz">
</footer>


		<script type="module" data-hydrate="vew7kb">
		import { start } from "https://lihautan.com/_app/start-c7a2dfb9.js";
		start({
			target: document.querySelector('[data-hydrate="vew7kb"]').parentNode,
			paths: {"base":"","assets":"https://lihautan.com"},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "always",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("https://lihautan.com/_app/pages/__layout.svelte-c3db4d7b.js"),
						import("https://lihautan.com/_app/pages/json-parser-with-javascript/index.md-d5f85f35.js")
				],
				params: {}
			}
		});
	</script></div>
	</body>
</html>
