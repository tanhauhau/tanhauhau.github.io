<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://twitter.com/lihautan" rel="me" />
		<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#bd93f9" />
		<link rel="apple-touch-icon" sizes="48x48" href="/icon-48x48.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="/icon-256x256.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />
		<link rel="icon" href="/icon-48x48.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			rel="preload"
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&family=Noto+Sans+SC:wght@500&display=swap"
			as="style"
			onload="this.rel='stylesheet'"
		/>
		<link
			rel="alternate"
			type="application/rss+xml"
			title="Tan Li Hau&#x27;s RSS Feed"
			href="/rss.xml"
		/>
		<link rel="sitemap" type="application/xml" href="/sitemap.xml" />
		<link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
		<link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6Y89Q69VY"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-Z6Y89Q69VY');
		</script>
		
		<link href="https://lihautan.com/_app/immutable/assets/2.CDMtzrzD.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/Links.Barm56k2.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/PreloadingIndicator.CHlB5uuK.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/code-snippet.Ch6n4AYw.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/BlogLayout.D1SVHRXd.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/ldjson.CQpH2WJc.css" rel="stylesheet">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/start.CVysmP4c.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/entry.NOq9Kj6o.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/scheduler.D6VJxl8L.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/app.Bk7PW2KV.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.CLAVN-Y5.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/0.DLHgrcY7.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/2.CwhX-zvu.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/stores.CLeQvcbJ.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/Links.C4jMQkMc.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/each.DI7TeU31.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.DueORT-9.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/PreloadingIndicator.6QGaXoVk.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/16.BGKyzRCP.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/code-snippet.Gym6WUAG.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/BlogLayout.BMJM32nZ.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/ldjson.BehsK3rr.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/twitter-card-image.C3bQ3Oc7.js"><title>Compile Svelte 5 in your head | Tan Li Hau</title><!-- HEAD_svelte-1jsbgzp_START --><meta name="description" content="Background5 years ago, I wrote Compile Svelte in your head. That was written for Svelte 3.But now, almost 1 year into Svelte 5 release, which introduce tons of new features, such as runes, fine-grained reactivity, and more, ..."><meta name="image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.bFm5iFME.jpg"><meta name="og:image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.bFm5iFME.jpg"><meta name="og:title" content="Compile Svelte 5 in your head"><meta name="og:description" content="Background5 years ago, I wrote Compile Svelte in your head. That was written for Svelte 3.But now, almost 1 year into Svelte 5 release, which introduce tons of new features, such as runes, fine-grained reactivity, and more, ..."><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@lihautan"><meta name="twitter:title" content="Compile Svelte 5 in your head"><meta name="twitter:description" content="Background5 years ago, I wrote Compile Svelte in your head. That was written for Svelte 3.But now, almost 1 year into Svelte 5 release, which introduce tons of new features, such as runes, fine-grained reactivity, and more, ..."><meta name="twitter:image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.bFm5iFME.jpg"><meta name="keywords" content="Svelte"><meta name="keywords" content="JavaScript"><meta itemprop="url" content="https://lihautan.com/compile-svelte-5-in-your-head"><meta itemprop="image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.bFm5iFME.jpg"><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightYear":"2022","creator":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"publisher":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"description":"Background5 years ago, I wrote Compile Svelte in your head. That was written for Svelte 3.But now, almost 1 year into Svelte 5 release, which introduce tons of new features, such as runes, fine-grained reactivity, and more, ...","headline":"Compile Svelte 5 in your head","name":"Compile Svelte 5 in your head","inLanguage":"en"}</script><!-- HTML_TAG_END --><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https://lihautan.com/compile-svelte-5-in-your-head","name":"Compile Svelte 5 in your head"},"name":"Compile Svelte 5 in your head","position":2}]}</script><!-- HTML_TAG_END --><!-- HEAD_svelte-1jsbgzp_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">   <a href="#content" class="skip svelte-1x8iuzz" data-svelte-h="svelte-198b79b">Skip to content</a> <header class="svelte-1x8iuzz"><nav><ul class="mode-sidebar svelte-2qf5mw"><li class="svelte-2qf5mw" data-svelte-h="svelte-1c15i4q"><a href="/" class="svelte-2qf5mw">Tan Li Hau</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-jyiaso"><a data-sveltekit-preload-data href="/about" class="svelte-2qf5mw">About</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-nil8z4"><a data-sveltekit-preload-data href="/blogs" class="svelte-2qf5mw">Writings</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-lr8cqc"><a data-sveltekit-preload-data href="/talks" class="svelte-2qf5mw">Talks</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-1oruudc"><a data-sveltekit-preload-data href="/notes" class="svelte-2qf5mw">Notes</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-18xilfe"><a data-sveltekit-preload-data href="/books" class="svelte-2qf5mw">Books</a></li> <li class="social svelte-2qf5mw" data-svelte-h="svelte-1bsaw7m"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
  10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
  4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a> <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
  0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
  5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
  5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
  3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> <a aria-label="YouTube account" href="https://youtube.com/c/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 461.001 461.001" width="1em" height="1em" class="svelte-2qf5mw"><path d="M365.257 67.393H95.744C42.866 67.393 0 110.259 0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878 0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zm-64.751 169.663-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881c3.748 1.899 3.683 7.274-.109 9.082z"></path></svg></a></li> </ul></nav></header> <div class="sidebar svelte-s9hlkv">  <div class="float svelte-s9hlkv" data-svelte-h="svelte-x1w5me"><svg viewBox="0 0 30 50" width="30" height="50"><circle fill="currentColor" cy="15" cx="15" r="3"></circle><circle fill="currentColor" cy="25" cx="15" r="3"></circle><circle fill="currentColor" cy="35" cx="15" r="3"></circle></svg></div> </div> <main id="content" class="svelte-1x8iuzz"> <h1>Compile Svelte 5 in your head</h1> <div class="date svelte-13b38er">July 20, 2025</div> <a class="tag series svelte-13b38er" href="/series/Compile Svelte 5 in your head/">Series: Compile Svelte 5 in your head</a> <a class="tag svelte-13b38er" href="/tags/Svelte/">Svelte</a><a class="tag svelte-13b38er" href="/tags/JavaScript/">JavaScript</a> <section role="navigation" aria-label="Table of Contents" class="svelte-zmasws"><ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#background" class="svelte-zmasws">Background</a>  </li><li class="svelte-zmasws"><a href="#introduction" class="svelte-zmasws">Introduction</a> <ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#creating-an-element" class="svelte-zmasws">Creating an element</a>  </li><li class="svelte-zmasws"><a href="#updating-text-value-in-a-text-node" class="svelte-zmasws">Updating text value in a text node</a>  </li><li class="svelte-zmasws"><a href="#removing-an-element" class="svelte-zmasws">Removing an element</a>  </li><li class="svelte-zmasws"><a href="#adding-style-to-an-element" class="svelte-zmasws">Adding style to an element</a>  </li><li class="svelte-zmasws"><a href="#listen-for-click-events-on-an-element" class="svelte-zmasws">Listen for click events on an element</a>  </li><li class="svelte-zmasws"><a href="#the-lt-template-gt-element" class="svelte-zmasws">The  `&amp;lt;template&amp;gt;`  element</a>  </li><li class="svelte-zmasws"><a href="#nextsibling-and-firstchild" class="svelte-zmasws">nextSibling and firstChild</a>  </li><li class="svelte-zmasws"><a href="#event-delegation" class="svelte-zmasws">Event delegation</a>  </li> </ol> </li><li class="svelte-zmasws"><a href="#svelte-syntax" class="svelte-zmasws">Svelte syntax</a>  </li><li class="svelte-zmasws"><a href="#compile-svelte-5-in-your-head" class="svelte-zmasws">Compile Svelte 5 in your Head</a> <ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#adding-a-reactive-state" class="svelte-zmasws">Adding a reactive state</a>  </li><li class="svelte-zmasws"><a href="#updating-the-reactive-state" class="svelte-zmasws">Updating the reactive state</a> <ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#updating-the-template" class="svelte-zmasws">Updating the template</a>  </li><li class="svelte-zmasws"><a href="#signals-and-effects" class="svelte-zmasws">Signals and effects</a>  </li> </ol> </li><li class="svelte-zmasws"><a href="#adding-event-listeners" class="svelte-zmasws">Adding event listeners</a> <ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#moving-the-update-function-out-of-the-app-function" class="svelte-zmasws">Moving the  `update`  function out of the  `App`  function</a>  </li><li class="svelte-zmasws"><a href="#click-and-delegate" class="svelte-zmasws">__click and $.delegate</a>  </li> </ol> </li><li class="svelte-zmasws"><a href="#putting-it-all-together" class="svelte-zmasws">Putting it all together</a>  </li> </ol> </li><li class="svelte-zmasws"><a href="#closing-note" class="svelte-zmasws">Closing Note</a>  </li></ol> </section> <article class="blog"><section data-svelte-h="svelte-1i2kal7"><h2><a href="#background" id="background">Background</a></h2> <p>5 years ago, I wrote <a href="/compile-svelte-in-your-head-part-1/">Compile Svelte in your head</a>. That was written for Svelte 3.</p> <p>But now, almost 1 year into <a href="https://svelte.dev/blog/svelte-5-is-alive" rel="nofollow">Svelte 5 release</a>, which introduce tons of new features, such as <em>runes</em>, fine-grained reactivity, and more, <strong>it is time to rewrite the article for Svelte 5</strong>!</p></section> <section data-svelte-h="svelte-119gfcv"><h2><a href="#introduction" id="introduction">Introduction</a></h2> <p>Lets refresh ourselves with how we write web app without any framework:</p></section> <section><h3 data-svelte-h="svelte-q2i03a"><a href="#creating-an-element" id="creating-an-element">Creating an element</a></h3> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js"><div class="language-id">js</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-comment)">// create a h1 element</span></div><div class='line'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createElement&lt;"h1">(tagName: "h1", options?: ElementCreationOptions | undefined): HTMLHeadingElement (+2 overloads)' >createElement</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;h1&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line'><span style="color: var(--shiki-token-comment)">// create a text node</span></div><div class='line'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='const text: Text' >text</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createTextNode(data: string): Text' >createTextNode</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;Hello World&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;Text>(node: Text): Text' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='const text: Text' >text</data-lsp>);</span></div><div class='line'><span style="color: var(--shiki-token-comment)">// ...and add it to the body</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;HTMLHeadingElement>(node: HTMLHeadingElement): HTMLHeadingElement' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='const h1: HTMLHeadingElement' >h1</data-lsp>);</span></div></code></div></pre><!-- HTML_TAG_END --></div> <blockquote><p data-svelte-h="svelte-1bvyvaj">If you&#39;ve read my <a href="/compile-svelte-in-your-head-part-1#creating-an-element">previous article</a>, you might&#39;ve notice that I&#39;ve tweaked slightly on the example above, using <code class="inline">document.createTextNode</code> instead of setting <code class="inline">textContent</code>.</p> <p data-svelte-h="svelte-1q62f1y">The reason why will slowly make sense to you later; but for now, do note that, you can have multiple text nodes in one element, eg:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;h1&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">text1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createTextNode</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Hello &#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">text2</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createTextNode</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;World&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(text1);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(text2);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">body</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(h1);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-10sbh9f">creates:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-string-expression)">h1</span><span style="color: var(--shiki-color-text)">&gt;Hello World&lt;/</span><span style="color: var(--shiki-token-string-expression)">h1</span><span style="color: var(--shiki-color-text)">&gt;</span></span></code></pre><!-- HTML_TAG_END --></div></blockquote></section> <section><h3 data-svelte-h="svelte-jr8z7"><a href="#updating-text-value-in-a-text-node" id="updating-text-value-in-a-text-node">Updating text value in a text node</a></h3> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// update the text of the text node</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">text</span><span style="color: var(--shiki-color-text)">.nodeValue </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Bye World&#39;</span><span style="color: var(--shiki-color-text)">;</span></span></code></pre><!-- HTML_TAG_END --></div></section> <section><h3 data-svelte-h="svelte-b5cbpm"><a href="#removing-an-element" id="removing-an-element">Removing an element</a></h3> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// finally, we remove the h1 element</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">body</span><span style="color: var(--shiki-token-function)">.removeChild</span><span style="color: var(--shiki-color-text)">(h1);</span></span></code></pre><!-- HTML_TAG_END --></div></section> <section><h3 data-svelte-h="svelte-42quq6"><a href="#adding-style-to-an-element" id="adding-style-to-an-element">Adding style to an element</a></h3> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// add class name to the h1 element</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-token-function)">.setAttribute</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;class&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;abc&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// ...and add a &lt;style&gt; tag to the head</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">style</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;style&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">style</span><span style="color: var(--shiki-color-text)">.textContent </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;.abc &#123; color: blue; &#125;&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">head</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(style);</span></span></code></pre><!-- HTML_TAG_END --></div></section> <section><h3 data-svelte-h="svelte-o9pja5"><a href="#listen-for-click-events-on-an-element" id="listen-for-click-events-on-an-element">Listen for click events on an element</a></h3> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">button</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;button&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"><span style="color: var(--shiki-token-constant)">button</span><span style="color: var(--shiki-color-text)">.textContent </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Click Me!&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-comment)">// listen to &quot;click&quot; events</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-constant)">button</span><span style="color: var(--shiki-token-function)">.addEventListener</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Hi!&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">&#125;);</span></span>
<span class="line dim"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">body</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(button);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-3h3o6">These are code that you have to write, without using any framework or library.</p> <p data-svelte-h="svelte-uolpfu">In previous versions of Svelte, this is enough DOM knowledge <a href="/compile-svelte-in-your-head-part-1#svelte-syntax">for me to draw parallels with Svelte</a>.</p> <p data-svelte-h="svelte-1dsp87p">However, more optimisation has been applied to Svelte 5. We will need to learn a few more advanced DOM concepts, such as <a href="#the-lt-template-gt-element"><code class="inline">&lt;template&gt;</code></a> and <a href="#event-delegation">event delegation</a>, before we can start talking about Svelte.</p></section> <section><h3 data-svelte-h="svelte-1pc345p"><a href="#the-lt-template-gt-element" id="the-lt-template-gt-element">The <code class="inline">&lt;template&gt;</code> element</a></h3> <p data-svelte-h="svelte-1f9yjlu">The <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/template" rel="nofollow"><code class="inline">&lt;template&gt;</code> element</a> is a special HTML element that allows you to define a chunk of HTML that is not rendered. Instead, its content is stored as a &quot;template&quot; that you can clone and insert into the DOM later using JavaScript.</p> <p data-svelte-h="svelte-l6nvjv">This is useful for creating reusable DOM structures:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// create a template element</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;template&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)">.innerHTML </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&lt;h1&gt;Hello World&lt;/h1&gt;&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// clone the template</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-token-function)">.cloneNode</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">).</span><span style="color: var(--shiki-token-constant)">content</span><span style="color: var(--shiki-color-text)">.firstChild;</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// insert the cloned template into the body</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">body</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(h1);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1qijo3u">As you can imagine, if your component contains a slightly more complex element structure, it can be more efficient to clone it from a <code class="inline">&lt;template&gt;</code> rather than manually rebuilding the DOM structure with <code class="inline">createElement</code>.</p></section> <section><h3 data-svelte-h="svelte-4dnkuy"><a href="#nextsibling-and-firstchild" id="nextsibling-and-firstchild">nextSibling and firstChild</a></h3> <p data-svelte-h="svelte-1mqlnsa">When you clone DOM elements using the <code class="inline">&lt;template&gt;</code> element, it&#39;ll be useful to get the reference to the specific elements within the cloned element.</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;template&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)">.innerHTML </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&lt;h1&gt;Hello &lt;span&gt;World&lt;/span&gt;&lt;/h1&gt;&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-token-function)">.cloneNode</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">).</span><span style="color: var(--shiki-token-constant)">content</span><span style="color: var(--shiki-color-text)">.firstChild;</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-comment)">// get the first child of the cloned element</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">text</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)">.firstChild; </span><span style="color: var(--shiki-token-comment)">// &quot;Hello &quot;</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-comment)">// get the next sibling of the first child</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">span</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">text</span><span style="color: var(--shiki-color-text)">.nextSibling; </span><span style="color: var(--shiki-token-comment)">// &lt;span&gt;World&lt;/span&gt;</span></span></code></pre><!-- HTML_TAG_END --></div></section> <section><h3 data-svelte-h="svelte-16t6bzk"><a href="#event-delegation" id="event-delegation">Event delegation</a></h3> <p data-svelte-h="svelte-sdq3qd">When you have a lot of elements that you want to listen to the same event name, eg: <code class="inline">&#39;click&#39;</code> event, you can use a technique called <strong>event delegation</strong>, that is, to listen to the event on a common parent element, rather than adding event listeners on each element.</p> <p data-svelte-h="svelte-99jk3k">For example, in the following HTML structure:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-string-expression)">div</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &lt;</span><span style="color: var(--shiki-token-string-expression)">button</span><span style="color: var(--shiki-color-text)">&gt;Click me&lt;/</span><span style="color: var(--shiki-token-string-expression)">button</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &lt;</span><span style="color: var(--shiki-token-string-expression)">button</span><span style="color: var(--shiki-color-text)">&gt;Click me&lt;/</span><span style="color: var(--shiki-token-string-expression)">button</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&lt;/</span><span style="color: var(--shiki-token-string-expression)">div</span><span style="color: var(--shiki-color-text)">&gt;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1fall3x">Instead of adding event listeners on each button:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">button1</span><span style="color: var(--shiki-token-function)">.addEventListener</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Button 1 clicked&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">button2</span><span style="color: var(--shiki-token-function)">.addEventListener</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Button 2 clicked&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-fn6799">You can instead listen to the event on the parent <code class="inline">&lt;div&gt;</code>:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">div</span><span style="color: var(--shiki-token-function)">.addEventListener</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> (event) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">event</span><span style="color: var(--shiki-color-text)">.target </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> button1) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Button 1 clicked&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125; </span><span style="color: var(--shiki-token-keyword)">else</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">event</span><span style="color: var(--shiki-color-text)">.target </span><span style="color: var(--shiki-token-keyword)">===</span><span style="color: var(--shiki-color-text)"> button2) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Button 2 clicked&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-118yawj">Event delegation is a common technique used in most JavaScript frameworks, as it is more efficient in performance, and it&#39;s much simpler to cleanup.</p> <blockquote data-svelte-h="svelte-g4tuyc"><p>Here are some resources that I&#39;ve found useful to learn about event delegation:</p> <ul><li><a href="https://www.greatfrontend.com/questions/quiz/explain-event-delegation" rel="nofollow"><strong>GreatFrontEnd:</strong> Explain event delegation in JavaScript</a></li> <li><a href="https://javascript.info/event-delegation" rel="nofollow"><strong>The Modern JavaScript Tutorial:</strong> Event delegation</a></li></ul></blockquote> <p data-svelte-h="svelte-1mqtd42">With enough preface on DOM, it&#39;s time for us to talk about Svelte 5.</p></section> <section><h2 data-svelte-h="svelte-1rqrhl0"><a href="#svelte-syntax" id="svelte-syntax">Svelte syntax</a></h2> <p data-svelte-h="svelte-19eozx4">Here I&#39;m going to show you some basics of the Svelte 5 syntax.</p> <blockquote data-svelte-h="svelte-19bz1yc"><p>If you wish to learn more, I highly recommend trying <a href="https://svelte.dev/tutorial/svelte/welcome-to-svelte" rel="nofollow">Svelte&#39;s interactive tutorial</a>.</p></blockquote> <p data-svelte-h="svelte-aqmmjp">So here is a basic Svelte component:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1alxf7o"><a href="https://svelte.dev/repl/99aeea705b1e48fe8610b3ccee948280?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-1hzp0hf">To add style, you add a <code class="inline">&lt;style&gt;</code> tag:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></div><div class="line">  <span class="token selector">h1</span> <span class="token punctuation">&#123;</span></div><div class="line">    <span class="token property">color</span><span class="token punctuation">:</span> rebeccapurple<span class="token punctuation">;</span></div><div class="line">  <span class="token punctuation">&#125;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-2cw5te"><a href="https://svelte.dev/repl/cf54441399864c0f9b0cb25710a5fe9b?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-1utreyn">At this point, writing Svelte component just feels like writing HTML, that&#39;s because Svelte syntax is a super set of the HTML syntax.</p> <p data-svelte-h="svelte-1kl0vvo">Let&#39;s look at how we add data to our component with the <a href="https://svelte.dev/blog/runes" rel="nofollow">Svelte runes</a>:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-qodt54"><a href="https://svelte.dev/playground/35593ac1322248699828c5ce6e438038?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-f4lxmf">Runes are like markers that tell the Svelte compiler about your code. We use the <code class="inline">$state</code> rune to mark the <code class="inline">name</code> variable as a reactive state.</p> <p data-svelte-h="svelte-olnn2p">To use the reactive state in the template, we can specify it inside the <code class="inline">{}</code> curly brackets in the template. We can include any JavaScript expression inside the curly brackets.</p> <p data-svelte-h="svelte-ugz7iq">To add a click handler, we add the <code class="inline">onclick</code> attribute to the button element, just like how you would in HTML:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line">  <span class="token keyword">function</span> <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line">  <span class="token punctuation">&#125;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>onClickButton<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Clicked <span class="token language-javascript"><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-q00kww"><a href="https://svelte.dev/repl/1da1dcaf51814ed09d2341ea7915f0a1?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-qafspi">To change the value of a reactive state, we just assign to it:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line dim">  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token keyword">function</span> <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line highlight">    count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token punctuation">&#125;</span></div><div class="line dim"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>onClickButton<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Clicked <span class="token language-javascript"><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-cixg1r"><a href="https://svelte.dev/repl/7bff4b7746df4007a51155d2006ce724?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-1qycdus">Since we&#39;ve marked <code class="inline">count</code> as a reactive state with the <code class="inline">$state</code> rune, any change in the <code class="inline">count</code> variable value will be reflected in the DOM.</p></section> <section><h2 data-svelte-h="svelte-1mho4wv"><a href="#compile-svelte-5-in-your-head" id="compile-svelte-5-in-your-head">Compile Svelte 5 in your Head</a></h2> <p data-svelte-h="svelte-1hw9j3h">The Svelte compiler analyses the code you write and generates an optimised JavaScript output.</p> <p data-svelte-h="svelte-nmfqh0">To study how Svelte compiles the code, lets start with the smallest example possible, and slowly build up the code. Through the process, you will see that Svelte incrementally adds to the output code based on your changes.</p> <p data-svelte-h="svelte-mn7j0o">The first example that we are going to see is:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1alxf7o"><a href="https://svelte.dev/repl/99aeea705b1e48fe8610b3ccee948280?version=5" rel="nofollow">Svelte REPL</a></p> <p data-svelte-h="svelte-1qed6n7">The output code:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">as</span><span style="color: var(--shiki-color-text)"> $ </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;svelte/internal/client&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt;Hello World&lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">($$anchor) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">root</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.append</span><span style="color: var(--shiki-color-text)">($$anchor</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-8p79m9">All components in Svelte compiles to function that mounts elements into the DOM.</p> <p data-svelte-h="svelte-l2gu37">The component function is meant to be called once, to setup the component, and that&#39;s it for the entire lifetime of the component.</p> <p data-svelte-h="svelte-mw1eoj">If you take a look here,</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt;Hello World&lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-171vv6m">We have our entire Svelte component here, in HTML string, passed into the <code class="inline">$.from_html</code> function.</p> <p data-svelte-h="svelte-w1w5e9">But, what does it do?</p> <p data-svelte-h="svelte-1bh8cmh">It&#39;s tempting for me to show you the implementation of the <code class="inline">$.from_html</code>, but the actual code is a bit more complicated 😵‍💫, so allow me to gloss it over and simplify it 😅.</p> <p data-svelte-h="svelte-1te9e7c">The <code class="inline">$.from_html</code> function takes in HTML string, turn it into a <code class="inline">&lt;template&gt;</code> element, and returns a function that returns a new clone instance of the template:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">from_html</span><span style="color: var(--shiki-color-text)">(html) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;template&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-color-text)">.innerHTML </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> html;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">template</span><span style="color: var(--shiki-token-function)">.cloneNode</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)">).</span><span style="color: var(--shiki-token-constant)">content</span><span style="color: var(--shiki-color-text)">.firstChild;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-xvrybt"><em><a href="https://github.com/sveltejs/svelte/blob/f882095/packages/svelte/src/internal/client/dom/template.js#L43" rel="nofollow">Actual implementation of <code class="inline">from_html</code></a></em>.</p> <p data-svelte-h="svelte-d7obg2">Putting it together:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// create a template element</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt;Hello World&lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">($$anchor) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// create a new clone instance of the template</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">root</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// append the h1 element into the $$anchor element</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.append</span><span style="color: var(--shiki-color-text)">($$anchor</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div></section> <section><h3 data-svelte-h="svelte-154cuo2"><a href="#adding-a-reactive-state" id="adding-a-reactive-state">Adding a reactive state</a></h3> <p data-svelte-h="svelte-11g3625">Now that we&#39;ve looked at the bare minimum of a Svelte component, let&#39;s see how adding a reactive state would change the compiled output:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1xatwc1">Notice the change in the output code:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">as</span><span style="color: var(--shiki-color-text)"> $ </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;svelte/internal/client&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt;&lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">($$anchor) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;World&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">root</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)">.textContent </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Hello World&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.append</span><span style="color: var(--shiki-color-text)">($$anchor</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-yujbal">Some observations:</p> <ul data-svelte-h="svelte-11bhl37"><li>What you&#39;ve written in the <code class="inline">&lt;script&gt;</code> tag is moved into the top of the <code class="inline">App</code> function, with the <code class="inline">$state</code> runes marker removed.</li> <li>The HTML template no longer have the text content in the <code class="inline">h1</code>, but instead, it&#39;s set with <code class="inline">h1.textContent</code></li></ul> <p data-svelte-h="svelte-1mdxgp4">What happened here is that, whenever Svelte sees a dynamic expression in the template, the things that are wrapped in <code class="inline">{}</code>, Svelte will remove it from the HTML template string. They will not be defined when cloning the element through the <code class="inline">root()</code> function.</p> <p data-svelte-h="svelte-ip01fn">Instead, the dynamic values will only be set to the cloned elements after they are created when the component is being set up in the <code class="inline">App</code> function.</p> <p data-svelte-h="svelte-qhmyko">Try adding static and dynamic attributes to the element, and see that indeed only static attributes are defined inside the template, and dynamic attributes are set after the element is created:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">foo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>abc<span class="token punctuation">"</span></span> <span class="token attr-name">bar=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-agab5q">Not sure if you are wondering, why is the <code class="inline">name</code> variable is defined in the <code class="inline">App</code> function, although it is not being used?</p> <p data-svelte-h="svelte-t9f4r1">Well, I can come up with an explanation, but, it&#39;s best explained when comparing with the next code change, so, hold our horses for a bit.</p></section> <section><h3 data-svelte-h="svelte-1kr6y3r"><a href="#updating-the-reactive-state" id="updating-the-reactive-state">Updating the reactive state</a></h3> <p data-svelte-h="svelte-fba3p">Now, let&#39;s update the reactive state, <code class="inline">name</code>:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line dim">  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line highlight">  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line highlight">    name <span class="token operator">=</span> <span class="token string">'Svelte'</span><span class="token punctuation">;</span></div><div class="line highlight">  <span class="token punctuation">&#125;</span></div><div class="line dim"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-5rq8ou">...and observe the change in the compiled output:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">as</span><span style="color: var(--shiki-color-text)"> $ </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;svelte/internal/client&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt; &lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">($$anchor) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.state</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;World&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set</span><span style="color: var(--shiki-color-text)">(name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">root</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> text </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.child</span><span style="color: var(--shiki-color-text)">(h1);</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.reset</span><span style="color: var(--shiki-color-text)">(h1);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.template_effect</span><span style="color: var(--shiki-color-text)">(() </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set_text</span><span style="color: var(--shiki-color-text)">(text</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#96;Hello </span><span style="color: var(--shiki-token-keyword)">$&#123;</span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.get</span><span style="color: var(--shiki-color-text)">(name) </span><span style="color: var(--shiki-token-keyword)">??</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#39;</span><span style="color: var(--shiki-token-keyword)">&#125;</span><span style="color: var(--shiki-token-string-expression)">&#96;</span><span style="color: var(--shiki-color-text)">));</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.append</span><span style="color: var(--shiki-color-text)">($$anchor</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-yujbal">Some observations:</p> <ul data-svelte-h="svelte-1jt8rsu"><li>Additional space in between the <code class="inline">&lt;h1&gt; &lt;/h1&gt;</code> in the template</li> <li>Similar to the previous sample, what you&#39;ve written in the <code class="inline">&lt;script&gt;</code> tag is moved into the top of the <code class="inline">App</code> function</li> <li>But now, the reactive state <code class="inline">name</code> is now defined with <code class="inline">$.state()</code></li> <li>Setting the reactive state <code class="inline">name</code> is done through <code class="inline">$.set()</code> and reading is <code class="inline">$.get()</code></li> <li>There&#39;s an additional <code class="inline">$.template_effect()</code> function that is used to set the text content of the text node</li></ul></section> <section><h4 data-svelte-h="svelte-1f3fey5"><a href="#updating-the-template" id="updating-the-template">Updating the template</a></h4> <p data-svelte-h="svelte-1faueqm">Different from the previous example, whenever the reactive state <code class="inline">name</code> is updated, we are going to <a href="#updating-text-value-in-a-text-node">update the value of the text node</a> inside <code class="inline">&lt;h1&gt;</code>.</p> <p data-svelte-h="svelte-1c2zg4o">Which means 2 things:</p> <ol data-svelte-h="svelte-irdg6o"><li>when cloning the template, we need to clone a text node inside <code class="inline">&lt;h1&gt;</code></li> <li>we need to get the reference to the text node, so that we can update it when the reactive state <code class="inline">name</code> changed</li></ol> <p data-svelte-h="svelte-58jrye">Not sure you&#39;ve noticed, to achieve <strong>(1)</strong>, we need to add an additional space in between the <code class="inline">&lt;h1&gt; &lt;/h1&gt;</code> in the template.</p> <p data-svelte-h="svelte-zz1uxe">That is because, creating a template with <code class="inline">&lt;h1&gt;&lt;/h1&gt;</code> will get you:</p> <ul data-svelte-h="svelte-nh90im"><li>h1 <em>(element)</em></li></ul> <p data-svelte-h="svelte-187vpc">but creating a template with <code class="inline">&lt;h1&gt; &lt;/h1&gt;</code>, you get:</p> <ul data-svelte-h="svelte-9eduvp"><li>h1 <em>(element)</em><ul><li>&#39; &#39; <em>(text node)</em></li></ul></li></ul> <p data-svelte-h="svelte-1pjcotz">Now, does it now make sense with the additional space?</p> <p data-svelte-h="svelte-1a9hhyg">Now, <code class="inline">h1</code> refers to the <code class="inline">&lt;h1&gt;</code> element, and to get the reference of the text node inside <code class="inline">h1</code>, we need to <a href="#nextsibling-and-firstchild">get the firstChild</a>, which is what <code class="inline">$.child(h1)</code> is doing:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> text </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.child</span><span style="color: var(--shiki-color-text)">(h1);</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// is same as</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> text </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)">.firstChild;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1ks3k9a">Now we&#39;ve created the text node and we have the reference to it, it&#39;s time to update the text node when the reactive state <code class="inline">name</code> changed. Thus, it&#39;s time to talk about signals and effects.</p></section> <section><h4 data-svelte-h="svelte-dd1eha"><a href="#signals-and-effects" id="signals-and-effects">Signals and effects</a></h4> <p data-svelte-h="svelte-31uyh5">There are many amazing articles written by the smartest people out there explaining the concepts of signals:</p> <ul data-svelte-h="svelte-ysqa7q"><li><a href="https://dev.to/this-is-learning/the-evolution-of-signals-in-javascript-8ob" rel="nofollow">The Evolution of Signals in JavaScript</a></li> <li><a href="https://angular.dev/essentials/signals" rel="nofollow">Angular: Signals</a></li> <li><a href="https://vuejs.org/guide/extras/reactivity-in-depth" rel="nofollow">Vue: Reactivity in Depth</a></li> <li><a href="https://svelte.dev/blog/runes#Signal-boost" rel="nofollow">Svelte: Signal Boost</a></li></ul> <p data-svelte-h="svelte-1x2ffep">So, I&#39;m not going to attempt to explain what signals are.</p> <p data-svelte-h="svelte-n11kuf">But for the purpose of this article, I&#39;m going to point out a few key points about signals in Svelte, so that you can see how it fits.</p> <p data-svelte-h="svelte-mgwhul">Signals in Svelte is created with the <code class="inline">$.state()</code>, which is compiled from the <code class="inline">$state</code> runes. You can think of signals as <strong>an object that stores the value of a reactive state</strong>. To read and set value, you need to use <code class="inline">$.get()</code> and <code class="inline">$.set()</code></p> <p data-svelte-h="svelte-sy8q9x">Signals alone are useless, unless you use them with effects, eg: <code class="inline">$.template_effect()</code>. The effect function takes in a callback function, and immediately calls it. For example,</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.template_effect</span><span style="color: var(--shiki-color-text)">(() </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Hello&#39;</span><span style="color: var(--shiki-color-text)">));</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1f756un">will immediately call <code class="inline">console.log(&#39;Hello&#39;)</code></p> <p data-svelte-h="svelte-fadfx3">Obviously, that alone wouldn&#39;t be useful.</p> <p data-svelte-h="svelte-1oe1ksn">The superpower of effect is that, it also tracks what are the signals value being read within the callback function. And whenever the signal value changes, the callback function will be called again.</p> <p data-svelte-h="svelte-nw716m">So,</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.template_effect</span><span style="color: var(--shiki-color-text)">(() </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.get</span><span style="color: var(--shiki-color-text)">(name)));</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-a801hq">Will print out the value of the signal <code class="inline">name</code> once, and also whenever the value of signal <code class="inline">name</code> changes.</p> <p data-svelte-h="svelte-19mselb">Bring it back to our example, when we have:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.template_effect</span><span style="color: var(--shiki-color-text)">(() </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set_text</span><span style="color: var(--shiki-color-text)">(text</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#96;Hello </span><span style="color: var(--shiki-token-keyword)">$&#123;</span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.get</span><span style="color: var(--shiki-color-text)">(name) </span><span style="color: var(--shiki-token-keyword)">??</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;&#39;</span><span style="color: var(--shiki-token-keyword)">&#125;</span><span style="color: var(--shiki-token-string-expression)">&#96;</span><span style="color: var(--shiki-color-text)">));</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1qbkgyt">The effect will run <code class="inline">$.set_text()</code> whenever the value of signal <code class="inline">name</code> changes, to update the text content of the text node.</p> <p data-svelte-h="svelte-1b6h1hu">By the way, <code class="inline">$.set_text(text, &#39;...&#39;)</code> is just the same as <a href="#updating-text-value-in-a-text-node"><code class="inline">text.nodeValue = &#39;...&#39;</code></a>.</p> <p data-svelte-h="svelte-150zlyr">Now, putting it together, you&#39;ll see how running the App function once, will:</p> <ul data-svelte-h="svelte-1u0kve"><li>clone new element instance from the template</li> <li>set up a template effect to update the text content of the text node whenever the value of signal <code class="inline">name</code> changes</li></ul> <p data-svelte-h="svelte-a283pg">Now we are one step closer to a complete reactive Svelte component.</p></section> <section><h3 data-svelte-h="svelte-d3b8iu"><a href="#adding-event-listeners" id="adding-event-listeners">Adding event listeners</a></h3> <p data-svelte-h="svelte-1h7dkrx">Let&#39;s now add an event listener</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line dim">  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line dim">    name <span class="token operator">=</span> <span class="token string">'Svelte'</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token punctuation">&#125;</span></div><div class="line dim"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line highlight"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">onclick=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>update<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1sjh8xc">and observe the compiled output:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">as</span><span style="color: var(--shiki-color-text)"> $ </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;svelte/internal/client&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">(_</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> name) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set</span><span style="color: var(--shiki-color-text)">(name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> root </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.from_html</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;&lt;h1&gt; &lt;/h1&gt;&#96;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">($$anchor) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.state</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;world&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">root</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)">.__click </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> [update</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> name];</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.delegate</span><span style="color: var(--shiki-color-text)">([</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-color-text)">]);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-yujbal">Some observations:</p> <ul data-svelte-h="svelte-1i1k25i"><li>The <code class="inline">update</code> function is moved out of the <code class="inline">App</code> function,</li> <li><code class="inline">h1.__click</code> is an array, <code class="inline">[update, name]</code></li> <li><code class="inline">$.delegate([&#39;click&#39;])</code> at the end of the file</li></ul></section> <section><h4 data-svelte-h="svelte-1dvn84r"><a href="#moving-the-update-function-out-of-the-app-function" id="moving-the-update-function-out-of-the-app-function">Moving the <code class="inline">update</code> function out of the <code class="inline">App</code> function</a></h4> <p data-svelte-h="svelte-m1351i">This move is more of an optimisation.</p> <p data-svelte-h="svelte-1hy44op">From the Svelte component source code, we know that the <code class="inline">update</code> function will be added as a click event listener to <code class="inline">h1</code> element.</p> <p data-svelte-h="svelte-doo818">So, instead of re-declaring the <code class="inline">update</code> function for every instance of the <code class="inline">App</code> component, the <code class="inline">update</code> function is rewritten in the compiled output such that all it&#39;s scoped variables are passed in as arguments.</p> <p data-svelte-h="svelte-1wua7lv">Because rewriting the <code class="inline">update</code> function this way, allows us to move the <code class="inline">update</code> function out of the <code class="inline">App</code> function, and only declare it once:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// name is referenced from the scope</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set</span><span style="color: var(--shiki-color-text)">(name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// is rewritten as</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">(_</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> name) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// name is passed in as the 2nd argument</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.set</span><span style="color: var(--shiki-color-text)">(name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1os8anb">Now, let&#39;s take a look at how the <code class="inline">update</code> function is added as a click event listener to the <code class="inline">h1</code> element.</p></section> <section><h4 data-svelte-h="svelte-1o8426o"><a href="#click-and-delegate" id="click-and-delegate">__click and $.delegate</a></h4> <p data-svelte-h="svelte-qc7ylu">Now, this is also for optimisation.</p> <p data-svelte-h="svelte-6f36eq">The optimisation we&#39;re referring here is <a href="#event-delegation">the event delegation we mentioned earlier</a>.</p> <p data-svelte-h="svelte-1zdy8t">To delegate the click event for the <code class="inline">h1</code> element to the document root, we write:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">$</span><span style="color: var(--shiki-token-function)">.delegate</span><span style="color: var(--shiki-color-text)">([</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-color-text)">]);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1f1dqe1">This adds a delegated click event listener to the document root.</p> <p data-svelte-h="svelte-mrdw52">But how does the delegated click event listener know which element and which event listener to call?</p> <p data-svelte-h="svelte-10tkcw2">This is where the <code class="inline">__click</code> property comes in.</p> <p data-svelte-h="svelte-1x2elwt">You can think of the delegated click event listener is roughly implemented as such:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-token-function)">.addEventListener</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> (event) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> target </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">event</span><span style="color: var(--shiki-color-text)">.target;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">while</span><span style="color: var(--shiki-color-text)"> (target </span><span style="color: var(--shiki-token-keyword)">!==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">document</span><span style="color: var(--shiki-color-text)">.body) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">target</span><span style="color: var(--shiki-color-text)">.__click) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> [</span><span style="color: var(--shiki-token-constant)">fn</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">...</span><span style="color: var(--shiki-token-constant)">args</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">target</span><span style="color: var(--shiki-color-text)">.__click;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">fn</span><span style="color: var(--shiki-color-text)">(event</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">...</span><span style="color: var(--shiki-color-text)">args);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">event</span><span style="color: var(--shiki-color-text)">.cancelBubble) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// if event.stopPropagation() is called,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// stop going up the DOM tree</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">break</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// go up the DOM tree</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    target </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">target</span><span style="color: var(--shiki-color-text)">.parentElement;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-13rw76s">The delegated click event listener will go up the DOM tree from the clicked element, and if any of the element has a <code class="inline">__click</code> property, it will call the function stored in the <code class="inline">__click</code> property, with the event and the arguments passed in.</p> <p data-svelte-h="svelte-1pse8hu">Cool thing about event delegation is that, we do not need to re-register event listener when creating new App component instance, and unregister when unmounting and cleaning up, <strong>because the same delegated click event listener works with however many elements and event listeners</strong>.</p></section> <section data-svelte-h="svelte-198t7mq"><h3><a href="#putting-it-all-together" id="putting-it-all-together">Putting it all together</a></h3> <p>Now, by this time, we have a complete reactive Svelte component, that has</p> <ul><li>a reactive state,</li> <li>a click event listener, and</li> <li>an dynamic expression in the template</li></ul> <p>So, let&#39;s walk through the compiled code to see how the component is initialised, and how clicking on the <code class="inline">h1</code> element will update its text content.</p> <p><strong>Let&#39;s start with initialising the <code class="inline">App</code> component:</strong></p> <ol><li>The code inside the <code class="inline">&lt;script&gt;</code> tag from the Svelte component is copied into the top of the <code class="inline">App</code> function<ul><li>We start with initialising the reactive state <code class="inline">name</code> with <code class="inline">$.state(&#39;world&#39;)</code></li> <li>This creates a signal object, and the initial value is set to <code class="inline">&#39;world&#39;</code></li></ul></li> <li>We create the DOM elements by cloning from the template via <code class="inline">$.from_html</code> and <code class="inline">root()</code></li> <li>We define click event listener via <code class="inline">h1.__click = [update, name]</code></li> <li>We get the reference to the text node inside the <code class="inline">h1</code> element via <code class="inline">$.child(h1)</code></li> <li>We define a template effect, via <code class="inline">$.template_effect</code> and set the text content of the text node to <code class="inline">&#39;Hello world&#39;</code><ul><li>As we read the value of the signal <code class="inline">name</code> inside the template effect, this template effect now tracks for the changes of the <code class="inline">name</code> signal</li></ul></li> <li>Finally, the <code class="inline">h1</code> element is appended to the document</li></ol> <p><strong>Now, let&#39;s see how clicking on the <code class="inline">h1</code> element will update its text content:</strong></p> <ol><li>When the <code class="inline">h1</code> element is clicked, the delegated click event listener will be called</li> <li>The delegated click event listener finds the element with the <code class="inline">__click</code> property, and thus call the <code class="inline">update</code> function</li> <li>The <code class="inline">update</code> function calls the <code class="inline">$.set()</code> function to update the value of the signal <code class="inline">name</code></li> <li>As the value of the signal <code class="inline">name</code> changes to <code class="inline">&#39;Svelte&#39;</code>, the template effect is being called<ul><li>The template effect sets the text content of the text node to <code class="inline">&#39;Hello Svelte&#39;</code></li> <li>As we read the value of the signal <code class="inline">name</code> inside the template effect, the template effect tracks for the next changes of the <code class="inline">name</code> signal</li></ul></li></ol> <p><strong>And that&#39;s how the text content of the <code class="inline">h1</code> element is updated to <code class="inline">&#39;Hello Svelte&#39;</code> upon clicked.</strong></p></section> <section data-svelte-h="svelte-ndoiro"><h2><a href="#closing-note" id="closing-note">Closing Note</a></h2> <p>And that&#39;s the basic structure of the Svelte&#39;s 5 compiled output.</p> <p>If you wish to know more, <a href="https://x.com/lihautan" rel="nofollow">follow me on Twitter</a>, and let me know what you think.</p> <p>I&#39;ve also did a talk on <strong>Building your own Svelte 5 compiler</strong> in CityJS New Delhi (too ambitious, I know), you can <a href="https://youtu.be/4uV27-OMJR8?si=3xfj7ZImahHOn24A&t=94" rel="nofollow">watch the talk on YouTube</a>.</p></section></article> <div style="height: 1px; width: 100%"></div> </main> <footer class="svelte-1x8iuzz"> </footer> 
			
			<script>
				{
					__sveltekit_lzgyl9 = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "https://lihautan.com"
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("https://lihautan.com/_app/immutable/entry/start.CVysmP4c.js"),
						import("https://lihautan.com/_app/immutable/entry/app.Bk7PW2KV.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 16],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
