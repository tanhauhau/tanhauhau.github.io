<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
  <link href="https://twitter.com/lihautan" rel="me" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#bd93f9" />
  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="icon" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300&display=swap" as="style"
    onload="this.rel='stylesheet'">
  <link rel="alternate" type="application/rss+xml" title="Tan Li Hau&#x27;s RSS Feed" href="/rss.xml"/>
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>
  <link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
  <link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
  <style>
    html {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: 19px;
      background: linear-gradient(0deg, transparent, #bd93f917, transparent);
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    :root {
      --prism-padding: 20px;
      --margin: 1.62em;
      --box-shadow-size: 6px;
      --box-shadow: var(--box-shadow-size) var(--box-shadow-size) var(--primary-color);
      --box-shadow-hover: 10px 10px var(--primary-color);
      --easing: 200ms ease-in-out;
      --primary-color: #bd93f9;
      --secondary-color: #9547b7;
      --dark-color: #282936;
    }
  </style>

  
  <title>Dynamically load reducers for code splitting in a React Redux application | Tan Li Hau</title><meta name="description" content="How to inject reducer asynchronously" data-svelte="svelte-15e3uyc"><meta name="image" data-svelte="svelte-15e3uyc"><meta name="og:image" data-svelte="svelte-15e3uyc"><meta name="og:title" content="Dynamically load reducers for code splitting in a React Redux application" data-svelte="svelte-15e3uyc"><meta name="og:description" content="How to inject reducer asynchronously" data-svelte="svelte-15e3uyc"><meta name="og:type" content="website" data-svelte="svelte-15e3uyc"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-15e3uyc"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-15e3uyc"><meta name="twitter:title" content="Dynamically load reducers for code splitting in a React Redux application" data-svelte="svelte-15e3uyc"><meta name="twitter:description" content="How to inject reducer asynchronously" data-svelte="svelte-15e3uyc"><meta name="twitter:image" data-svelte="svelte-15e3uyc"><meta itemprop="url" content="https%3A%2F%2Flihautan.com%2Fdynamically-load-async-reducer-for-code-splitting-in-react" data-svelte="svelte-15e3uyc"><meta itemprop="image" data-svelte="svelte-15e3uyc"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau"},"copyrightYear":"2020","creator":{"@type":"Person","name":"Tan Li Hau"},"publisher":{"@type":"Person","name":"Tan Li Hau"},"description":"How to inject reducer asynchronously","headline":"Dynamically load reducers for code splitting in a React Redux application","name":"Dynamically load reducers for code splitting in a React Redux application","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https%3A%2F%2Flihautan.com%2Fdynamically-load-async-reducer-for-code-splitting-in-react","name":"Dynamically load reducers for code splitting in a React Redux application"},"name":"Dynamically load reducers for code splitting in a React Redux application","position":2}]}</script><link as="script" rel="preload" href="./7db3e1a5.js"><link as="style" rel="preload" href="./assets/blog-base-3554d53c.css"><link as="style" rel="preload" href="./7db3e1a5.css"><link href="./assets/blog-base-3554d53c.css" rel="stylesheet"><link href="./7db3e1a5.css" rel="stylesheet">
</head>

<body>
  <div id="app">

<a href="#content" class="skip svelte-9tqnza">Skip to content</a>
<header class="svelte-f3e4uo"><nav><ul class="svelte-f3e4uo"><li class="svelte-f3e4uo"><a href="/" class="svelte-f3e4uo">Tan Li Hau</a></li>
    <li class="svelte-f3e4uo"><a href="/about" class="svelte-f3e4uo">About</a></li>
    <li class="svelte-f3e4uo"><a href="/blogs" class="svelte-f3e4uo">Writings</a></li>
    <li class="svelte-f3e4uo"><a href="/talks" class="svelte-f3e4uo">Talks</a></li>
    <li class="svelte-f3e4uo"><a href="/notes" class="svelte-f3e4uo">Notes</a></li>
    <li class="svelte-f3e4uo"><a href="/newsletter" class="svelte-f3e4uo">Newsletter</a></li>
    <li class="social svelte-f3e4uo"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul></nav>
</header>

<main id="content" class="blog svelte-9tqnza"><h1>Dynamically load reducers for code splitting in a React Redux application</h1>
  
  

  <article><section><ul class="sitemap" id="sitemap" role="navigation" aria-label="Table of Contents"><li><a href="#context">Context</a></li><li><a href="#problem">Problem</a></li><li><a href="#solution">Solution</a></li></ul></section>
<blockquote><p>This article assumes you have basic knowledge on React and Redux. If you like to learn more about React or Redux, you can go here to learn more.</p></blockquote>
<hr>
<section><h2><a href="#context" id="context">Context</a></h2>
<p>A common pattern to write a React Redux application is to have:</p>
<ul><li>a <code>rootReducer</code> that imports <strong>all the reducers</strong> that will be used in the application</li>
<li>a <code>reduxStore</code> that is created using <code>rootReducer</code></li>
<li>the React application</li>
<li><a href="https://github.com/reduxjs/react-redux" rel="nofollow">react-redux</a> that bridge React components and Redux together</li></ul>
<p>This is what its going to be look like in code:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// root.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Provider <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> store <span class="token punctuation">&#125;</span> <span class="token keyword">from</span>  <span class="token string">'./store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> CustomComponent <span class="token keyword">from</span> <span class="token string">'./CustomComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// react-redux provider to provide the store in React context</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>store<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CustomComponent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token comment">// import all your reducers here</span>
<span class="token keyword">import</span> reducerA <span class="token keyword">from</span> <span class="token string">'./reducerA'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducerB <span class="token keyword">from</span> <span class="token string">'./reducerB'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducerC <span class="token keyword">from</span> <span class="token string">'./reducerC'</span><span class="token punctuation">;</span>

<span class="token comment">// combine all your reducers here</span>
<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  reducerA<span class="token punctuation">:</span> reducerA<span class="token punctuation">,</span>
  reducerB<span class="token punctuation">:</span> reducerB<span class="token punctuation">,</span>
  reducerC<span class="token punctuation">:</span> reducerC<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create the redux store!</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CustomComponent.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> connect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">CustomComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">(</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>CustomComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section>
<section><h2><a href="#problem" id="problem">Problem</a></h2>
<p>Everything seemed perfect, until your app size increases too fastâ€¦</p>
<p>It takes much longer time to load your web app, and things got worse with a crappy internet speedâ€¦</p></section>
<section><h2><a href="#solution" id="solution">Solution</a></h2>
<p>I know you <a href="http://lmgtfy.com/?q=code-splitting" rel="nofollow">must have googled for the solution online.</a> ðŸ˜‰</p>
<p>So, lets talk about one of the solutions that you can do to make your app bundle smaller â€Šâ€” <a href="https://webpack.js.org/guides/code-splitting/" rel="nofollow">â€Šcode splitting using webpack</a>!</p>
<blockquote><p>Code splitting is one of the most compelling features of webpack. This feature allows you to split your code into various bundles which can then be loaded on demand or in parallel. It can be used to achieve smaller bundles and control resource load prioritization which, if used correctly, can have a major impact on load time.â€Šâ€”<a href="https://webpack.js.org/guides/code-splitting/" rel="nofollow">â€Šwebpack</a></p></blockquote>
<p>Great! Webpack provides <a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" rel="nofollow">import()</a> syntax, that conforms to the <a href="https://github.com/tc39/proposal-dynamic-import" rel="nofollow">ECMAScript proposal</a> for dynamic imports. Letâ€™s try to split our code <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/code-splitting.md" rel="nofollow">based on different entry points of your routes</a>. This makes perfect sense, user that goes to <code>mywebsite/foo</code> do not need code that is written only for <code>mywebsite/bar</code>!</p>
<p>By now, you should realise, reducer that is written only for <code>mywebsite/bar</code>, shouldnâ€™t be imported or included when you are visiting <code>mywebsite/foo</code>!</p>
<blockquote><p>Then how do I dynamically load reducers for code splitting in a Redux application?</p></blockquote>
<p>Thatâ€™s a <a href="https://stackoverflow.com/questions/32968016/how-to-dynamically-load-reducers-for-code-splitting-in-a-redux-application" rel="nofollow">StackOverflow thread</a> that you should read about.</p>
<blockquote><p>There may be neater way of expressing thisâ€Šâ€”â€ŠIâ€™m just showing the idea.</p></blockquote>
<p>Yes, one of a neater way is to write a higher order component that takes care of dynamically loading of reducers.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> gameReducer <span class="token keyword">from</span> <span class="token string">'./gameReducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> injectReducer <span class="token keyword">from</span> <span class="token string">'inducer'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// component logic here</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">injectReducer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  game<span class="token punctuation">:</span> gameReducer
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>CustomComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a href="https://www.npmjs.com/package/inducer" rel="nofollow">inducer</a> (read: <strong>In</strong>ject Re<strong>ducer</strong>) gives you a HOC that will add you reducer to the Redux store that is currently using during <code>componentWillMount</code> and remove it during <code>componentWillUnmount</code>. Itâ€™s that simple!</p>
<blockquote><p>So, how does inducer actually works?</p></blockquote>
<p>Firstly, inducer HOC gets the store from context, provided from the StoreProvider of <code>react-redux</code> .</p>
<pre class="language-js"><code class="language-js">InjectReducer<span class="token punctuation">.</span>contextTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  store<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
     replaceReducer<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>
<p>Next, inducer HOC comes up with the new async root reducer that includes the reducer you want to include, and use <a href="https://redux.js.org/api/store#replaceReducer" rel="nofollow">replaceReducer</a> from Redux to updates the reducer.</p>
<p>When <code>componentWillUnmount</code> inducer will remove your reducer and call <code>replaceReducer</code> again!</p>
<p>You can read the <a href="https://github.com/tanhauhau/inducer/blob/master/src/index.js" rel="nofollow">complete code</a> here!</p></section></article></main>

<footer class="svelte-9tqnza"><div class="form svelte-1k1s1co"><h1>Subscribe to my newsletter</h1>
  <h2 class="svelte-1k1s1co">Get the latest blog posts and project updates delivered right to your inbox</h2>
  <form action="https://buttondown.email/api/emails/embed-subscribe/lihautan" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lihautan', 'popupwindow')" class="embeddable-buttondown-form"><div class="form-item svelte-1k1s1co"><input type="email" name="email" id="bd-email" aria-label="email address" placeholder="youremail@example.com" class="svelte-1k1s1co">
      <input type="submit" value="Subscribe" disabled class="svelte-1k1s1co"></div>
    <input type="hidden" value="1" name="embed" class="svelte-1k1s1co">
    <p class="svelte-1k1s1co">Powered by Buttondown.</p></form>
</div>
  
</footer><script src="./7db3e1a5.js" async></script></div>
  

  <script>if ('serviceWorker' in navigator) { window.addEventListener('load', function () { navigator.serviceWorker.register('/sw.js'); }); }</script>
  <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); if (typeof ga === "function") { ga('create', 'UA-135921142-1', 'auto', {}); }</script>
  <script>if ('loading' in HTMLImageElement.prototype) { const images = document.querySelectorAll('img[loading="lazy"]'); images.forEach(img => { img.src = img.dataset.src; }); } else { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js'; document.body.appendChild(script); }</script>
</body>

</html>