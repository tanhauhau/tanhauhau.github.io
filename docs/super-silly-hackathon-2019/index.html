<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
  <link href="https://twitter.com/lihautan" rel="me" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#bd93f9" />
  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="icon" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300&display=swap" as="style"
    onload="this.rel='stylesheet'">
  <link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
  <link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
  <style>
    html {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: 19px;
      background: linear-gradient(0deg, transparent, #bd93f917, transparent);
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    :root {
      --prism-padding: 20px;
      --margin: 1.62em;
      --box-shadow-size: 6px;
      --box-shadow: var(--box-shadow-size) var(--box-shadow-size) var(--primary-color);
      --box-shadow-hover: 10px 10px var(--primary-color);
      --easing: 200ms ease-in-out;
      --primary-color: #bd93f9;
      --secondary-color: #9547b7;
      --dark-color: #282936;
    }
  </style>

  
  <title>Super Silly Hackathon 2019 | Tan Li Hau</title><meta name="description" content="A quick walkthrough on how I created my pet in the browser for the Super Silly Hackathon 2019." data-svelte="svelte-n0q11s"><meta name="image" data-svelte="svelte-n0q11s"><meta name="og:image" data-svelte="svelte-n0q11s"><meta name="og:title" content="Super Silly Hackathon 2019" data-svelte="svelte-n0q11s"><meta name="og:description" content="A quick walkthrough on how I created my pet in the browser for the Super Silly Hackathon 2019." data-svelte="svelte-n0q11s"><meta name="og:type" content="website" data-svelte="svelte-n0q11s"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-n0q11s"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-n0q11s"><meta name="twitter:title" content="Super Silly Hackathon 2019" data-svelte="svelte-n0q11s"><meta name="twitter:description" content="A quick walkthrough on how I created my pet in the browser for the Super Silly Hackathon 2019." data-svelte="svelte-n0q11s"><meta name="twitter:image" data-svelte="svelte-n0q11s"><meta name="keywords" content="JavaScript" data-svelte="svelte-n0q11s"><meta name="keywords" content="blog" data-svelte="svelte-n0q11s"><meta name="keywords" content="hackathon" data-svelte="svelte-n0q11s"><meta itemprop="url" content="https%3A%2F%2Flihautan.com%2Fsuper-silly-hackathon-2019" data-svelte="svelte-n0q11s"><meta itemprop="image" data-svelte="svelte-n0q11s"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau"},"copyrightYear":"2020","creator":{"@type":"Person","name":"Tan Li Hau"},"publisher":{"@type":"Person","name":"Tan Li Hau"},"description":"A quick walkthrough on how I created my pet in the browser for the Super Silly Hackathon 2019.","headline":"Super Silly Hackathon 2019","name":"Super Silly Hackathon 2019","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"position":1},{"@type":"ListItem","item":{"@id":"https%3A%2F%2Flihautan.com%2Fsuper-silly-hackathon-2019","name":"Super Silly Hackathon 2019"},"position":2}]}</script><link as="script" rel="preload" href="./8275970a.js"><link as="style" rel="preload" href="./assets/blog-base-8d11877d.css"><link as="style" rel="preload" href="./8275970a.css"><link href="./assets/blog-base-8d11877d.css" rel="stylesheet"><link href="./8275970a.css" rel="stylesheet">
</head>

<body>
  <div id="app">

<a href="#content" class="skip svelte-9tqnza">Skip to content</a>
<header class="svelte-f3e4uo"><nav><ul class="svelte-f3e4uo"><li class="svelte-f3e4uo"><a href="/" class="svelte-f3e4uo">Tan Li Hau</a></li>
    <li class="svelte-f3e4uo"><a href="/about" class="svelte-f3e4uo">About</a></li>
    <li class="svelte-f3e4uo"><a href="/blogs" class="svelte-f3e4uo">Writings</a></li>
    <li class="svelte-f3e4uo"><a href="/talks" class="svelte-f3e4uo">Talks</a></li>
    <li class="svelte-f3e4uo"><a href="/notes" class="svelte-f3e4uo">Notes</a></li>
    <li class="svelte-f3e4uo"><a href="/newsletter" class="svelte-f3e4uo">Newsletter</a></li>
    <li class="social svelte-f3e4uo"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul></nav>
</header>

<main id="content" class="blog svelte-9tqnza"><h1>Super Silly Hackathon 2019</h1>
  
  <span class="svelte-9tqnza">JavaScript</span><span class="svelte-9tqnza">blog</span><span class="svelte-9tqnza">hackathon</span>

  <article><section><ul class="sitemap" id="sitemap" role="navigation" aria-label="Table of Contents"><li><a href="#inspiration">Inspiration?</a></li><li><a href="#what-can-it-do">What can it do?</a></li><ul><ul><li><a href="#it-runs-away-from-mouse-cursor">1. It runs away from mouse cursor</a></li><li><a href="#it-eats-whatever-you-try-to-type-into-an-input">2. It eats whatever you try to type into an input</a></li><li><a href="#it-annihilates-the-buttons-you-hover-onto">3. It annihilates the buttons you hover onto</a></li></ul></ul><li><a href="#implementation">Implementation</a></li><ul><li><a href="#chrome-extension">Chrome Extension</a></li><ul><li><a href="#add-web-accessible-resources-into-the-manifest-json">1. Add  web_accessible_resources  into the  manifest.json</a></li><li><a href="#prepend-chrome-extension-msg-extension-id-for-the-url">2. Prepend  chrome-extension://__MSG_@@extension_id__/  for the URL</a></li></ul><li><a href="#make-it-look-alive">Make it look alive</a></li><li><a href="#avoid-the-cursor">Avoid the cursor</a></li><li><a href="#eating-the-characters">Eating the characters</a></li><li><a href="#annihilate-the-buttons">Annihilate the buttons</a></li></ul><li><a href="#difficulties">Difficulties</a></li><ul><li><a href="#synchronising-interactions">Synchronising interactions</a></li><li><a href="#developing-locally">Developing locally</a></li><ul><li><a href="#postcss-script">PostCSS script</a></li></ul></ul><li><a href="#demo">Demo</a></li><li><a href="#summary">Summary</a></li></ul></section>
<p>I just came back from the <a href="https://supersillyhackathon.sg/" rel="nofollow">Super Silly Hackathon 2019</a>. It was my second time to participate in this Super Silly Hackathon.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Hello everybody we are ready for this year, are you?? <a href="https://t.co/lem52qHO6Q">pic.twitter.com/lem52qHO6Q</a></p>â€” Super Silly Hackathon â€” 14 Dec 2019 (@supersillyhack) <a href="https://twitter.com/supersillyhack/status/1205671402432450563?ref_src=twsrc%5Etfw">December 14, 2019</a></blockquote>
<p>This year, my silly hackathon idea is to build <a href="https://github.com/tanhauhau/browser-pet" rel="nofollow">a little pet in the browser</a>!</p>
<p><img title="null" alt="rest" data-src="2f89d18a8952b14c.gif" loading="lazy"></p>
<section><h2><a href="#inspiration" id="inspiration">Inspiration?</a></h2>
<p>I saw the <a href="https://github.com/graceavery/tamagotchiTemp" rel="nofollow">tamagotchi</a> on touchbar a while ago, I don&#39;t have a touchbar, but I have a browser. So why not create a pet in the browser through Chrome Extension?</p></section>
<section><h2><a href="#what-can-it-do" id="what-can-it-do">What can it do?</a></h2></section>
<section><h4><a href="#it-runs-away-from-mouse-cursor" id="it-runs-away-from-mouse-cursor">1. It runs away from mouse cursor</a></h4>
<p><img title="null" alt="evade" data-src="0176ecb69ec20d12.gif" loading="lazy"></p></section>
<section><h4><a href="#it-eats-whatever-you-try-to-type-into-an-input" id="it-eats-whatever-you-try-to-type-into-an-input">2. It eats whatever you try to type into an input</a></h4>
<p><img title="null" alt="eat" data-src="e187d1f56cc116c3.gif" loading="lazy"></p></section>
<section><h4><a href="#it-annihilates-the-buttons-you-hover-onto" id="it-annihilates-the-buttons-you-hover-onto">3. It annihilates the buttons you hover onto</a></h4>
<p><img title="null" alt="annihilate" data-src="3a6793d23b3282f2.gif" loading="lazy"></p></section>
<section><h2><a href="#implementation" id="implementation">Implementation</a></h2></section>
<section><h3><a href="#chrome-extension" id="chrome-extension">Chrome Extension</a></h3>
<p>Firstly, it is a Chrome Extension. I used <a href="https://developer.chrome.com/extensions/content_scripts" rel="nofollow">Content Scripts</a>, so that I have access to the DOM of the pages I am visiting.</p>
<p>Here is my <code>manifest.json</code> for my extension:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"manifest_version"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Super Silly Hackathon"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Super Silly Hackathon"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"content_scripts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"matches"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;all_urls>"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"js"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"content.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"css"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"content-ext.css"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"run_at"</span><span class="token operator">:</span> <span class="token string">"document_start"</span><span class="token punctuation">,</span>
      <span class="token property">"all_frames"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To start, I added an <code>onload</code> event, to add my pet into the browser:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// filename: content.js</span>
<span class="token keyword">function</span> <span class="token function">onload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> pet <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'ssh-pet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> onload<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-css"><code class="language-css"><span class="token comment">/* filename: content.css */</span>
<span class="token selector">.ssh-pet</span> <span class="token punctuation">&#123;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 1000<span class="token punctuation">;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>'/images/rest.png'<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">background-size</span><span class="token punctuation">:</span> 30px 30px<span class="token punctuation">;</span>
  <span class="token property">background-position</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>The first problem I encountered, is that I couldn&#39;t access the <code>/images/rest.png</code>. After some googling, I need to:</p></section>
<section><h4><a href="#add-web-accessible-resources-into-the-manifest-json" id="add-web-accessible-resources-into-the-manifest-json">1. Add <code>web_accessible_resources</code> into the <code>manifest.json</code></a></h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token property">"web_accessible_resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"images/*"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre></section>
<section><h4><a href="#prepend-chrome-extension-msg-extension-id-for-the-url" id="prepend-chrome-extension-msg-extension-id-for-the-url">2. Prepend <code>chrome-extension://__MSG_@@extension_id__/</code> for the URL</a></h4>
<pre class="language-css"><code class="language-css"><span class="token selector">.ssh-pet</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* ... */</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'chrome-extension://__MSG_@@extension_id__/images/rest.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></section>
<section><h3><a href="#make-it-look-alive" id="make-it-look-alive">Make it look alive</a></h3>
<p>A static image will look fake.</p>
<p>As the quote says, <strong>&quot;eyes is the window to the soul&quot;</strong>, to make the pet look real, we need to make the eye blink.</p>
<p><em>(That&#39;s how you judge a person is dead or alive in movies right? Dead body will just stare blankly to nowhere)</em></p>
<p>To make the pet blink, I found some <a href="https://blog.teamtreehouse.com/css-sprite-sheet-animations-steps" rel="nofollow">useful tutorials</a> on how to create CSS sprite sheet animations.</p>
<p><picture><source type="image/webp" srcset="fe876ff9778d7618.webp"><source type="image/jpeg" srcset="fe876ff9778d7618.png"><img title="Sprite Sheet for Resting" alt="spritesheet for resting" data-src="fe876ff9778d7618.png" loading="lazy"></picture></p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> ssh-pet-rest</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-position-x</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-position-x</span><span class="token punctuation">:</span> -90px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.ssh-pet.rest</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'chrome-extension://__MSG_@@extension_id__/images/rest-sprite.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background-repeat</span><span class="token punctuation">:</span> repeat-x<span class="token punctuation">;</span>
  <span class="token property">background-size</span><span class="token punctuation">:</span> 90px 30px<span class="token punctuation">;</span>
  <span class="token property">background-position</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>
  <span class="token property">animation</span><span class="token punctuation">:</span> ssh-pet-rest 0.2s <span class="token function">steps</span><span class="token punctuation">(</span>3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To animate it, I added the <code>rest</code> class to the pet, and removed it when it&#39;s done animating.</p>
<pre class="language-js"><code class="language-js">pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'rest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// when the animation finished, remove the class</span>
<span class="token keyword">const</span> <span class="token function-variable function">onanimationend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  pet<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'animationend'</span><span class="token punctuation">,</span> onanimationend<span class="token punctuation">)</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'rest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
pet<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'animationend'</span><span class="token punctuation">,</span> onanimationend<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>At the beginning, I thought I would add more other micro expressions to the pet, so I wrote a scheduler, to schedule expressions randomly:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token parameter">random</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>random<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token function">animateRest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">scheduleSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> choices <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">// cheat to do Math.floor</span>
    <span class="token keyword">const</span> random <span class="token operator">=</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> choices<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scheduleSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">800</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// make animation promise based</span>
<span class="token keyword">function</span> <span class="token function">animateRest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'rest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token parameter">cls</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">onanimationend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      pet<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'animationend'</span><span class="token punctuation">,</span> onanimationend<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    pet<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'animationend'</span><span class="token punctuation">,</span> onanimationend<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>I used <code>await</code> to wait for animation to finish, before schedule the next action again, so that it will not have 2 actions running in parallel.</p></section>
<section><h3><a href="#avoid-the-cursor" id="avoid-the-cursor">Avoid the cursor</a></h3>
<p>I drew a sprite sheet that make the pet looks like it is squiggling away,</p>
<p><img title="null" alt="shift" data-src="8d653e6dd15ecdf5.gif" loading="lazy"></p>
<p>while at the same time set the <code>transform: translateX()</code> to actually move it:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> ssh-pet-shift-left</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-position-x</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token comment">/* highlight-next-line */</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-position-x</span><span class="token punctuation">:</span> -240px<span class="token punctuation">;</span>
    <span class="token comment">/* highlight-next-line */</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-30px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.ssh-pet.shift-left</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>'/images/shift-left-sprite.png'<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">background-repeat</span><span class="token punctuation">:</span> repeat-x<span class="token punctuation">;</span>
  <span class="token property">background-size</span><span class="token punctuation">:</span> 240px 30px<span class="token punctuation">;</span>
  <span class="token property">background-position</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>
  <span class="token property">animation</span><span class="token punctuation">:</span> ssh-pet-shift-left 0.8s <span class="token function">steps</span><span class="token punctuation">(</span>8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>In JavaScript, I tried to keep the position state inside an object:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> position <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">offsetPosition</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">updatePosition</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>x <span class="token operator">+</span> x<span class="token punctuation">,</span> position<span class="token punctuation">.</span>y <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  pet<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>So, to shift away from the cursor would be:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">animateShiftLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">shift-left</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">offsetPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>So, when the animation ends, the <code>transform: translateX()</code> will go from <code>-30px</code> back to <code>0</code>, and at the same time, I moved the position of the pet <code>-30px</code> in x-axis.</p>
<p>To know when the cursor is on top of the pet, I used <code>mousemove</code> event:</p>
<pre class="language-js"><code class="language-js">pet<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>animating<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    animating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">shiftAway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// edge avoidance shifting</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">shiftAway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">animateShiftRight</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span>x <span class="token operator">></span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">animateShiftLeft</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">animateShiftLeft</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">animateShiftRight</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To avoid reanimate while still animate, I added a <code>animating</code> flag, as an mutex.</p>
<p>Besides, it would be weird to see the pet shifting pass through the browser window, because that way, you would never be able to interact with it anymore ðŸ˜¢</p></section>
<section><h3><a href="#eating-the-characters" id="eating-the-characters">Eating the characters</a></h3>
<p>To know when someone is typing into any of the input box, I attach an <code>input</code> event listener on to the <code>document.body</code>:</p>
<pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">debounceByElement</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> eatInputValue<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>There maybe multiple <code>&lt;input /&gt;</code> on the page, so I created a debounce function for each <code>&lt;input /&gt;</code>.</p>
<p>To make the eating simple, I will always eat from the left, consuming characters from left to right:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">eatInputValue</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  elem<span class="token punctuation">.</span>value <span class="token operator">=</span> elem<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">debounceByElement</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> eatInputValue<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>However naively eating the characters this way, will screw up your cursor position / selection.
So I googled and pasted the code snippet to improve it:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">eatInputValue</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// highlight-start</span>
  <span class="token comment">// remember selection position</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> elem<span class="token punctuation">.</span>selectionStart<span class="token punctuation">,</span>
    end <span class="token operator">=</span> elem<span class="token punctuation">.</span>selectionEnd<span class="token punctuation">;</span>
  <span class="token comment">// highlight-end</span>
  elem<span class="token punctuation">.</span>value <span class="token operator">=</span> elem<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-start</span>
  <span class="token comment">// restore selection position</span>
  elem<span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-end</span>

  <span class="token function">debounceByElement</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> eatInputValue<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>After able to &quot;eat&quot; the characters, I need to animate the pet eating the characters</p>
<p><picture><source type="image/webp" srcset="434323b610ecc648.webp"><source type="image/jpeg" srcset="434323b610ecc648.png"><img title="Sprite Sheet for Eating" alt="spritesheet for eating" data-src="434323b610ecc648.png" loading="lazy"></picture></p>
<p>To align the eating with the removing of a character, I split the animation into 2 parts, <strong>the eating</strong> and <strong>the chewing</strong> <em>(I named it digesting during the hackathon)</em>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">eatInputValue</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// highlight-next-line</span>
  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'eat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> start <span class="token operator">=</span> elem<span class="token punctuation">.</span>selectionStart<span class="token punctuation">,</span>
    end <span class="token operator">=</span> elem<span class="token punctuation">.</span>selectionEnd<span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span>value <span class="token operator">=</span> elem<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-next-line</span>
  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'digest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">debounceByElement</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> eatInputValue<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To make it more realistic, I tried to make the pet tilt forward, while consuming the character:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> ssh-pet-eat-move</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%,
  30%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>4px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>The pixel values had been tuned to make the movement subtle, yet natural.</p>
<p>Now, how do I place my pet to the left of the input?</p>
<p>Instead of squiggle to the right position, I made the pet <strong>teleport</strong>!</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">animateTeleport</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'disappear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">updatePosition</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'reappear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To calculate the teleport destination, I used <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" rel="nofollow">getBoundingClientRect()</a>:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">leftSideOf</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> height <span class="token punctuation">&#125;</span> <span class="token operator">=</span> elem<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> to_x <span class="token operator">=</span> x <span class="token operator">-</span> pet<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token function">paddingLeft</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> to_y <span class="token operator">=</span> y <span class="token operator">+</span> height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> pet<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">paddingLeft</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">Number</span><span class="token punctuation">(</span>
      window
        <span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">'padding-left'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/px|r?em/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>The padding of the input is important. It brings the pet closer to the character it is going to eat. ðŸ¤¤</p></section>
<section><h3><a href="#annihilate-the-buttons" id="annihilate-the-buttons">Annihilate the buttons</a></h3>
<p>Pet don&#39;t like buttons because buttons take away your concentration from your pet.</p>
<p><picture><source type="image/webp" srcset="c6dea8fe414e2cab.webp"><source type="image/jpeg" srcset="c6dea8fe414e2cab.png"><img title="null" alt="Eys full of hatred" data-src="c6dea8fe414e2cab.png" loading="lazy"></picture></p>
<p>To get a list of buttons, I use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll" rel="nofollow">document.querySelectorAll()</a>:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> buttons <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'button, input[type="submit"], [role="button"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buttons<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">button</span> <span class="token operator">=></span>
  button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> mouseMove<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>To annihilate the buttons, I animated the pet with a pair of dead red eyes, and shake it for 400 milli-seconds, before annihilating the elements into vapor:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">removeTheElement</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>animating<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  animating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'hate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  elem<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> mouseMove<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">animateClass</span><span class="token punctuation">(</span><span class="token string">'item-disappearing'</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
  pet<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'hate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  animating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>I used <code>visibility: hidden</code>, so that I dont disrupt the DOM structure, yet making it disappear and unclickable, unlike <code>opacity: none</code>.</p>
<p>The pet with hatred is slightly bigger and agitated than the normal pet:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> hating</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.1<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-2px<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.1<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>2px<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.1<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-2px<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To turn the button annihilated into vapor, I used <code>filter: blur()</code>:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> item-disappearing</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">blur</span><span class="token punctuation">(</span>0px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">80%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">blur</span><span class="token punctuation">(</span>8px<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre></section>
<section><h2><a href="#difficulties" id="difficulties">Difficulties</a></h2></section>
<section><h3><a href="#synchronising-interactions" id="synchronising-interactions">Synchronising interactions</a></h3>
<p>A lot edge cases has been found and fixed by using the <code>animating</code>, or <code>eating</code> flag:</p>
<ul><li>where to avoid cursor, while eating the characters</li>
<li>to annihilate or to eat?
There&#39;s an heuristic to choose which one to do, when both get scheduled at the same time.</li></ul></section>
<section><h3><a href="#developing-locally" id="developing-locally">Developing locally</a></h3>
<p>Everytime when the content script is updated, I need to click refresh in the <code>chrome://extensions</code> page:</p>
<p><picture><source type="image/webp" srcset="a89d2417a7970cfd.webp"><source type="image/jpeg" srcset="a89d2417a7970cfd.png"><img title="null" alt="click refresh" data-src="a89d2417a7970cfd.png" loading="lazy"></picture></p>
<p>In order to developed faster, I created a simple HTML, and test it locally.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></section>
<section><h4><a href="#postcss-script" id="postcss-script">PostCSS script</a></h4>
<p>Remember I mentioned that, for resource to be accessible from the Chrome Extension, I would have to prepend the url with <code>chrome-extension://__MSG_@@extension_id__/</code>?</p>
<p>But that does not work if I developed in standalone HTML, because I can&#39;t access the assets from <code>chrome-extension://</code> protocol in my localhost.</p>
<p>I would have to write <code>/images/rest.png</code>, and replaced it to <code>chrome-extension://__MSG_@@extension_id__/images/rest.png</code> when I test it on my extension.</p>
<p>So, I wrote a simple script with <a href="https://postcss.org/" rel="nofollow">PostCSS</a> to automatically do it:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> postcss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../content.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> output <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../content-ext.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// watch when file change</span>
fs<span class="token punctuation">.</span><span class="token function">watchFile</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> css <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// NOTE: &#96;from: undefined&#96; to stop PostCSS complain about sourcemap</span>
  <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">[</span>replaceUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>css<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> result<span class="token punctuation">.</span>css<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">replaceUrl</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  root<span class="token punctuation">.</span><span class="token function">walkDecls</span><span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">,</span> <span class="token parameter">decl</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    decl<span class="token punctuation">.</span>value <span class="token operator">=</span> decl<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/url('(.*)')/</span><span class="token punctuation">,</span> <span class="token string">"url('chrome-extension://__MSG_@@extension_id__$1')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>I used <code>content.css</code> for my local development, and automatically built <code>content-ext.css</code> for the extension with all the URL replaced.</p></section>
<section><h2><a href="#demo" id="demo">Demo</a></h2>
<p>I did a super quick demo, which went quite well, <em>I think.</em> ðŸ¤”</p>
<p>For those who are curious, and want to try out, you can visit <a href="https://lihautan.com/browser-pet/" rel="nofollow">here for the demo</a>.</p>
<p>For those who are curious about the source code, can visit <a href="https://github.com/tanhauhau/browser-pet" rel="nofollow">the Github repo</a>.</p></section>
<section><h2><a href="#summary" id="summary">Summary</a></h2>
<p>It has been a fruitful event.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">And <a href="https://twitter.com/lihautan?ref_src=twsrc%5Etfw">@lihautan</a> wins a bag of tropical fruits <a href="https://t.co/CtQUBGOI7h">pic.twitter.com/CtQUBGOI7h</a></p>â€” Yishu See (@yishusee) <a href="https://twitter.com/yishusee/status/1205828141194727430?ref_src=twsrc%5Etfw">December 14, 2019</a></blockquote>
<p>Appreciate the organisers time and effort to make the Hackathon goes as smoothly as possible.</p>
<p>I managed to do something that I never really done before:</p>
<ul><li>CSS sprite sheet animation</li>
<li>Chrome Extension that interacts with the user and manipulates the DOM</li></ul>
<p>Hopefully I will partcipate the <a href="https://twitter.com/supersillyhack" rel="nofollow">Super Silly Hackathon</a> again next year.</p></section></article></main>

<footer class="svelte-9tqnza"><div class="form svelte-1k1s1co"><h1>Subscribe to my newsletter</h1>
  <h2 class="svelte-1k1s1co">Get the latest blog posts and project updates delivered right to your inbox</h2>
  <form action="https://buttondown.email/api/emails/embed-subscribe/lihautan" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lihautan', 'popupwindow')" class="embeddable-buttondown-form"><div class="form-item svelte-1k1s1co"><input type="email" name="email" id="bd-email" aria-label="email address" placeholder="youremail@example.com" class="svelte-1k1s1co">
      <input type="submit" value="Subscribe" disabled class="svelte-1k1s1co"></div>
    <input type="hidden" value="1" name="embed" class="svelte-1k1s1co">
    <p class="svelte-1k1s1co">Powered by Buttondown.</p></form>
</div>
  
</footer><script src="./8275970a.js" async></script></div>
  

  <script>if ('serviceWorker' in navigator) { window.addEventListener('load', function () { navigator.serviceWorker.register('/sw.js'); }); }</script>
  <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); if (typeof ga === "function") { ga('create', 'UA-135921142-1', 'auto', {}); }</script>
  <script>if ('loading' in HTMLImageElement.prototype) { const images = document.querySelectorAll('img[loading="lazy"]'); images.forEach(img => { img.src = img.dataset.src; }); } else { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js'; document.body.appendChild(script); }</script>
</body>

</html>