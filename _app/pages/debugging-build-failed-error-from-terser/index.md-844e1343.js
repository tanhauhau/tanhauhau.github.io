import{S as ji,i as Di,s as Si,C as yr,w as qi,x as Ri,y as Li,z as Hi,A as si,q as Mi,o as Ni,B as Vi,r as Bi,Y as ti,e as a,t,k as l,c as n,a as r,h as o,d as s,m as i,b as c,X as Gi,f as W,g as x,H as e,J as $i}from"../../chunks/vendor-da4388d4.js";import{B as Wi}from"../../chunks/BlogLayout-14cfab6f.js";import"../../chunks/stores-1fad7c36.js";import"../../chunks/ldjson-b0805387.js";/* empty css                                */var Fi="https://lihautan.com/_app/assets/github-blame-a7918c88.webp",Ui="https://lihautan.com/_app/assets/github-blame-3d247017.webp",zi="https://lihautan.com/_app/assets/github-blame-8703c3f9.png",oi="https://lihautan.com/_app/assets/github-blame-9514ce69.png",Ji="https://lihautan.com/_app/assets/hero-twitter-c4dc1746.jpg";function Ki(ke){let g,A,j,D,_,T,S,ni=`<pre class="prism language-"><code><span class="line">ERROR in bundle.xxxx.js from Terser</span>
<span class="line">undefined</span>
<span class="line"></span>
<span class="line">...</span>
<span class="line"></span>
<span class="line">Command failed with exit code 2</span>
<span class="line">Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</span>
<span class="line">Error: Command failed: yarn build</span></code></pre>`,lt,ue,Et,it,ve,vs,It,ct,v,ys,F,Tt,Ot,M,Ct,ye,Pt,At,fe,jt,Dt,St,me,ri=`<div class="filename">webpackConfig.prod.js</div><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">module</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">exports</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  plugins</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> [</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// disable terser first</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// new TerserPlugin(&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// 	terserOptions: &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">//     // ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">//   &#125;,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// &#125;),</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  ]</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;;</span></span></code></pre>`,qt,fs,Rt,Lt,ms,Ht,Mt,ge,li=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">terser</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">require</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;terser&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">fs</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">require</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;fs&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">require</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;path&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">input</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">fs</span><span style="color: var(--shiki-token-function)">.readFileSync</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.join</span><span style="color: var(--shiki-color-text)">(__dirname</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;dist/bundle.xxxx.js&#39;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-string-expression)">&#39;utf-8&#39;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">output</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">terser</span><span style="color: var(--shiki-token-function)">.minify</span><span style="color: var(--shiki-color-text)">(input</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...terser options</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(output);</span></span></code></pre>`,Nt,gs,Vt,Bt,we,ii=`<pre class="prism language-"><code><span class="line">&#123;</span>
<span class="line">  &quot;error&quot;:</span>
<span class="line">  TypeError: Cannot read property &#39;name&#39; of undefined</span>
<span class="line">      at A.f (node_modules/terser/dist/bundle.js:44:146028)</span>
<span class="line">      at D (node_modules/terser/dist/bundle.js:44:2863)</span>
<span class="line">      at A (node_modules/terser/dist/bundle.js:44:146075)</span>
<span class="line">      at k (node_modules/terser/dist/bundle.js:44:146998)</span>
<span class="line">      at vn (node_modules/terser/dist/bundle.js:44:133003)</span>
<span class="line">      at node_modules/terser/dist/bundle.js:44:165250</span>
<span class="line">      at AST_BlockStatement.optimize (node_modules/terser/dist/bundle.js:44:121400)</span>
<span class="line">      at Ct.before (node_modules/terser/dist/bundle.js:44:121157)</span>
<span class="line">      at AST_BlockStatement.transform (node_modules/terser/dist/bundle.js:44:78200)</span>
<span class="line">      at node_modules/terser/dist/bundle.js:44:78849</span>
<span class="line">&#125;</span></code></pre>`,Gt,_e,$t,ws,Wt,Ft,_s,Ut,zt,xe,be,Jt,Kt,Qt,xs,Xt,Yt,Ee,ci=`<pre class="prism language-"><code><span class="line">...</span>
<span class="line">s) &#125; else if (u instanceof Se &amp;&amp; r === u.expression &amp;&amp; (p(e, t, i, u, o = n(o, u.property), a + 1,</span>
<span class="line">  s + 1), o)) return; a &gt; 0 || u instanceof Be &amp;&amp; r !== u.tail_node() || u instanceof S ||</span>
<span class="line">(t.direct_access = !0) &#125; e(F, u); var d = new qn(function (e) &#123; if (e instanceof Je) &#123; var n =</span>
<span class="line">e.definition(); n &amp;&amp; (e instanceof hn &amp;&amp; n.references.push(e), n.fixed = !1) &#125; &#125;); function h(e, n,</span>
<span class="line">t) &#123; this.inlined = !1; var r = e.safe_ids; return e.safe_ids = Object.create(null), i(e, t, this),</span>
<span class="line">n(), e.safe_ids = r, !0 &#125; function m(e, n, t) &#123; var r, o = this; return o.inlined = !1, a(e), i(e,</span>
<span class="line">t, o), !o.name &amp;&amp; (r = e.parent()) instanceof ke &amp;&amp; r.expression === o &amp;&amp; o.argnames.forEach(</span>
<span class="line">function (n, t) &#123; if (n.definition) &#123; var i = n.definition(); void 0 !== i.fixed || o.uses_arguments</span>
<span class="line">&amp;&amp; !e.has_directive(&quot;use strict&quot;) ? i.fixed = !1 : (i.fixed = function () &#123; return r.args[t] || v(kn, r)</span>
<span class="line">...</span></code></pre>`,Zt,bs,eo,so,Es,to,pt,d,Is,U,oo,ao,Ts,no,ro,z,lo,Ie,io,co,po,N,ho,Te,ko,uo,Oe,vo,yo,fo,O,Os,mo,go,Ce,wo,_o,Pe,xo,bo,Ae,Eo,Io,To,Cs,Oo,Co,je,pi='<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Error</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#96;</span><span style="color: var(--shiki-token-keyword)">$&#123;</span><span style="color: var(--shiki-color-text)">file</span><span style="color: var(--shiki-token-keyword)">&#125;</span><span style="color: var(--shiki-token-string-expression)"> from Terser&#92;n</span><span style="color: var(--shiki-token-keyword)">$&#123;</span><span style="color: var(--shiki-token-constant)">err</span><span style="color: var(--shiki-color-text)">.message</span><span style="color: var(--shiki-token-keyword)">&#125;</span><span style="color: var(--shiki-token-string-expression)">&#96;</span><span style="color: var(--shiki-color-text)">);</span></span></code></pre>',Po,I,Ao,De,jo,Do,Se,So,qo,qe,Ro,Lo,Re,Ho,Mo,No,J,Vo,Le,Bo,Go,$o,He,Ps,Wo,Fo,Uo,K,Q,zo,X,Jo,Ko,Qo,As,Xo,Yo,Me,hi=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">someFunction</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (someConditionThatLeadsToErrorLaterOn) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">try</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">throw</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Error</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125; </span><span style="color: var(--shiki-token-keyword)">catch</span><span style="color: var(--shiki-color-text)"> (error) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(error);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre>`,Zo,js,ea,sa,Y,ta,Ne,oa,aa,na,Ve,di=`<pre class="prism language-"><code><span class="line">&#123;</span>
<span class="line">  &quot;error&quot;:</span>
<span class="line">  TypeError: Cannot read property &#39;name&#39; of undefined</span>
<span class="line">      at A.f (node_modules/terser/dist/bundle.js:44:146028)</span>
<span class="line">      at D (node_modules/terser/dist/bundle.js:44:2863)</span>
<span class="line">      at A (node_modules/terser/dist/bundle.js:44:146075)</span>
<span class="line">      at k (node_modules/terser/dist/bundle.js:44:146998)</span>
<span class="line">      at vn (node_modules/terser/dist/bundle.js:44:133003)</span>
<span class="line">      at node_modules/terser/dist/bundle.js:44:165250</span>
<span class="line">      at AST_BlockStatement.optimize (node_modules/terser/dist/bundle.js:44:121400)</span>
<span class="line">      at Ct.before (node_modules/terser/dist/bundle.js:44:121157)</span>
<span class="line">      at AST_BlockStatement.transform (node_modules/terser/dist/bundle.js:44:78200)</span>
<span class="line">      at node_modules/terser/dist/bundle.js:44:78849</span>
<span class="line">&#125;</span></code></pre>`,ra,Ds,la,ia,q,Ss,ca,pa,Be,ha,da,Ge,ka,ua,ht,k,qs,Z,va,ya,Rs,fa,ma,Ls,ga,wa,$e,ki=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> f </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">n</span><span style="color: var(--shiki-token-function)">.option</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;ecma&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">6</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">n</span><span style="color: var(--shiki-token-function)">.has_directive</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;use strict&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">?</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (e) &#123; </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">e</span><span style="color: var(--shiki-color-text)">.key</span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)">u </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">e</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name</span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)">u &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                                        </span><span style="color: var(--shiki-token-keyword)">^</span></span></code></pre>`,_a,Hs,xa,ba,ee,Ea,We,Ia,Ta,Oa,se,Ca,te,Pa,Aa,ja,C,Ms,Da,Sa,oe,qa,Ra,Fe,La,Ha,Ue,Ma,Na,Va,Ns,Ba,Ga,ae,$a,ze,Wa,Fa,Ua,Je,ui=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> diff </span><span style="color: var(--shiki-token-keyword)">=</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">compressor</span><span style="color: var(--shiki-token-function)">.option</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;ecma&#39;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">6</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">compressor</span><span style="color: var(--shiki-token-function)">.has_directive</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;use strict&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">?</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(node) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.key </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(node) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &#125;;</span></span></code></pre>`,za,Vs,Ja,Ka,ne,Qa,Ke,Xa,Ya,Za,Qe,vi=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> f </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">n</span><span style="color: var(--shiki-token-function)">.option</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;ecma&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">6</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">n</span><span style="color: var(--shiki-token-function)">.has_directive</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;use strict&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">?</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (e) &#123; </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-constant)">e</span><span style="color: var(--shiki-color-text)">.key) &#123; </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(e); &#125; </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">e</span><span style="color: var(--shiki-color-text)">.key</span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)">u</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">               </span><span style="color: var(--shiki-token-keyword)">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">e</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name</span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)">u &#125;</span></span></code></pre>`,en,b,sn,Xe,tn,on,Ye,an,nn,Ze,rn,ln,es,cn,pn,ss,hn,dn,ts,kn,un,vn,Bs,yn,dt,h,Gs,re,fn,mn,$s,gn,wn,Ws,_n,xn,os,yi=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">var</span><span style="color: var(--shiki-color-text)"> diff </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">compressor</span><span style="color: var(--shiki-token-function)">.option</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;ecma&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">2015</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">compressor</span><span style="color: var(--shiki-token-function)">.has_directive</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;use strict&quot;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">?</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(node) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.key </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.key </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125; </span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(node) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.key </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">node</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">key</span><span style="color: var(--shiki-color-text)">.name </span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-color-text)"> prop;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;;</span></span></code></pre>`,bn,$,as,En,In,ns,Tn,On,Cn,Fs,Pn,An,Us,jn,Dn,zs,Sn,qn,rs,Js,Rn,Ln,Hn,Ks,V,ls,Qs,P,fr,Mn,Xs,Nn,Vn,Ys,Zs,le,Bn,Gn,ie,$n,ce,Wn,Fn,Un,et,zn,Jn,R,is,Kn,Qn,cs,Xn,Yn,ps,Zn,er,sr,hs,fi=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">&quot;resolution&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">&quot;terser&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;3.17.0&quot;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre>`,tr,st,or,ar,tt,nr,kt,L,ot,pe,rr,lr,at,ir,cr,nt,pr;return{c(){g=a("p"),A=t("The following is a record of the steps I went through when debugging a build-time bug I encountered during work."),j=l(),D=a("p"),_=t("It all started with an error message during the build."),T=l(),S=a("div"),lt=l(),ue=a("p"),Et=t("What is wrong with Terser and our code?"),it=l(),ve=a("p"),vs=a("strong"),It=t("I must find the root cause of this!"),ct=l(),v=a("section"),ys=a("h2"),F=a("a"),Tt=t("Act I - The First Attempt"),Ot=l(),M=a("p"),Ct=t("We used Terser to minify our build code. It was part of our webpack pipeline, installed through "),ye=a("code"),Pt=t("terser-webpack-plugin"),At=t(". Since terser is throwing an error, so I disabled "),fe=a("code"),jt=t("terser-webpack-plugin"),Dt=t(" and build again."),St=l(),me=a("div"),qt=l(),fs=a("p"),Rt=t("Ok. The build was successful. Nothing wrong with the code nor the build."),Lt=l(),ms=a("p"),Ht=t("So, I run the terser manually:"),Mt=l(),ge=a("div"),Nt=l(),gs=a("p"),Vt=t("The console output an error that was cryptic"),Bt=l(),we=a("div"),Gt=l(),_e=a("p"),$t=t("I clicked into the terser source code to see what was going wrong over there. "),ws=a("em"),Wt=t("(Maybe it's my chance to contribute to terser?)"),Ft=l(),_s=a("p"),Ut=t("Little did I know, how wrong I could be."),zt=l(),xe=a("p"),be=a("code"),Jt=t("terser/dist/bundle.js"),Kt=t(" was a minified code and it wasn't meant for humans eyes \u{1F62D}"),Qt=l(),xs=a("p"),Xt=t("Allow me to share a small snippet of what I saw:"),Yt=l(),Ee=a("div"),Zt=l(),bs=a("p"),eo=t("At this point in time, I had another meeting to attend, so I stopped at this juncture."),so=l(),Es=a("p"),to=t("On my way there, I was thinking, well, maybe I should probe this later in another direction."),pt=l(),d=a("section"),Is=a("h2"),U=a("a"),oo=t("Act II - terser-webpack-plugin"),ao=l(),Ts=a("p"),no=t("After the meeting, I was thinking, well let me reenable the terser plugin, and try to probe through the plugin."),ro=l(),z=a("p"),lo=t("Remember the error message: "),Ie=a("code"),io=t('"ERROR in bundle.xxxx.js from Terser"'),co=t(" ?"),po=l(),N=a("p"),ho=t("I looked into the "),Te=a("code"),ko=t("node_modules/terser-webpack/plugin/dist/index.js"),uo=t(" and search for the word "),Oe=a("code"),vo=t('"from Terser"'),yo=t("."),fo=l(),O=a("p"),Os=a("strong"),mo=t("Tip:"),go=t(" Usually when you want to debug a library installed in "),Ce=a("code"),wo=t("node_modules"),_o=t(", you can first look at the "),Pe=a("code"),xo=t("package.json"),bo=t(", it usually has an entry called "),Ae=a("code"),Eo=t('"main"'),Io=t(" that tells you the entry file to first look into. The main file usually exports all the public API that you use, so it is a good place to start diving into."),To=l(),Cs=a("p"),Oo=t("So I found the line:"),Co=l(),je=a("div"),Po=l(),I=a("p"),Ao=t("After adding logs "),De=a("code"),jo=t("console.log(err)"),Do=t(" and run the build again, I realised the err is an empty object "),Se=a("code"),So=t("{}"),qo=t(", which explained why I saw "),qe=a("code"),Ro=t("undefined"),Lo=t(" after the "),Re=a("code"),Ho=t("ERROR in ... from Terser"),Mo=t("."),No=l(),J=a("p"),Vo=t("So, I slowly traced back the caller, and find out where this "),Le=a("code"),Bo=t("err"),Go=t(" object was initially created."),$o=l(),He=a("p"),Ps=a("strong"),Wo=t("Tip:"),Fo=t(" To trace the callers of a function that leads up to a certain state of your application, you can:"),Uo=l(),K=a("ul"),Q=a("li"),zo=t("Use a "),X=a("a"),Jo=t("conditional breakpoint"),Ko=t(" if you are debugging through a debugger"),Qo=l(),As=a("li"),Xo=t("Throw an error within a try catch"),Yo=l(),Me=a("div"),Zo=l(),js=a("p"),ea=t("This is especially useful if you are tracing an unfamiliar code, you can quickly get a call stack that leads up to the current condition."),sa=l(),Y=a("p"),ta=t("After tracing through the call stack, I ended up at the line where the "),Ne=a("code"),oa=t("terser-webpack-plugin"),aa=t(" calls the terser, and when I logged out the error, it shows:"),na=l(),Ve=a("div"),ra=l(),Ds=a("p"),la=t("So familiar! After an hour of tracing and debugging, I ended up at the same place."),ia=l(),q=a("p"),Ss=a("strong"),ca=t("Note:"),pa=t(" the error must have lost somewhere from the terser to the actual print out of "),Be=a("code"),ha=t("terser-webpack-plugin"),da=t(", it might have fixed in a later version of "),Ge=a("code"),ka=t("terser-webpack-plugin"),ua=t(", but I'm not sure of it yet. Anyone interested can help check."),ht=l(),k=a("section"),qs=a("h2"),Z=a("a"),va=t("Act III - Terser"),ya=l(),Rs=a("p"),fa=t("The circumstances left me with no choice. I needed to face the cryptic minified code."),ma=l(),Ls=a("p"),ga=t("Luckily VSCode still able to open the huge minified file, and able to set the cursor to the right line and column:"),wa=l(),$e=a("div"),_a=l(),Hs=a("p"),xa=t("(By the way, in the minified code, all the code is in one line. \u{1F926}\u200D\u2642\uFE0F)"),ba=l(),ee=a("p"),Ea=t("Well, this may seem like the right place to throw the "),We=a("code"),Ia=t(`"Cannot read property 'name' of undefined"`),Ta=t(" error."),Oa=l(),se=a("p"),Ca=t("To understand what is going on in this line, I cloned "),te=a("a"),Pa=t("terser"),Aa=t(", checked out to the version tag that was installed in our codebase, and tried to figure out where that line was in the original code."),ja=l(),C=a("p"),Ms=a("strong"),Da=t("Tip:"),Sa=t(" String, property and method names are usually the best marker to trace a "),oe=a("a"),qa=t("mangled code"),Ra=t(". Even though all the variables have mangled into a single character variable name, you can still clearly see the method "),Fe=a("code"),La=t("has_directive()"),Ha=t(" and the string "),Ue=a("code"),Ma=t('"use strict"'),Na=t("."),Va=l(),Ns=a("p"),Ba=t("Conversely, please don't write long windy property / method names, it doesn't mangle well."),Ga=l(),ae=a("p"),$a=t("So I global searched the keyword "),ze=a("code"),Wa=t('has_directive("use strict")'),Fa=t(" and landed with a small number of results, which I looked through every one of them and ended up with the following line:"),Ua=l(),Je=a("div"),za=l(),Vs=a("p"),Ja=t("Which I was and still am clueless of what this code was trying to do."),Ka=l(),ne=a("p"),Qa=t("So I did the most reasonable thing, add a "),Ke=a("code"),Xa=t("console.log(node)"),Ya=t("."),Za=l(),Qe=a("div"),en=l(),b=a("p"),sn=t("I found out that the "),Xe=a("code"),tn=t("node"),on=t(" is an object, that does not have a property "),Ye=a("code"),an=t("key"),nn=t(", which explains the error. And "),Ze=a("code"),rn=t("node"),ln=t(" has a property call "),es=a("code"),cn=t("name"),pn=t(" that has a value "),ss=a("code"),hn=t('"foobar"'),dn=t(", which I assumed is a variable name in our codebase. Luckily "),ts=a("code"),kn=t("foobar"),un=t(" wasn't commonly used in our codebase, and I managed to find only 1 instance of it, and astonishingly, the code was last changed 1 year ago!"),vn=l(),Bs=a("p"),yn=t("So Terser just decided to break, without a sign, on a line of code that was written 1 year ago. This is the life of a programmer."),dt=l(),h=a("section"),Gs=a("h2"),re=a("a"),fn=t("Final Act - The Resolution"),mn=l(),$s=a("p"),gn=t("I kind of concluded that the root cause was a Terser bug, (because I can't just change the code that wasn't touched for nearly 1 year for no good reason), so the obvious thing to do next was to figured out whether someone fixed it on Terser upstream."),wn=l(),Ws=a("p"),_n=t("So, I checked out the master branch of Terser, found out the code has changed to"),xn=l(),os=a("div"),bn=l(),$=a("p"),as=a("code"),En=t("node.key"),In=t(" is checked to be existed before checking "),ns=a("code"),Tn=t("node.key.name"),On=t(". What a simple patch!"),Cn=l(),Fs=a("p"),Pn=t("The next thing I needed to figure out was when was this fix landed, whether I can upgrade it."),An=l(),Us=a("p"),jn=t("The Terser in the codebase was one major version behind the latest Terser version, so, I was more reserved to upgrade to the latest version."),Dn=l(),zs=a("p"),Sn=t("The git blame for the line of code was for some code refactoring, so I went to Github to trace the blame."),qn=l(),rs=a("p"),Js=a("strong"),Rn=t("Tip:"),Ln=t(" Github blame has this very useful button, that allows you to view blame prior to the change."),Hn=l(),Ks=a("p"),V=a("span"),ls=a("picture"),Qs=a("source"),P=a("img"),Mn=l(),Xs=a("p"),Nn=t("A few blame traces later, I ended up with a commit that fixed the bug:"),Vn=l(),Ys=a("blockquote"),Zs=a("p"),le=a("a"),Bn=t("fix node.key crashing lib/compress by hytromo \xB7 Pull Request #286 \xB7 terser/terser"),Gn=l(),ie=a("p"),$n=t("By looking at the MR merged date, I found that the commit was landed in between "),ce=a("a"),Wn=t("v3.16.0 and v3.17.0"),Fn=t("."),Un=l(),et=a("p"),zn=t("v3.17.0 was a minor version bump for our codebase, so I assumed it has no breaking changes."),Jn=l(),R=a("p"),is=a("code"),Kn=t("terser"),Qn=t(" was installed as a dependency of "),cs=a("code"),Xn=t("terser-webpack-plugin"),Yn=t(", which we had no control on the terser version, so I added a resolution to our "),ps=a("code"),Zn=t("package.json"),er=t(":"),sr=l(),hs=a("div"),tr=l(),st=a("p"),or=t("After I upgraded terser, I build the code again."),ar=l(),tt=a("p"),nr=t("The build was successful! \u{1F389}"),kt=l(),L=a("section"),ot=a("h2"),pe=a("a"),rr=t("Closing Note"),lr=l(),at=a("p"),ir=t("As I was explaining all these to my colleague, I realised that should I upgraded the terser once I found out that it was a terser error, it would have fixed the bug as well. I wouldn't need to go through all these to end up in the same fix."),cr=l(),nt=a("p"),pr=t("Oh well. \u{1F937}\u200D\u2642\uFE0F"),this.h()},l(p){g=n(p,"P",{});var w=r(g);A=o(w,"The following is a record of the steps I went through when debugging a build-time bug I encountered during work."),w.forEach(s),j=i(p),D=n(p,"P",{});var mr=r(D);_=o(mr,"It all started with an error message during the build."),mr.forEach(s),T=i(p),S=n(p,"DIV",{class:!0});var mi=r(S);mi.forEach(s),lt=i(p),ue=n(p,"P",{});var gr=r(ue);Et=o(gr,"What is wrong with Terser and our code?"),gr.forEach(s),it=i(p),ve=n(p,"P",{});var wr=r(ve);vs=n(wr,"STRONG",{});var _r=r(vs);It=o(_r,"I must find the root cause of this!"),_r.forEach(s),wr.forEach(s),ct=i(p),v=n(p,"SECTION",{});var m=r(v);ys=n(m,"H2",{});var xr=r(ys);F=n(xr,"A",{href:!0,id:!0});var br=r(F);Tt=o(br,"Act I - The First Attempt"),br.forEach(s),xr.forEach(s),Ot=i(m),M=n(m,"P",{});var ds=r(M);Ct=o(ds,"We used Terser to minify our build code. It was part of our webpack pipeline, installed through "),ye=n(ds,"CODE",{class:!0});var Er=r(ye);Pt=o(Er,"terser-webpack-plugin"),Er.forEach(s),At=o(ds,". Since terser is throwing an error, so I disabled "),fe=n(ds,"CODE",{class:!0});var Ir=r(fe);jt=o(Ir,"terser-webpack-plugin"),Ir.forEach(s),Dt=o(ds," and build again."),ds.forEach(s),St=i(m),me=n(m,"DIV",{class:!0});var gi=r(me);gi.forEach(s),qt=i(m),fs=n(m,"P",{});var Tr=r(fs);Rt=o(Tr,"Ok. The build was successful. Nothing wrong with the code nor the build."),Tr.forEach(s),Lt=i(m),ms=n(m,"P",{});var Or=r(ms);Ht=o(Or,"So, I run the terser manually:"),Or.forEach(s),Mt=i(m),ge=n(m,"DIV",{class:!0});var wi=r(ge);wi.forEach(s),Nt=i(m),gs=n(m,"P",{});var Cr=r(gs);Vt=o(Cr,"The console output an error that was cryptic"),Cr.forEach(s),Bt=i(m),we=n(m,"DIV",{class:!0});var _i=r(we);_i.forEach(s),Gt=i(m),_e=n(m,"P",{});var hr=r(_e);$t=o(hr,"I clicked into the terser source code to see what was going wrong over there. "),ws=n(hr,"EM",{});var Pr=r(ws);Wt=o(Pr,"(Maybe it's my chance to contribute to terser?)"),Pr.forEach(s),hr.forEach(s),Ft=i(m),_s=n(m,"P",{});var Ar=r(_s);Ut=o(Ar,"Little did I know, how wrong I could be."),Ar.forEach(s),zt=i(m),xe=n(m,"P",{});var dr=r(xe);be=n(dr,"CODE",{class:!0});var jr=r(be);Jt=o(jr,"terser/dist/bundle.js"),jr.forEach(s),Kt=o(dr," was a minified code and it wasn't meant for humans eyes \u{1F62D}"),dr.forEach(s),Qt=i(m),xs=n(m,"P",{});var Dr=r(xs);Xt=o(Dr,"Allow me to share a small snippet of what I saw:"),Dr.forEach(s),Yt=i(m),Ee=n(m,"DIV",{class:!0});var xi=r(Ee);xi.forEach(s),Zt=i(m),bs=n(m,"P",{});var Sr=r(bs);eo=o(Sr,"At this point in time, I had another meeting to attend, so I stopped at this juncture."),Sr.forEach(s),so=i(m),Es=n(m,"P",{});var qr=r(Es);to=o(qr,"On my way there, I was thinking, well, maybe I should probe this later in another direction."),qr.forEach(s),m.forEach(s),pt=i(p),d=n(p,"SECTION",{});var y=r(d);Is=n(y,"H2",{});var Rr=r(Is);U=n(Rr,"A",{href:!0,id:!0});var Lr=r(U);oo=o(Lr,"Act II - terser-webpack-plugin"),Lr.forEach(s),Rr.forEach(s),ao=i(y),Ts=n(y,"P",{});var Hr=r(Ts);no=o(Hr,"After the meeting, I was thinking, well let me reenable the terser plugin, and try to probe through the plugin."),Hr.forEach(s),ro=i(y),z=n(y,"P",{});var ut=r(z);lo=o(ut,"Remember the error message: "),Ie=n(ut,"CODE",{class:!0});var Mr=r(Ie);io=o(Mr,'"ERROR in bundle.xxxx.js from Terser"'),Mr.forEach(s),co=o(ut," ?"),ut.forEach(s),po=i(y),N=n(y,"P",{});var ks=r(N);ho=o(ks,"I looked into the "),Te=n(ks,"CODE",{class:!0});var Nr=r(Te);ko=o(Nr,"node_modules/terser-webpack/plugin/dist/index.js"),Nr.forEach(s),uo=o(ks," and search for the word "),Oe=n(ks,"CODE",{class:!0});var Vr=r(Oe);vo=o(Vr,'"from Terser"'),Vr.forEach(s),yo=o(ks,"."),ks.forEach(s),fo=i(y),O=n(y,"P",{});var B=r(O);Os=n(B,"STRONG",{});var Br=r(Os);mo=o(Br,"Tip:"),Br.forEach(s),go=o(B," Usually when you want to debug a library installed in "),Ce=n(B,"CODE",{class:!0});var Gr=r(Ce);wo=o(Gr,"node_modules"),Gr.forEach(s),_o=o(B,", you can first look at the "),Pe=n(B,"CODE",{class:!0});var $r=r(Pe);xo=o($r,"package.json"),$r.forEach(s),bo=o(B,", it usually has an entry called "),Ae=n(B,"CODE",{class:!0});var Wr=r(Ae);Eo=o(Wr,'"main"'),Wr.forEach(s),Io=o(B," that tells you the entry file to first look into. The main file usually exports all the public API that you use, so it is a good place to start diving into."),B.forEach(s),To=i(y),Cs=n(y,"P",{});var Fr=r(Cs);Oo=o(Fr,"So I found the line:"),Fr.forEach(s),Co=i(y),je=n(y,"DIV",{class:!0});var bi=r(je);bi.forEach(s),Po=i(y),I=n(y,"P",{});var H=r(I);Ao=o(H,"After adding logs "),De=n(H,"CODE",{class:!0});var Ur=r(De);jo=o(Ur,"console.log(err)"),Ur.forEach(s),Do=o(H," and run the build again, I realised the err is an empty object "),Se=n(H,"CODE",{class:!0});var zr=r(Se);So=o(zr,"{}"),zr.forEach(s),qo=o(H,", which explained why I saw "),qe=n(H,"CODE",{class:!0});var Jr=r(qe);Ro=o(Jr,"undefined"),Jr.forEach(s),Lo=o(H," after the "),Re=n(H,"CODE",{class:!0});var Kr=r(Re);Ho=o(Kr,"ERROR in ... from Terser"),Kr.forEach(s),Mo=o(H,"."),H.forEach(s),No=i(y),J=n(y,"P",{});var vt=r(J);Vo=o(vt,"So, I slowly traced back the caller, and find out where this "),Le=n(vt,"CODE",{class:!0});var Qr=r(Le);Bo=o(Qr,"err"),Qr.forEach(s),Go=o(vt," object was initially created."),vt.forEach(s),$o=i(y),He=n(y,"P",{});var kr=r(He);Ps=n(kr,"STRONG",{});var Xr=r(Ps);Wo=o(Xr,"Tip:"),Xr.forEach(s),Fo=o(kr," To trace the callers of a function that leads up to a certain state of your application, you can:"),kr.forEach(s),Uo=i(y),K=n(y,"UL",{});var yt=r(K);Q=n(yt,"LI",{});var ft=r(Q);zo=o(ft,"Use a "),X=n(ft,"A",{href:!0,rel:!0});var Yr=r(X);Jo=o(Yr,"conditional breakpoint"),Yr.forEach(s),Ko=o(ft," if you are debugging through a debugger"),ft.forEach(s),Qo=i(yt),As=n(yt,"LI",{});var Zr=r(As);Xo=o(Zr,"Throw an error within a try catch"),Zr.forEach(s),yt.forEach(s),Yo=i(y),Me=n(y,"DIV",{class:!0});var Ei=r(Me);Ei.forEach(s),Zo=i(y),js=n(y,"P",{});var el=r(js);ea=o(el,"This is especially useful if you are tracing an unfamiliar code, you can quickly get a call stack that leads up to the current condition."),el.forEach(s),sa=i(y),Y=n(y,"P",{});var mt=r(Y);ta=o(mt,"After tracing through the call stack, I ended up at the line where the "),Ne=n(mt,"CODE",{class:!0});var sl=r(Ne);oa=o(sl,"terser-webpack-plugin"),sl.forEach(s),aa=o(mt," calls the terser, and when I logged out the error, it shows:"),mt.forEach(s),na=i(y),Ve=n(y,"DIV",{class:!0});var Ii=r(Ve);Ii.forEach(s),ra=i(y),Ds=n(y,"P",{});var tl=r(Ds);la=o(tl,"So familiar! After an hour of tracing and debugging, I ended up at the same place."),tl.forEach(s),ia=i(y),q=n(y,"P",{});var he=r(q);Ss=n(he,"STRONG",{});var ol=r(Ss);ca=o(ol,"Note:"),ol.forEach(s),pa=o(he," the error must have lost somewhere from the terser to the actual print out of "),Be=n(he,"CODE",{class:!0});var al=r(Be);ha=o(al,"terser-webpack-plugin"),al.forEach(s),da=o(he,", it might have fixed in a later version of "),Ge=n(he,"CODE",{class:!0});var nl=r(Ge);ka=o(nl,"terser-webpack-plugin"),nl.forEach(s),ua=o(he,", but I'm not sure of it yet. Anyone interested can help check."),he.forEach(s),y.forEach(s),ht=i(p),k=n(p,"SECTION",{});var f=r(k);qs=n(f,"H2",{});var rl=r(qs);Z=n(rl,"A",{href:!0,id:!0});var ll=r(Z);va=o(ll,"Act III - Terser"),ll.forEach(s),rl.forEach(s),ya=i(f),Rs=n(f,"P",{});var il=r(Rs);fa=o(il,"The circumstances left me with no choice. I needed to face the cryptic minified code."),il.forEach(s),ma=i(f),Ls=n(f,"P",{});var cl=r(Ls);ga=o(cl,"Luckily VSCode still able to open the huge minified file, and able to set the cursor to the right line and column:"),cl.forEach(s),wa=i(f),$e=n(f,"DIV",{class:!0});var Ti=r($e);Ti.forEach(s),_a=i(f),Hs=n(f,"P",{});var pl=r(Hs);xa=o(pl,"(By the way, in the minified code, all the code is in one line. \u{1F926}\u200D\u2642\uFE0F)"),pl.forEach(s),ba=i(f),ee=n(f,"P",{});var gt=r(ee);Ea=o(gt,"Well, this may seem like the right place to throw the "),We=n(gt,"CODE",{class:!0});var hl=r(We);Ia=o(hl,`"Cannot read property 'name' of undefined"`),hl.forEach(s),Ta=o(gt," error."),gt.forEach(s),Oa=i(f),se=n(f,"P",{});var wt=r(se);Ca=o(wt,"To understand what is going on in this line, I cloned "),te=n(wt,"A",{href:!0,rel:!0});var dl=r(te);Pa=o(dl,"terser"),dl.forEach(s),Aa=o(wt,", checked out to the version tag that was installed in our codebase, and tried to figure out where that line was in the original code."),wt.forEach(s),ja=i(f),C=n(f,"P",{});var G=r(C);Ms=n(G,"STRONG",{});var kl=r(Ms);Da=o(kl,"Tip:"),kl.forEach(s),Sa=o(G," String, property and method names are usually the best marker to trace a "),oe=n(G,"A",{href:!0,rel:!0});var ul=r(oe);qa=o(ul,"mangled code"),ul.forEach(s),Ra=o(G,". Even though all the variables have mangled into a single character variable name, you can still clearly see the method "),Fe=n(G,"CODE",{class:!0});var vl=r(Fe);La=o(vl,"has_directive()"),vl.forEach(s),Ha=o(G," and the string "),Ue=n(G,"CODE",{class:!0});var yl=r(Ue);Ma=o(yl,'"use strict"'),yl.forEach(s),Na=o(G,"."),G.forEach(s),Va=i(f),Ns=n(f,"P",{});var fl=r(Ns);Ba=o(fl,"Conversely, please don't write long windy property / method names, it doesn't mangle well."),fl.forEach(s),Ga=i(f),ae=n(f,"P",{});var _t=r(ae);$a=o(_t,"So I global searched the keyword "),ze=n(_t,"CODE",{class:!0});var ml=r(ze);Wa=o(ml,'has_directive("use strict")'),ml.forEach(s),Fa=o(_t," and landed with a small number of results, which I looked through every one of them and ended up with the following line:"),_t.forEach(s),Ua=i(f),Je=n(f,"DIV",{class:!0});var Oi=r(Je);Oi.forEach(s),za=i(f),Vs=n(f,"P",{});var gl=r(Vs);Ja=o(gl,"Which I was and still am clueless of what this code was trying to do."),gl.forEach(s),Ka=i(f),ne=n(f,"P",{});var xt=r(ne);Qa=o(xt,"So I did the most reasonable thing, add a "),Ke=n(xt,"CODE",{class:!0});var wl=r(Ke);Xa=o(wl,"console.log(node)"),wl.forEach(s),Ya=o(xt,"."),xt.forEach(s),Za=i(f),Qe=n(f,"DIV",{class:!0});var Ci=r(Qe);Ci.forEach(s),en=i(f),b=n(f,"P",{});var E=r(b);sn=o(E,"I found out that the "),Xe=n(E,"CODE",{class:!0});var _l=r(Xe);tn=o(_l,"node"),_l.forEach(s),on=o(E," is an object, that does not have a property "),Ye=n(E,"CODE",{class:!0});var xl=r(Ye);an=o(xl,"key"),xl.forEach(s),nn=o(E,", which explains the error. And "),Ze=n(E,"CODE",{class:!0});var bl=r(Ze);rn=o(bl,"node"),bl.forEach(s),ln=o(E," has a property call "),es=n(E,"CODE",{class:!0});var El=r(es);cn=o(El,"name"),El.forEach(s),pn=o(E," that has a value "),ss=n(E,"CODE",{class:!0});var Il=r(ss);hn=o(Il,'"foobar"'),Il.forEach(s),dn=o(E,", which I assumed is a variable name in our codebase. Luckily "),ts=n(E,"CODE",{class:!0});var Tl=r(ts);kn=o(Tl,"foobar"),Tl.forEach(s),un=o(E," wasn't commonly used in our codebase, and I managed to find only 1 instance of it, and astonishingly, the code was last changed 1 year ago!"),E.forEach(s),vn=i(f),Bs=n(f,"P",{});var Ol=r(Bs);yn=o(Ol,"So Terser just decided to break, without a sign, on a line of code that was written 1 year ago. This is the life of a programmer."),Ol.forEach(s),f.forEach(s),dt=i(p),h=n(p,"SECTION",{});var u=r(h);Gs=n(u,"H2",{});var Cl=r(Gs);re=n(Cl,"A",{href:!0,id:!0});var Pl=r(re);fn=o(Pl,"Final Act - The Resolution"),Pl.forEach(s),Cl.forEach(s),mn=i(u),$s=n(u,"P",{});var Al=r($s);gn=o(Al,"I kind of concluded that the root cause was a Terser bug, (because I can't just change the code that wasn't touched for nearly 1 year for no good reason), so the obvious thing to do next was to figured out whether someone fixed it on Terser upstream."),Al.forEach(s),wn=i(u),Ws=n(u,"P",{});var jl=r(Ws);_n=o(jl,"So, I checked out the master branch of Terser, found out the code has changed to"),jl.forEach(s),xn=i(u),os=n(u,"DIV",{class:!0});var Pi=r(os);Pi.forEach(s),bn=i(u),$=n(u,"P",{});var rt=r($);as=n(rt,"CODE",{class:!0});var Dl=r(as);En=o(Dl,"node.key"),Dl.forEach(s),In=o(rt," is checked to be existed before checking "),ns=n(rt,"CODE",{class:!0});var Sl=r(ns);Tn=o(Sl,"node.key.name"),Sl.forEach(s),On=o(rt,". What a simple patch!"),rt.forEach(s),Cn=i(u),Fs=n(u,"P",{});var ql=r(Fs);Pn=o(ql,"The next thing I needed to figure out was when was this fix landed, whether I can upgrade it."),ql.forEach(s),An=i(u),Us=n(u,"P",{});var Rl=r(Us);jn=o(Rl,"The Terser in the codebase was one major version behind the latest Terser version, so, I was more reserved to upgrade to the latest version."),Rl.forEach(s),Dn=i(u),zs=n(u,"P",{});var Ll=r(zs);Sn=o(Ll,"The git blame for the line of code was for some code refactoring, so I went to Github to trace the blame."),Ll.forEach(s),qn=i(u),rs=n(u,"P",{});var ur=r(rs);Js=n(ur,"STRONG",{});var Hl=r(Js);Rn=o(Hl,"Tip:"),Hl.forEach(s),Ln=o(ur," Github blame has this very useful button, that allows you to view blame prior to the change."),ur.forEach(s),Hn=i(u),Ks=n(u,"P",{});var Ml=r(Ks);V=n(Ml,"SPAN",{style:!0});var Nl=r(V);ls=n(Nl,"PICTURE",{});var vr=r(ls);Qs=n(vr,"SOURCE",{type:!0,srcset:!0}),P=n(vr,"IMG",{src:!0,srcset:!0,loading:!0,style:!0,alt:!0}),vr.forEach(s),Nl.forEach(s),Ml.forEach(s),Mn=i(u),Xs=n(u,"P",{});var Vl=r(Xs);Nn=o(Vl,"A few blame traces later, I ended up with a commit that fixed the bug:"),Vl.forEach(s),Vn=i(u),Ys=n(u,"BLOCKQUOTE",{});var Bl=r(Ys);Zs=n(Bl,"P",{});var Gl=r(Zs);le=n(Gl,"A",{href:!0,rel:!0});var $l=r(le);Bn=o($l,"fix node.key crashing lib/compress by hytromo \xB7 Pull Request #286 \xB7 terser/terser"),$l.forEach(s),Gl.forEach(s),Bl.forEach(s),Gn=i(u),ie=n(u,"P",{});var bt=r(ie);$n=o(bt,"By looking at the MR merged date, I found that the commit was landed in between "),ce=n(bt,"A",{href:!0,rel:!0});var Wl=r(ce);Wn=o(Wl,"v3.16.0 and v3.17.0"),Wl.forEach(s),Fn=o(bt,"."),bt.forEach(s),Un=i(u),et=n(u,"P",{});var Fl=r(et);zn=o(Fl,"v3.17.0 was a minor version bump for our codebase, so I assumed it has no breaking changes."),Fl.forEach(s),Jn=i(u),R=n(u,"P",{});var de=r(R);is=n(de,"CODE",{class:!0});var Ul=r(is);Kn=o(Ul,"terser"),Ul.forEach(s),Qn=o(de," was installed as a dependency of "),cs=n(de,"CODE",{class:!0});var zl=r(cs);Xn=o(zl,"terser-webpack-plugin"),zl.forEach(s),Yn=o(de,", which we had no control on the terser version, so I added a resolution to our "),ps=n(de,"CODE",{class:!0});var Jl=r(ps);Zn=o(Jl,"package.json"),Jl.forEach(s),er=o(de,":"),de.forEach(s),sr=i(u),hs=n(u,"DIV",{class:!0});var Ai=r(hs);Ai.forEach(s),tr=i(u),st=n(u,"P",{});var Kl=r(st);or=o(Kl,"After I upgraded terser, I build the code again."),Kl.forEach(s),ar=i(u),tt=n(u,"P",{});var Ql=r(tt);nr=o(Ql,"The build was successful! \u{1F389}"),Ql.forEach(s),u.forEach(s),kt=i(p),L=n(p,"SECTION",{});var us=r(L);ot=n(us,"H2",{});var Xl=r(ot);pe=n(Xl,"A",{href:!0,id:!0});var Yl=r(pe);rr=o(Yl,"Closing Note"),Yl.forEach(s),Xl.forEach(s),lr=i(us),at=n(us,"P",{});var Zl=r(at);ir=o(Zl,"As I was explaining all these to my colleague, I realised that should I upgraded the terser once I found out that it was a terser error, it would have fixed the bug as well. I wouldn't need to go through all these to end up in the same fix."),Zl.forEach(s),cr=i(us),nt=n(us,"P",{});var ei=r(nt);pr=o(ei,"Oh well. \u{1F937}\u200D\u2642\uFE0F"),ei.forEach(s),us.forEach(s),this.h()},h(){c(S,"class","code-section"),c(F,"href","#act-i-the-first-attempt"),c(F,"id","act-i-the-first-attempt"),c(ye,"class","inline"),c(fe,"class","inline"),c(me,"class","code-section"),c(ge,"class","code-section"),c(we,"class","code-section"),c(be,"class","inline"),c(Ee,"class","code-section"),c(U,"href","#act-ii-terser-webpack-plugin"),c(U,"id","act-ii-terser-webpack-plugin"),c(Ie,"class","inline"),c(Te,"class","inline"),c(Oe,"class","inline"),c(Ce,"class","inline"),c(Pe,"class","inline"),c(Ae,"class","inline"),c(je,"class","code-section"),c(De,"class","inline"),c(Se,"class","inline"),c(qe,"class","inline"),c(Re,"class","inline"),c(Le,"class","inline"),c(X,"href","https://blittle.github.io/chrome-dev-tools/sources/conditional-breakpoints.html"),c(X,"rel","nofollow"),c(Me,"class","code-section"),c(Ne,"class","inline"),c(Ve,"class","code-section"),c(Be,"class","inline"),c(Ge,"class","inline"),c(Z,"href","#act-iii-terser"),c(Z,"id","act-iii-terser"),c($e,"class","code-section"),c(We,"class","inline"),c(te,"href","https://github.com/terser/terser"),c(te,"rel","nofollow"),c(oe,"href","http://lisperator.net/uglifyjs/mangle"),c(oe,"rel","nofollow"),c(Fe,"class","inline"),c(Ue,"class","inline"),c(ze,"class","inline"),c(Je,"class","code-section"),c(Ke,"class","inline"),c(Qe,"class","code-section"),c(Xe,"class","inline"),c(Ye,"class","inline"),c(Ze,"class","inline"),c(es,"class","inline"),c(ss,"class","inline"),c(ts,"class","inline"),c(re,"href","#final-act-the-resolution"),c(re,"id","final-act-the-resolution"),c(os,"class","code-section"),c(as,"class","inline"),c(ns,"class","inline"),c(Qs,"type","image/webp"),c(Qs,"srcset",Ui+", "+Fi+" 2x"),Gi(P.src,fr=oi)||c(P,"src",fr),c(P,"srcset",oi+", "+zi+" 2x"),c(P,"loading","lazy"),W(P,"position","absolute"),W(P,"top","0"),W(P,"width","100%"),W(P,"height","100%"),c(P,"alt","Github: view blame prior to the change"),W(V,"display","block"),W(V,"position","relative"),W(V,"padding-top","29.585%"),W(V,"width","100%"),c(le,"href","https://github.com/terser/terser/pull/286"),c(le,"rel","nofollow"),c(ce,"href","https://github.com/terser/terser/compare/v3.16.0...v3.17.0"),c(ce,"rel","nofollow"),c(is,"class","inline"),c(cs,"class","inline"),c(ps,"class","inline"),c(hs,"class","code-section"),c(pe,"href","#closing-note"),c(pe,"id","closing-note")},m(p,w){x(p,g,w),e(g,A),x(p,j,w),x(p,D,w),e(D,_),x(p,T,w),x(p,S,w),S.innerHTML=ni,x(p,lt,w),x(p,ue,w),e(ue,Et),x(p,it,w),x(p,ve,w),e(ve,vs),e(vs,It),x(p,ct,w),x(p,v,w),e(v,ys),e(ys,F),e(F,Tt),e(v,Ot),e(v,M),e(M,Ct),e(M,ye),e(ye,Pt),e(M,At),e(M,fe),e(fe,jt),e(M,Dt),e(v,St),e(v,me),me.innerHTML=ri,e(v,qt),e(v,fs),e(fs,Rt),e(v,Lt),e(v,ms),e(ms,Ht),e(v,Mt),e(v,ge),ge.innerHTML=li,e(v,Nt),e(v,gs),e(gs,Vt),e(v,Bt),e(v,we),we.innerHTML=ii,e(v,Gt),e(v,_e),e(_e,$t),e(_e,ws),e(ws,Wt),e(v,Ft),e(v,_s),e(_s,Ut),e(v,zt),e(v,xe),e(xe,be),e(be,Jt),e(xe,Kt),e(v,Qt),e(v,xs),e(xs,Xt),e(v,Yt),e(v,Ee),Ee.innerHTML=ci,e(v,Zt),e(v,bs),e(bs,eo),e(v,so),e(v,Es),e(Es,to),x(p,pt,w),x(p,d,w),e(d,Is),e(Is,U),e(U,oo),e(d,ao),e(d,Ts),e(Ts,no),e(d,ro),e(d,z),e(z,lo),e(z,Ie),e(Ie,io),e(z,co),e(d,po),e(d,N),e(N,ho),e(N,Te),e(Te,ko),e(N,uo),e(N,Oe),e(Oe,vo),e(N,yo),e(d,fo),e(d,O),e(O,Os),e(Os,mo),e(O,go),e(O,Ce),e(Ce,wo),e(O,_o),e(O,Pe),e(Pe,xo),e(O,bo),e(O,Ae),e(Ae,Eo),e(O,Io),e(d,To),e(d,Cs),e(Cs,Oo),e(d,Co),e(d,je),je.innerHTML=pi,e(d,Po),e(d,I),e(I,Ao),e(I,De),e(De,jo),e(I,Do),e(I,Se),e(Se,So),e(I,qo),e(I,qe),e(qe,Ro),e(I,Lo),e(I,Re),e(Re,Ho),e(I,Mo),e(d,No),e(d,J),e(J,Vo),e(J,Le),e(Le,Bo),e(J,Go),e(d,$o),e(d,He),e(He,Ps),e(Ps,Wo),e(He,Fo),e(d,Uo),e(d,K),e(K,Q),e(Q,zo),e(Q,X),e(X,Jo),e(Q,Ko),e(K,Qo),e(K,As),e(As,Xo),e(d,Yo),e(d,Me),Me.innerHTML=hi,e(d,Zo),e(d,js),e(js,ea),e(d,sa),e(d,Y),e(Y,ta),e(Y,Ne),e(Ne,oa),e(Y,aa),e(d,na),e(d,Ve),Ve.innerHTML=di,e(d,ra),e(d,Ds),e(Ds,la),e(d,ia),e(d,q),e(q,Ss),e(Ss,ca),e(q,pa),e(q,Be),e(Be,ha),e(q,da),e(q,Ge),e(Ge,ka),e(q,ua),x(p,ht,w),x(p,k,w),e(k,qs),e(qs,Z),e(Z,va),e(k,ya),e(k,Rs),e(Rs,fa),e(k,ma),e(k,Ls),e(Ls,ga),e(k,wa),e(k,$e),$e.innerHTML=ki,e(k,_a),e(k,Hs),e(Hs,xa),e(k,ba),e(k,ee),e(ee,Ea),e(ee,We),e(We,Ia),e(ee,Ta),e(k,Oa),e(k,se),e(se,Ca),e(se,te),e(te,Pa),e(se,Aa),e(k,ja),e(k,C),e(C,Ms),e(Ms,Da),e(C,Sa),e(C,oe),e(oe,qa),e(C,Ra),e(C,Fe),e(Fe,La),e(C,Ha),e(C,Ue),e(Ue,Ma),e(C,Na),e(k,Va),e(k,Ns),e(Ns,Ba),e(k,Ga),e(k,ae),e(ae,$a),e(ae,ze),e(ze,Wa),e(ae,Fa),e(k,Ua),e(k,Je),Je.innerHTML=ui,e(k,za),e(k,Vs),e(Vs,Ja),e(k,Ka),e(k,ne),e(ne,Qa),e(ne,Ke),e(Ke,Xa),e(ne,Ya),e(k,Za),e(k,Qe),Qe.innerHTML=vi,e(k,en),e(k,b),e(b,sn),e(b,Xe),e(Xe,tn),e(b,on),e(b,Ye),e(Ye,an),e(b,nn),e(b,Ze),e(Ze,rn),e(b,ln),e(b,es),e(es,cn),e(b,pn),e(b,ss),e(ss,hn),e(b,dn),e(b,ts),e(ts,kn),e(b,un),e(k,vn),e(k,Bs),e(Bs,yn),x(p,dt,w),x(p,h,w),e(h,Gs),e(Gs,re),e(re,fn),e(h,mn),e(h,$s),e($s,gn),e(h,wn),e(h,Ws),e(Ws,_n),e(h,xn),e(h,os),os.innerHTML=yi,e(h,bn),e(h,$),e($,as),e(as,En),e($,In),e($,ns),e(ns,Tn),e($,On),e(h,Cn),e(h,Fs),e(Fs,Pn),e(h,An),e(h,Us),e(Us,jn),e(h,Dn),e(h,zs),e(zs,Sn),e(h,qn),e(h,rs),e(rs,Js),e(Js,Rn),e(rs,Ln),e(h,Hn),e(h,Ks),e(Ks,V),e(V,ls),e(ls,Qs),e(ls,P),e(h,Mn),e(h,Xs),e(Xs,Nn),e(h,Vn),e(h,Ys),e(Ys,Zs),e(Zs,le),e(le,Bn),e(h,Gn),e(h,ie),e(ie,$n),e(ie,ce),e(ce,Wn),e(ie,Fn),e(h,Un),e(h,et),e(et,zn),e(h,Jn),e(h,R),e(R,is),e(is,Kn),e(R,Qn),e(R,cs),e(cs,Xn),e(R,Yn),e(R,ps),e(ps,Zn),e(R,er),e(h,sr),e(h,hs),hs.innerHTML=fi,e(h,tr),e(h,st),e(st,or),e(h,ar),e(h,tt),e(tt,nr),x(p,kt,w),x(p,L,w),e(L,ot),e(ot,pe),e(pe,rr),e(L,lr),e(L,at),e(at,ir),e(L,cr),e(L,nt),e(nt,pr)},p:$i,d(p){p&&s(g),p&&s(j),p&&s(D),p&&s(T),p&&s(S),p&&s(lt),p&&s(ue),p&&s(it),p&&s(ve),p&&s(ct),p&&s(v),p&&s(pt),p&&s(d),p&&s(ht),p&&s(k),p&&s(dt),p&&s(h),p&&s(kt),p&&s(L)}}}function Qi(ke){let g,A;const j=[ke[0],ai];let D={$$slots:{default:[Ki]},$$scope:{ctx:ke}};for(let _=0;_<j.length;_+=1)D=yr(D,j[_]);return g=new Wi({props:D}),{c(){qi(g.$$.fragment)},l(_){Ri(g.$$.fragment,_)},m(_,T){Li(g,_,T),A=!0},p(_,[T]){const S=T&1?Hi(j,[T&1&&si(_[0]),T&0&&si(ai)]):{};T&2&&(S.$$scope={dirty:T,ctx:_}),g.$set(S)},i(_){A||(Mi(g.$$.fragment,_),A=!0)},o(_){Ni(g.$$.fragment,_),A=!1},d(_){Vi(g,_)}}}const ai={title:"Debugging Story: Build failed, error from Terser",date:"2020-01-08T08:00:00Z",tags:["debugging"],description:"It all started with an error message during the build: 'ERROR in bundle.xxx.js from Terser'.",label:"blog",tableOfContents:[{link:"act-i-the-first-attempt",title:"Act I - The First Attempt"},{link:"act-ii-terser-webpack-plugin",title:"Act II - terser-webpack-plugin"},{link:"act-iii-terser",title:"Act III - Terser"},{link:"final-act-the-resolution",title:"Final Act - The Resolution"},{link:"closing-note",title:"Closing Note"}]};function Xi(ke,g,A){return Bi("blog",{image:Ji}),ke.$$set=j=>{A(0,g=yr(yr({},g),ti(j)))},g=ti(g),[g]}class oc extends ji{constructor(g){super();Di(this,g,Xi,Qi,Si,{})}}export{oc as default,ai as metadata};
