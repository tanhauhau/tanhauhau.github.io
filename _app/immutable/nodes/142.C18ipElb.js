import"../chunks/Bzak7iHL.js";import"../chunks/kfVmCPsV.js";import{p as y,g,d as v,b as u,s as t,f,a as m,e as n,r}from"../chunks/C2PHntuy.js";import{h as i}from"../chunks/C3QlhiH-.js";import{i as w}from"../chunks/BQOOHHT8.js";import{l as b,s as x}from"../chunks/gzNpScmH.js";import{B as j}from"../chunks/B1caYEk9.js";import{t as _}from"../chunks/C3bQ3Oc7.js";const l={title:"Who accessed my property?",date:"2019-03-24T08:00:00Z",description:"How to know when object property get accessed or modified",label:"blog"},{title:z,date:E,description:I,label:B}=l;var $=u(`<p>Say you defined an object <code class="inline">const obj = &#123; awesome: true &#125;</code> so that anywhere within your code, you can access the value of <code class="inline">obj.awesome</code> as well as modify its value via <code class="inline">obj.awesome = false</code>.</p> <p><strong>Question</strong>: How do you know where and when <code class="inline">obj.awesome</code> is being accessed or modified?</p> <hr/> <p><strong>So why is this important?</strong> If you are using frontend framework that does <a href="https://stackoverflow.com/a/13504965" rel="nofollow">2-way binding</a>, eg: <a href="https://angular.io/guide/ajs-quick-reference#ng-model" rel="nofollow">Angular</a>, <a href="https://vuejs.org/v2/guide/forms.html" rel="nofollow">Vue</a>, do you know how does the framework “watch” your <code class="inline">state</code> object? How does the framework knows when to update your DOM when you set some property of the <code class="inline">state</code> object?</p> <div class="code-section"><!></div> <hr/> <p><strong>Answer:</strong> You use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" rel="nofollow"><code class="inline">Object.defineProperty()</code></a>.</p> <p><code class="inline">Object.defineProperty(obj, prop, descriptor)</code> allows us to define a property to an object with a descriptor for the property being defined.</p> <p>Well, nothing special about defining a property of an object, you can do it easily with <code class="inline">obj[prop] = value</code>. What so special about this <code class="inline">Object.defineProperty()</code> is the <code class="inline">descriptor</code> object that you pass in. Lets' take a look at what can be configured through the <code class="inline">descriptor</code>:</p> <ul><li><p><code class="inline">enumerable</code></p> <p><code class="inline">true</code> if and only if this property shows up during enumeration of the properties on the corresponding object.</p> <p><strong>Defaults to <code class="inline">false</code></strong>.</p> <p>If you have a property's <code class="inline">enumerable</code> set to <code class="inline">false</code>, meaning you will not see the property when you do <code class="inline">Object.keys(obj)</code> or <code class="inline">for (const key in obj) &#123; ... &#125;</code></p></li> <li><p><code class="inline">writable</code></p> <p><code class="inline">true</code> if and only if the value associated with the property may be changed with an assignment operator.</p> <p><strong>Defaults to <code class="inline">false</code></strong></p> <p>This allows us to create <code class="inline">read-only</code> property of an object.</p></li> <li><p><code class="inline">get</code></p> <p>A function which serves as a getter for the property, or <code class="inline">undefined</code> if there is no getter. The return value will be used as the value of the property.</p> <p><strong>Defaults to <code class="inline">undefined</code></strong></p></li> <li><p><code class="inline">set</code></p> <p>A function which serves as a setter for the property, or <code class="inline">undefined</code> if there is no setter. When the property is assigned to, this function is called with one argument (the value being assigned to the property).</p> <p><strong>Defaults to <code class="inline">undefined</code></strong></p></li></ul> <p>So, there you have it. What you need is to define the getter and setter function of the property, and they will be called when the property is accessed or being assigned to a value.</p> <p>You can add a breakpoint via <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger" rel="nofollow"><code class="inline">debugger;</code></a> in your getter and setter function, to invoke the debugging feature of your development tools to look at the call stack.</p> <p>Another way of looking at the call stack without using a debugger is to <strong>throw an Error</strong> in the getter and setter function.</p> <p>Yes. You hear me right. Throwing an error will allow you to get the call stack when the error is thrown:</p> <div class="code-section"><!></div>`,1);function J(c,o){const p=b(o,["children","$$slots","$$events","$$legacy"]);y(o,!1),g("blog",{image:_}),w(),j(c,x(()=>p,()=>l,{children:(h,O)=>{var e=$(),s=t(f(e),8),d=n(s);i(d,()=>`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// setting a property in the &#96;$scope&#96; object triggers</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// the framework to update the model and the DOM</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">$scope</span><span style="color: var(--shiki-color-text)">.name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Hello&#39;</span><span style="color: var(--shiki-color-text)">;</span></span></code></pre>`),r(s);var a=t(s,20),k=n(a);i(k,()=>`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> _value;</span></span>
<span class="line dim"><span style="color: var(--shiki-token-constant)">Object</span><span style="color: var(--shiki-token-function)">.defineProperty</span><span style="color: var(--shiki-color-text)">(obj</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;awesome&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">get</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">try</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// intentionally throw an Error to get the call stack</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">throw</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Error</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    &#125; </span><span style="color: var(--shiki-token-keyword)">catch</span><span style="color: var(--shiki-color-text)"> (error) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// stack is the stack trace, </span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// containing error message and the stack</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">stack</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">error</span><span style="color: var(--shiki-color-text)">.stack;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-comment)">// print the callee stack</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-constant)">console</span><span style="color: var(--shiki-token-function)">.log</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        stack</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">.split</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;&#92;n&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">.slice</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-function)">.join</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;&#92;n&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      );</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> _value;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;);</span></span></code></pre>`),r(a),m(h,e)},$$slots:{default:!0}})),v()}export{J as component};
