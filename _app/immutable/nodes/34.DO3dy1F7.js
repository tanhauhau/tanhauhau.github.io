import"../chunks/Bzak7iHL.js";import"../chunks/kfVmCPsV.js";import{p as m,g as w,d as f,b as g,s,f as b,e as o,a as R,r as e,n as C}from"../chunks/C2PHntuy.js";import{h as t}from"../chunks/C3QlhiH-.js";import{i as j}from"../chunks/BQOOHHT8.js";import{l as T,s as _}from"../chunks/gzNpScmH.js";import{B as q}from"../chunks/B1caYEk9.js";import{t as P}from"../chunks/C3bQ3Oc7.js";const k={title:"Dynamically load reducers for code splitting in a React Redux application",date:"2017-11-16T08:00:00Z",description:"How to inject reducer asynchronously",label:"blog",tableOfContents:[{link:"context",title:"Context"},{link:"problem",title:"Problem"},{link:"solution",title:"Solution"}]},{title:E,date:L,description:M,label:U,tableOfContents:Y}=k;var S=g('<blockquote><p>This article assumes you have basic knowledge on React and Redux. If you like to learn more about React or Redux, you can go here to learn more.</p></blockquote> <hr/> <section><h2><a href="#context" id="context">Context</a></h2> <p>A common pattern to write a React Redux application is to have:</p> <ul><li>a <code class="inline">rootReducer</code> that imports <strong>all the reducers</strong> that will be used in the application</li> <li>a <code class="inline">reduxStore</code> that is created using <code class="inline">rootReducer</code></li> <li>the React application</li> <li><a href="https://github.com/reduxjs/react-redux" rel="nofollow">react-redux</a> that bridge React components and Redux together</li></ul> <p>This is what its going to be look like in code:</p> <div class="code-section"><!></div></section> <section><h2><a href="#problem" id="problem">Problem</a></h2> <p>Everything seemed perfect, until your app size increases too fastâ€¦</p> <p>It takes much longer time to load your web app, and things got worse with a crappy internet speedâ€¦</p></section> <section><h2><a href="#solution" id="solution">Solution</a></h2> <p>I know you <a href="http://lmgtfy.com/?q=code-splitting" rel="nofollow">must have googled for the solution online.</a> ðŸ˜‰</p> <p>So, lets talk about one of the solutions that you can do to make your app bundle smaller â€Šâ€” <a href="https://webpack.js.org/guides/code-splitting/" rel="nofollow">â€Šcode splitting using webpack</a>!</p> <blockquote><p>Code splitting is one of the most compelling features of webpack. This feature allows you to split your code into various bundles which can then be loaded on demand or in parallel. It can be used to achieve smaller bundles and control resource load prioritization which, if used correctly, can have a major impact on load time.â€Šâ€”<a href="https://webpack.js.org/guides/code-splitting/" rel="nofollow">â€Šwebpack</a></p></blockquote> <p>Great! Webpack provides <a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" rel="nofollow">import()</a> syntax, that conforms to the <a href="https://github.com/tc39/proposal-dynamic-import" rel="nofollow">ECMAScript proposal</a> for dynamic imports. Letâ€™s try to split our code <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/code-splitting.md" rel="nofollow">based on different entry points of your routes</a>. This makes perfect sense, user that goes to <code class="inline">mywebsite/foo</code> do not need code that is written only for <code class="inline">mywebsite/bar</code>!</p> <p>By now, you should realise, reducer that is written only for <code class="inline">mywebsite/bar</code>, shouldnâ€™t be imported or included when you are visiting <code class="inline">mywebsite/foo</code>!</p> <blockquote><p>Then how do I dynamically load reducers for code splitting in a Redux application?</p></blockquote> <p>Thatâ€™s a <a href="https://stackoverflow.com/questions/32968016/how-to-dynamically-load-reducers-for-code-splitting-in-a-redux-application" rel="nofollow">StackOverflow thread</a> that you should read about.</p> <blockquote><p>There may be neater way of expressing thisâ€Šâ€”â€ŠIâ€™m just showing the idea.</p></blockquote> <p>Yes, one of a neater way is to write a higher order component that takes care of dynamically loading of reducers.</p> <div class="code-section"><!></div> <p><a href="https://www.npmjs.com/package/inducer" rel="nofollow">inducer</a> (read: <strong>In</strong>ject Re<strong>ducer</strong>) gives you a HOC that will add you reducer to the Redux store that is currently using during <code class="inline">componentWillMount</code> and remove it during <code class="inline">componentWillUnmount</code>. Itâ€™s that simple!</p> <blockquote><p>So, how does inducer actually works?</p></blockquote> <p>Firstly, inducer HOC gets the store from context, provided from the StoreProvider of <code class="inline">react-redux</code> .</p> <div class="code-section"><!></div> <p>Next, inducer HOC comes up with the new async root reducer that includes the reducer you want to include, and use <a href="https://redux.js.org/api/store#replaceReducer" rel="nofollow">replaceReducer</a> from Redux to updates the reducer.</p> <p>When <code class="inline">componentWillUnmount</code> inducer will remove your reducer and call <code class="inline">replaceReducer</code> again!</p> <p>You can read the <a href="https://github.com/tanhauhau/inducer/blob/master/src/index.js" rel="nofollow">complete code</a> here!</p></section>',1);function F(h,r){const y=T(r,["children","$$slots","$$events","$$legacy"]);m(r,!1),w("blog",{image:P}),j(),q(h,_(()=>y,()=>k,{children:(d,I)=>{var l=S(),a=s(b(l),4),i=s(o(a),8),v=o(i);t(v,()=>`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// root.js</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> React </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;react&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> &#123; Provider &#125; </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;react-redux&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> &#123; store &#125; </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-string-expression)">&#39;./store&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> CustomComponent </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./CustomComponent&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> (</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// react-redux provider to provide the store in React context</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &lt;</span><span style="color: var(--shiki-token-constant)">Provider</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">store</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">&#123;store&#125;&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">      &lt;</span><span style="color: var(--shiki-token-constant)">CustomComponent</span><span style="color: var(--shiki-color-text)"> /&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    &lt;/</span><span style="color: var(--shiki-token-constant)">Provider</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  );</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// store.js</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> &#123; createStore</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> combineReducers &#125; </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;redux&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// import all your reducers here</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> reducerA </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./reducerA&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> reducerB </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./reducerB&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> reducerC </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./reducerC&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// combine all your reducers here</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">rootReducer</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">combineReducers</span><span style="color: var(--shiki-color-text)">(&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  reducerA</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> reducerA</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  reducerB</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> reducerB</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  reducerC</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> reducerC</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// create the redux store!</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">store</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">createStore</span><span style="color: var(--shiki-color-text)">(rootReducer);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// CustomComponent.js</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> React </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;react&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> &#123; connect &#125; </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;react-redux&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">CustomComponent</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &lt;</span><span style="color: var(--shiki-token-string-expression)">div</span><span style="color: var(--shiki-color-text)">&gt;&lt;/</span><span style="color: var(--shiki-token-string-expression)">div</span><span style="color: var(--shiki-color-text)">&gt;;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mapStateToProps</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> state </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123; </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;&#125;; &#125;;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mapDispatchToProps</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dispatch </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> ( return &#123;&#125;; &#125;;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">export default </span><span style="color: var(--shiki-token-function)">connect</span><span style="color: var(--shiki-color-text)">(mapStateToProps</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> mapDispatchToProps)(CustomComponent);</span></span></code></pre>`),e(i),e(a);var p=s(a,4),n=s(o(p),20),u=o(n);t(u,()=>`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> React </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;react&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> gameReducer </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./gameReducer&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> injectReducer </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;inducer&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">CustomComponent</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">React</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-function)">Component</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// component logic here</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">injectReducer</span><span style="color: var(--shiki-color-text)">(&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  game</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> gameReducer</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;)(CustomComponent);</span></span></code></pre>`),e(n);var c=s(n,8),x=o(c);t(x,()=>`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">InjectReducer</span><span style="color: var(--shiki-color-text)">.contextTypes </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  store</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">PropTypes</span><span style="color: var(--shiki-token-function)">.shape</span><span style="color: var(--shiki-color-text)">(&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     replaceReducer</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">PropTypes</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">func</span><span style="color: var(--shiki-color-text)">.isRequired</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;;</span></span></code></pre>`),e(c),C(6),e(p),R(d,l)},$$slots:{default:!0}})),f()}export{F as component};
