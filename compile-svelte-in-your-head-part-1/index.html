<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
  	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
	  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
		<link href="https://twitter.com/lihautan" rel="me" />
  	<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#bd93f9" />
		<link rel="apple-touch-icon" sizes="48x48" href="/icon-48x48.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="/icon-256x256.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />
		<link rel="icon" href="/icon-48x48.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
		<link rel="preload"
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&display=swap" as="style"
			onload="this.rel='stylesheet'">
		<link rel="alternate" type="application/rss+xml" title="Tan Li Hau&#x27;s RSS Feed" href="/rss.xml"/>
		<link rel="sitemap" type="application/xml" href="/sitemap.xml"/>
		<link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
		<link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
		<meta http-equiv="content-security-policy" content=""><title>Compile Svelte in your head (Part 1) | Tan Li Hau</title><meta name="description" content="BackgroundA while ago, @swyx came back to Singapore and visited us in Shopee Singapore (We&#39;re hiring!).He gave an amazing sharing on Compile Svelte in Your Head (video) in the ReactKnowledgeable Originals..." data-svelte="svelte-1vzsqtc"><meta name="image" content="/_app/assets/hero-twitter-5d88ede6.jpg" data-svelte="svelte-1vzsqtc"><meta name="og:image" content="/_app/assets/hero-twitter-5d88ede6.jpg" data-svelte="svelte-1vzsqtc"><meta name="og:title" content="Compile Svelte in your head (Part 1)" data-svelte="svelte-1vzsqtc"><meta name="og:description" content="BackgroundA while ago, @swyx came back to Singapore and visited us in Shopee Singapore (We&#39;re hiring!).He gave an amazing sharing on Compile Svelte in Your Head (video) in the ReactKnowledgeable Originals..." data-svelte="svelte-1vzsqtc"><meta name="og:type" content="website" data-svelte="svelte-1vzsqtc"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-1vzsqtc"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-1vzsqtc"><meta name="twitter:title" content="Compile Svelte in your head (Part 1)" data-svelte="svelte-1vzsqtc"><meta name="twitter:description" content="BackgroundA while ago, @swyx came back to Singapore and visited us in Shopee Singapore (We&#39;re hiring!).He gave an amazing sharing on Compile Svelte in Your Head (video) in the ReactKnowledgeable Originals..." data-svelte="svelte-1vzsqtc"><meta name="twitter:image" content="/_app/assets/hero-twitter-5d88ede6.jpg" data-svelte="svelte-1vzsqtc"><meta name="keywords" content="Svelte" data-svelte="svelte-1vzsqtc"><meta name="keywords" content="JavaScript" data-svelte="svelte-1vzsqtc"><meta itemprop="url" content="https://lihautan.com/compile-svelte-in-your-head-part-1/" data-svelte="svelte-1vzsqtc"><meta itemprop="image" content="/_app/assets/hero-twitter-5d88ede6.jpg" data-svelte="svelte-1vzsqtc">
	<link rel="stylesheet" href="/_app/assets/vendor-cb7fd1e3.css">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-b5830581.css">
	<link rel="stylesheet" href="/_app/assets/Links-79a96fb3.css">
	<link rel="stylesheet" href="/_app/assets/code-snippet-26cb7d8f.css">
	<link rel="stylesheet" href="/_app/assets/BlogLayout-3d74e761.css">
	<link rel="stylesheet" href="/_app/assets/TableOfContent-d81547d1.css">
	<link rel="modulepreload" href="/_app/start-a7ad3b52.js">
	<link rel="modulepreload" href="/_app/chunks/vendor-9710682b.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-6b949870.js">
	<link rel="modulepreload" href="/_app/chunks/stores-f9c97213.js">
	<link rel="modulepreload" href="/_app/chunks/Links-05f4c4db.js">
	<link rel="modulepreload" href="/_app/pages/compile-svelte-in-your-head-part-1/index.md-89713c9b.js">
	<link rel="modulepreload" href="/_app/chunks/BlogLayout-9a08402e.js">
	<link rel="modulepreload" href="/_app/chunks/TableOfContent-2fa6a472.js">
	</head>
	<body>
		<div id="svelte">




<a href="#content" class="skip svelte-1x8iuzz">Skip to content</a>

	<header class="svelte-1x8iuzz"><nav><ul class="mode-sidebar svelte-2qf5mw"><li class="svelte-2qf5mw"><a href="/" class="svelte-2qf5mw">Tan Li Hau</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/about" class="svelte-2qf5mw">About</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/blogs" class="svelte-2qf5mw">Writings</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/talks" class="svelte-2qf5mw">Talks</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/notes" class="svelte-2qf5mw">Notes</a></li>
	<li class="desktop svelte-2qf5mw"><a sveltekit:prefetch href="/newsletter" class="svelte-2qf5mw">Newsletter</a></li>
	<li class="social svelte-2qf5mw"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
  10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
  4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
		<a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
  0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
  5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
  5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
  3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
		<a aria-label="YouTube account" href="https://youtube.com/c/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 461.001 461.001" width="1em" height="1em" class="svelte-2qf5mw"><path d="M365.257 67.393H95.744C42.866 67.393 0 110.259 0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878 0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zm-64.751 169.663-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881c3.748 1.899 3.683 7.274-.109 9.082z"></path></svg></a></li>
</ul></nav></header>

	<div class="sidebar svelte-s9hlkv"><div class="float svelte-s9hlkv"><svg viewBox="0 0 30 50" width="30" height="50"><circle fill="currentColor" cy="15" cx="15" r="3"></circle><circle fill="currentColor" cy="25" cx="15" r="3"></circle><circle fill="currentColor" cy="35" cx="15" r="3"></circle></svg></div>
</div>

<main id="content" class="svelte-1x8iuzz">

<h1>Compile Svelte in your head (Part 1)</h1>

<a class="tag series svelte-muo5sw" href="/series/Compile Svelte in your head">Series: Compile Svelte in your head</a>

<a class="tag svelte-muo5sw" href="/tags/Svelte">Svelte</a><a class="tag svelte-muo5sw" href="/tags/JavaScript">JavaScript</a>

<article class="blog"><section role="navigation" aria-label="Table of Contents" class="svelte-zmasws"><ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#background" class="svelte-zmasws">Background</a>
				
			</li><li class="svelte-zmasws"><a href="#introduction" class="svelte-zmasws">Introduction</a>
				<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#creating-an-element" class="svelte-zmasws">Creating an element</a>
								
							</li><li class="svelte-zmasws"><a href="#updating-an-element" class="svelte-zmasws">Updating an element</a>
								
							</li><li class="svelte-zmasws"><a href="#removing-an-element" class="svelte-zmasws">Removing an element</a>
								
							</li><li class="svelte-zmasws"><a href="#adding-style-to-an-element" class="svelte-zmasws">Adding style to an element</a>
								
							</li><li class="svelte-zmasws"><a href="#listen-for-click-events-on-an-element" class="svelte-zmasws">Listen for click events on an element</a>
								
							</li>
					</ol>
			</li><li class="svelte-zmasws"><a href="#svelte-syntax" class="svelte-zmasws">Svelte syntax</a>
				
			</li><li class="svelte-zmasws"><a href="#compile-svelte-in-your-head" class="svelte-zmasws">Compile Svelte in your Head</a>
				<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#create-fragment" class="svelte-zmasws">create_fragment</a>
								<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#c" class="svelte-zmasws">- c()</a>
												
											</li><li class="svelte-zmasws"><a href="#m-target-anchor" class="svelte-zmasws">- m(target, anchor)</a>
												
											</li><li class="svelte-zmasws"><a href="#d-detaching" class="svelte-zmasws">- d(detaching)</a>
												
											</li>
									</ol>
							</li><li class="svelte-zmasws"><a href="#export-default-class-app-extends-sveltecomponent" class="svelte-zmasws">export default class App extends SvelteComponent</a>
								
							</li><li class="svelte-zmasws"><a href="#adding-data" class="svelte-zmasws">Adding data</a>
								
							</li><li class="svelte-zmasws"><a href="#updating-data" class="svelte-zmasws">Updating data</a>
								<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#p-ctx-dirty" class="svelte-zmasws">- p(ctx, dirty)</a>
												
											</li>
									</ol>
							</li><li class="svelte-zmasws"><a href="#instance-variable" class="svelte-zmasws">instance variable</a>
								
							</li><li class="svelte-zmasws"><a href="#instance-self-props-invalidate" class="svelte-zmasws">instance($self, $props, $invalidate)</a>
								
							</li><li class="svelte-zmasws"><a href="#invalidate" class="svelte-zmasws">$invalidate</a>
								
							</li><li class="svelte-zmasws"><a href="#adding-event-listeners" class="svelte-zmasws">Adding event listeners</a>
								
							</li><li class="svelte-zmasws"><a href="#listen-and-dispose" class="svelte-zmasws">listen and dispose</a>
								
							</li>
					</ol>
			</li><li class="svelte-zmasws"><a href="#summary" class="svelte-zmasws">Summary</a>
				<ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#1-create-fragment" class="svelte-zmasws">1. create_fragment</a>
								
							</li><li class="svelte-zmasws"><a href="#2-instance" class="svelte-zmasws">2. instance</a>
								
							</li><li class="svelte-zmasws"><a href="#3-class-app-extends-sveltecomponent" class="svelte-zmasws">3. class App extends SvelteComponent</a>
								
							</li>
					</ol>
			</li><li class="svelte-zmasws"><a href="#closing-note" class="svelte-zmasws">Closing Note</a>
				
			</li></ol>
</section>
	<section><h2><a href="#background" id="background">Background</a></h2>
<p>A while ago, <a href="https://twitter.com/swyx" rel="nofollow">@swyx</a> came back to Singapore and visited us in <a href="https://careers.shopee.sg/about/" rel="nofollow">Shopee Singapore</a> (<a href="https://grnh.se/32e5b3532" rel="nofollow">We&#39;re hiring!</a>).</p>
<p>He gave an amazing sharing on <a href="https://www.swyx.io/speaking/svelte-compile-lightning/" rel="nofollow">Compile Svelte in Your Head</a> (<a href="https://www.youtube.com/watch?v=FNmvcswdjV8" rel="nofollow">video</a>) in the <a href="https://reactknowledgeable.org/" rel="nofollow">ReactKnowledgeable Originals</a>.</p>
<p>I love his presentation and the title is so catchy, so I begged him to use the catchy title as this series of articles about the Svelte compiler. It will be about how Svelte sees your code and compiles it down to plain JavaScript.</p></section>
<section><h2><a href="#introduction" id="introduction">Introduction</a></h2>
<p>Lets refresh ourselves with how we write web app without any framework:</p></section>
<section><h3><a href="#creating-an-element" id="creating-an-element">Creating an element</a></h3>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" include="true" h1="true"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-comment)">// create a h1 element</span></div><div class='line'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createElement&lt;"h1">(tagName: "h1", options?: ElementCreationOptions | undefined): HTMLHeadingElement (+2 overloads)' >createElement</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;h1&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Hello World&apos;</span><span style="color: var(--shiki-color-text)">;</span></div><div class='line'><span style="color: var(--shiki-token-comment)">// ...and add it to the body</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;HTMLHeadingElement>(node: HTMLHeadingElement): HTMLHeadingElement' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp>);</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#updating-an-element" id="updating-an-element">Updating an element</a></h3>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" cutLines="1"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-comment)">// update the text of the h1 element</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Bye World&apos;</span><span style="color: var(--shiki-color-text)">;</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#removing-an-element" id="removing-an-element">Removing an element</a></h3>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" cutLines="1"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-comment)">// finally, we remove the h1 element</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.removeChild&lt;HTMLHeadingElement>(child: HTMLHeadingElement): HTMLHeadingElement' >removeChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp>);</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#adding-style-to-an-element" id="adding-style-to-an-element">Adding style to an element</a></h3>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js"><div class="language-id">ts</div><div class='code-container'><code><div class='line dim'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createElement&lt;"h1">(tagName: "h1", options?: ElementCreationOptions | undefined): HTMLHeadingElement (+2 overloads)' >createElement</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;h1&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line dim'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Hello World&apos;</span><span style="color: var(--shiki-color-text)">;</span></div><div class='line highlight'><span style="color: var(--shiki-token-comment)">// add class name to the h1 element</span></div><div class='line highlight'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Element.setAttribute(qualifiedName: string, value: string): void' >setAttribute</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;class&apos;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;abc&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line highlight'><span style="color: var(--shiki-token-comment)">// ...and add a &lt;style&gt; tag to the head</span></div><div class='line highlight'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module style&#10;const style: HTMLStyleElement' >style</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createElement&lt;"style">(tagName: "style", options?: ElementCreationOptions | undefined): HTMLStyleElement (+2 overloads)' >createElement</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;style&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line highlight'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module style&#10;const style: HTMLStyleElement' >style</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;.abc &#123; color: blue; &#125;&apos;</span><span style="color: var(--shiki-color-text)">;</span></div><div class='line highlight'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.head: HTMLHeadElement' >head</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;HTMLStyleElement>(node: HTMLStyleElement): HTMLStyleElement' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='module style&#10;const style: HTMLStyleElement' >style</data-lsp>);</span></div><div class='line dim'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;HTMLHeadingElement>(node: HTMLHeadingElement): HTMLHeadingElement' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='module h1&#10;const h1: HTMLHeadingElement' >h1</data-lsp>);</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#listen-for-click-events-on-an-element" id="listen-for-click-events-on-an-element">Listen for click events on an element</a></h3>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js"><div class="language-id">ts</div><div class='code-container'><code><div class='line dim'><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module button&#10;const button: HTMLButtonElement' >button</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Document.createElement&lt;"button">(tagName: "button", options?: ElementCreationOptions | undefined): HTMLButtonElement (+2 overloads)' >createElement</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;button&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line dim'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module button&#10;const button: HTMLButtonElement' >button</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Click Me!&apos;</span><span style="color: var(--shiki-color-text)">;</span></div><div class='line highlight'><span style="color: var(--shiki-token-comment)">// listen to "click" events</span></div><div class='line highlight'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='module button&#10;const button: HTMLButtonElement' >button</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) HTMLButtonElement.addEventListener&lt;"click">(type: "click", listener: (this: HTMLButtonElement, ev: MouseEvent) => any, options?: boolean | AddEventListenerOptions | undefined): void (+1 overload)' >addEventListener</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;click&apos;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></div><div class='line highlight'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='namespace console&#10;var console: Console' >console</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Console.log(message?: any, ...optionalParams: any[]): void (+1 overload)' >log</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;Hi!&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line highlight'><span style="color: var(--shiki-color-text)">&#125;);</span></div><div class='line dim'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.appendChild&lt;HTMLButtonElement>(node: HTMLButtonElement): HTMLButtonElement' >appendChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='module button&#10;const button: HTMLButtonElement' >button</data-lsp>);</span></div></code></div></pre><!-- HTML_TAG_END --></div>
<p>These are code that you have to write, without using any framework or library.</p>
<p>The main idea of this article is to show how the Svelte compiler compiles the Svelte syntax into statements of codes that I&#39;ve shown above.</p></section>
<section><h2><a href="#svelte-syntax" id="svelte-syntax">Svelte syntax</a></h2>
<p>Here I&#39;m going to show you some basics of the Svelte syntax.</p>
<blockquote><p>If you wish to learn more, I highly recommend trying <a href="https://svelte.dev/tutorial/basics" rel="nofollow">Svelte&#39;s interactive tutorial</a>.</p></blockquote>
<p>So here is a basic Svelte component:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/99aeea705b1e48fe8610b3ccee948280" rel="nofollow">Svelte REPL</a></p>
<p>To add style, you add a <code class="inline">&lt;style&gt;</code> tag:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></div><div class="line">  <span class="token selector">h1</span> <span class="token punctuation">&#123;</span></div><div class="line">    <span class="token property">color</span><span class="token punctuation">:</span> rebeccapurple<span class="token punctuation">;</span></div><div class="line">  <span class="token punctuation">&#125;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/cf54441399864c0f9b0cb25710a5fe9b" rel="nofollow">Svelte REPL</a></p>
<p>At this point, writing Svelte component just feels like writing HTML, that&#39;s because Svelte syntax is a super set of the HTML syntax.</p>
<p>Let&#39;s look at how we add a data to our component:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/c149ca960b0444948dc0c00a9175bcb3" rel="nofollow">Svelte REPL</a></p>
<p>We put JavaScript inside the curly brackets.</p>
<p>To add a click handler, we use the <code class="inline">on:</code> directive</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></div><div class="line">  <span class="token keyword">function</span> <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="line">  <span class="token punctuation">&#125;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>onClickButton<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Clicked <span class="token language-javascript"><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/1da1dcaf51814ed09d2341ea7915f0a1" rel="nofollow">Svelte REPL</a></p>
<p>To change the data, we use <a href="https://www.w3schools.com/js/js_assignment.asp" rel="nofollow">assignment operators</a></p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line dim">  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token keyword">function</span> <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line highlight">    count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></div><div class="line dim">  <span class="token punctuation">&#125;</span></div><div class="line dim"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>onClickButton<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Clicked <span class="token language-javascript"><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/7bff4b7746df4007a51155d2006ce724" rel="nofollow">Svelte REPL</a></p>
<p>Let&#39;s move on to see how Svelte syntax is compiled into JavaScript that we&#39;ve seen earlier</p></section>
<section><h2><a href="#compile-svelte-in-your-head" id="compile-svelte-in-your-head">Compile Svelte in your Head</a></h2>
<p>The Svelte compiler analyses the code you write and generates an optimised JavaScript output.</p>
<p>To study how Svelte compiles the code, lets start with the smallest example possible, and slowly build up the code. Through the process, you will see that Svelte incrementally adds to the output code based on your changes.</p>
<p>The first example that we are going to see is:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/99aeea705b1e48fe8610b3ccee948280?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" hideJsdoc="true" cutLines="2"><div class="language-id">ts</div><div class='code-container'><code><div class='line dim'><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='function create_fragment(ctx: any): &#123;&#10;    c(): void;&#10;    m(target: HTMLElement, anchor: HTMLElement): void;&#10;    d(detaching: boolean): void;&#10;&#125;' >create_fragment</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) ctx: any' >ctx</data-lsp>) &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp>;</span></div><div class='line dim'>&nbsp;</div><div class='line dim'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(method) c(): void' >c</data-lsp></span><span style="color: var(--shiki-color-text)">() &#123;</span></div><div class='line highlight'><span style="color: var(--shiki-color-text)">      <data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) element&lt;"h1">(name: "h1"): HTMLHeadingElement&#10;import element' >element</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;h1&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Hello world&apos;</span><span style="color: var(--shiki-color-text)">;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(method) m(target: HTMLElement, anchor: HTMLElement): void' >m</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) target: HTMLElement' >target</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) anchor: HTMLElement' >anchor</data-lsp>) &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) insert(target: Node, node: Node, anchor?: Node | undefined): void&#10;import insert' >insert</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) target: HTMLElement' >target</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) anchor: HTMLElement' >anchor</data-lsp>);</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(method) d(detaching: boolean): void' >d</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) detaching: boolean' >detaching</data-lsp>) &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (<data-lsp lsp='(parameter) detaching: boolean' >detaching</data-lsp>) </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) detach(node: Node): void&#10;import detach' >detach</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp>);</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">  &#125;;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">&#125;</span></div><div class='line dim'>&nbsp;</div><div class='line dim'><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='class App' >App</data-lsp></span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) class SvelteComponent&#10;import SvelteComponent' >SvelteComponent</data-lsp></span><span style="color: var(--shiki-color-text)"> &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) options: any' >options</data-lsp>) &#123;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">super</span><span style="color: var(--shiki-color-text)">();</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) init(component: any, options: any, instance: any, create_fragment: any, not_equal: any, props: any, append_styles: any, dirty?: number[] | undefined): void&#10;import init' >init</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) options: any' >options</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='function create_fragment(ctx: any): &#123;&#10;    c(): void;&#10;    m(target: HTMLElement, anchor: HTMLElement): void;&#10;    d(detaching: boolean): void;&#10;&#125;' >create_fragment</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(alias) function safe_not_equal(a: any, b: any): boolean&#10;import safe_not_equal' >safe_not_equal</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123;&#125;);</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">  &#125;</span></div><div class='line dim'><span style="color: var(--shiki-color-text)">&#125;</span></div></code></div></pre><!-- HTML_TAG_END --></div>
<p>You can break down the output code into 2 sections:</p>
<ul><li><code class="inline">create_fragment</code></li>
<li><code class="inline">class App extends SvelteComponent</code></li></ul></section>
<section><h3><a href="#create-fragment" id="create-fragment">create_fragment</a></h3>
<p>Svelte components are the building blocks of a Svelte application. Each Svelte component focuses on building its piece or fragment of the final DOM.</p>
<p>The <code class="inline">create_fragment</code> function gives the Svelte component an instruction manual on how to build the DOM fragment.</p>
<p>Look at the return object of the <code class="inline">create_fragment</code> function. It has methods, such as:</p></section>
<section><h4><a href="#c" id="c">- c()</a></h4>
<p>Short for <strong>create</strong>.</p>
<p>Contains instructions to create all the elements in the fragment.</p>
<p>In this example, it contains instructions to create the <code class="inline">h1</code> element</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="ts" cutLines="3"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-color-text)"><data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='(alias) element&lt;"h1">(name: "h1"): HTMLHeadingElement&#10;import element' >element</data-lsp></span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&apos;h1&apos;</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line'><span style="color: var(--shiki-token-constant)"><data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-color-text)">.<data-lsp lsp='(property) Node.textContent: string | null' >textContent</data-lsp> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&apos;Hello World&apos;</span><span style="color: var(--shiki-color-text)">;</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h4><a href="#m-target-anchor" id="m-target-anchor">- m(target, anchor)</a></h4>
<p>Short for <strong>mount</strong>.</p>
<p>Contains instructions to mount the elements into the target.</p>
<p>In this example, it contains instructions to insert the <code class="inline">h1</code> element into the <code class="inline">target</code>.</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" hideJsdoc="true" cutLines="5"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-function)"><data-lsp lsp='function insert(target: Node, node: Node, anchor?: Node | undefined): void' >insert</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='let target: HTMLElement' >target</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='let anchor: HTMLElement' >anchor</data-lsp>);</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: var(--shiki-token-comment)">// http://github.com/sveltejs/svelte/tree/master/src/runtime/internal/dom.ts</span></div><div class='line'><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='function insert(target: Node, node: Node, anchor?: Node | undefined): void' >insert</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) target: Node' >target</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) node: Node' >node</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) anchor: Node | undefined' >anchor</data-lsp>) &#123;</span></div><div class='line'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(parameter) target: Node' >target</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.insertBefore&lt;Node>(node: Node, child: Node | null): Node' >insertBefore</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) node: Node' >node</data-lsp></span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> <data-lsp lsp='(parameter) anchor: Node | undefined' >anchor</data-lsp> </span><span style="color: var(--shiki-token-keyword)">||</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-color-text)">);</span></div><div class='line'><span style="color: var(--shiki-color-text)">&#125;</span></div></code></div></pre><!-- HTML_TAG_END --></div></section>
<section><h4><a href="#d-detaching" id="d-detaching">- d(detaching)</a></h4>
<p>Short for <strong>destroy</strong>.</p>
<p>Contains instructions to remove the elements from the target.</p>
<p>In this example, we detach the <code class="inline">h1</code> element from the DOM</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki twoslash lsp" style="background-color: var(--shiki-color-background); color: var(--shiki-color-text)" lang="js" hideJsdoc="true" cutLines="1"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: var(--shiki-token-function)"><data-lsp lsp='function detach(node: Node): void' >detach</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='let h1: HTMLHeadingElement' >h1</data-lsp>);</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: var(--shiki-token-comment)">// http://github.com/sveltejs/svelte/tree/master/src/runtime/internal/dom.ts</span></div><div class='line'><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)"><data-lsp lsp='function detach(node: Node): void' >detach</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) node: Node' >node</data-lsp>) &#123;</span></div><div class='line'><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(parameter) node: Node' >node</data-lsp></span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)"><data-lsp lsp='(property) Node.parentNode: ParentNode | null' >parentNode</data-lsp></span><span style="color: var(--shiki-token-function)">.<data-lsp lsp='(method) Node.removeChild&lt;Node>(child: Node): Node' >removeChild</data-lsp></span><span style="color: var(--shiki-color-text)">(<data-lsp lsp='(parameter) node: Node' >node</data-lsp>);</span></div><div class='line'><span style="color: var(--shiki-color-text)">&#125;</span></div></code></div></pre><!-- HTML_TAG_END --></div>
<blockquote><p>The method names are short for better minification. <a href="https://alistapart.com/article/javascript-minification-part-ii/#section3" rel="nofollow">See what can&#39;t be minified here</a>.</p></blockquote></section>
<section><h3><a href="#export-default-class-app-extends-sveltecomponent" id="export-default-class-app-extends-sveltecomponent">export default class App extends SvelteComponent</a></h3>
<p>Each component is a class, which you can import and instantiate through <a href="https://svelte.dev/docs#Client-side_component_API" rel="nofollow">this API</a>.</p>
<p>And in the constructor, we initialize the component with information that made up the component such as <code class="inline">create_fragment</code>. Svelte will only pass information that it is needed and remove them whenever it is not necessary.</p>
<p>Try removing the <code class="inline">&lt;h1&gt;</code> tag and see what happens to the output:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token comment">&lt;!-- empty --></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/1f29ce52adf446fc9116bb957b7200ec?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">SvelteComponent</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(options) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">super</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">init</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> options</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> safe_not_equal</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123;&#125;);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Svelte will pass in <code class="inline">null</code> instead of <code class="inline">create_fragment</code>!</p>
<p>The <code class="inline">init</code> function is where Svelte sets up most of the internals, such as:</p>
<ul><li>component props, <code class="inline">ctx</code> (will explain what <code class="inline">ctx</code> is later) and context</li>
<li>component lifecycle events</li>
<li>component update mechanism</li></ul>
<p>and at the very end, Svelte calls the <code class="inline">create_fragment</code> to create and mount elements into the DOM.</p>
<p>If you noticed, all the internal state and methods are attached to <code class="inline">this.$$</code>.</p>
<p>So if you ever access the <code class="inline">$$</code> property of the component, you are tapping into the internals. You&#39;ve been warned! </p></section>
<section><h3><a href="#adding-data" id="adding-data">Adding data</a></h3>
<p>Now that we&#39;ve looked at the bare minimum of a Svelte component, let&#39;s see how adding a data would change the compiled output:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">	<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/c149ca960b0444948dc0c00a9175bcb3?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<p>Notice the change in the output:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">create_fragment</span><span style="color: var(--shiki-color-text)">(ctx) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">element</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;h1&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-constant)">h1</span><span style="color: var(--shiki-color-text)">.textContent </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#96;Hello </span><span style="color: var(--shiki-token-keyword)">$&#123;</span><span style="color: var(--shiki-color-text)">name</span><span style="color: var(--shiki-token-keyword)">&#125;</span><span style="color: var(--shiki-token-string-expression)">&#96;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;World&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">SvelteComponent</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Some observations:</p>
<ul><li>What you&#39;ve written in the <code class="inline">&lt;script&gt;</code> tag is moved into the top level of the code</li>
<li><code class="inline">h1</code> element&#39;s text content is now a template literal</li></ul>
<p>There&#39;s a lot of amazing things happening under the hood right now, but let&#39;s hold our horses for a while, because it&#39;s best explained when comparing with the next code change.</p></section>
<section><h3><a href="#updating-data" id="updating-data">Updating data</a></h3>
<p>Let&#39;s add a function to update the <code class="inline">name</code>:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line">	<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span></div><div class="line">	<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line">		name <span class="token operator">=</span> <span class="token string">'Svelte'</span><span class="token punctuation">;</span></div><div class="line">	<span class="token punctuation">&#125;</span></div><div class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/3841485f4d224774ba42617e4e964968?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<p>...and observe the change in the compiled output:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">create_fragment</span><span style="color: var(--shiki-color-text)">(ctx) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">element</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;h1&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      t0 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">text</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Hello &#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      t1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">text</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">m</span><span style="color: var(--shiki-color-text)">(target</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> anchor) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">insert</span><span style="color: var(--shiki-color-text)">(target</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> anchor);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">append</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> t0);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">append</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> t1);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">p</span><span style="color: var(--shiki-color-text)">(ctx</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> [dirty]) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (dirty </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-function)">set_data</span><span style="color: var(--shiki-color-text)">(t1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">d</span><span style="color: var(--shiki-color-text)">(detaching) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (detaching) </span><span style="color: var(--shiki-token-function)">detach</span><span style="color: var(--shiki-color-text)">(h1);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"></span>
<span class="line highlight"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">instance</span><span style="color: var(--shiki-color-text)">($$self</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> $$props</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> $$invalidate) &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;World&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line highlight"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> (name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">));</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line highlight"></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> [name];</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">App</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">SvelteComponent</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(options) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">super</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">init</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> options</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> instance</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> create_fragment</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> safe_not_equal</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123;&#125;);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Some observations:</p>
<ul><li>the text content of <code class="inline">&lt;h1&gt;</code> element is now broken into 2 text nodes, created by the <code class="inline">text(...)</code> function</li>
<li>the return object of the <code class="inline">create_fragment</code> has a new method, <code class="inline">p(ctx, dirty)</code></li>
<li>a new function <code class="inline">instance</code> is created</li>
<li>What you&#39;ve written in the <code class="inline">&lt;script&gt;</code> tag is now moved into the <code class="inline">instance</code> function</li>
<li>for the sharp-eyed, the variable <code class="inline">name</code> that was used in the <code class="inline">create_fragment</code> is now replaced by <code class="inline">ctx[0]</code></li></ul>
<p>So, why the change?</p>
<p>The Svelte compiler tracks all the variables declared in the <code class="inline">&lt;script&gt;</code> tag.</p>
<p>It tracks whether the variable:</p>
<ul><li>can be mutated? eg: <code class="inline">count++</code>,</li>
<li>can be reassigned? eg: <code class="inline">name = &#39;Svelte&#39;</code>,</li>
<li>is referenced in the template? eg: <code class="inline">&lt;h1&gt;Hello {name}&lt;/h1&gt;</code></li>
<li>is writable? eg: <code class="inline">const i = 1;</code> vs <code class="inline">let i = 1;</code></li>
<li>... and many more</li></ul>
<p>When the Svelte compiler realises that the variable <code class="inline">name</code> can be reassigned, (due to <code class="inline">name = &#39;Svelte&#39;;</code> in <code class="inline">update</code>), it breaks down the text content of the <code class="inline">h1</code> into parts, so that it can dynamically update part of the text.</p>
<p>Indeed, you can see that there&#39;s a new method, <code class="inline">p</code>, to update the text node.</p></section>
<section><h4><a href="#p-ctx-dirty" id="p-ctx-dirty">- p(ctx, dirty)</a></h4>
<p>Short for <strong>u_p_date</strong>.</p>
<p><strong>p(ctx, dirty)</strong> contains instructions to update the elements based on what has changed in the state (<code class="inline">dirty</code>) and the state (<code class="inline">ctx</code>) of the component.</p></section>
<section><h3><a href="#instance-variable" id="instance-variable">instance variable</a></h3>
<p>The compiler realises that the variable <code class="inline">name</code> cannot be shared across different instances of the <code class="inline">App</code> component. That&#39;s why it moves the declaration of the variable <code class="inline">name</code> into a function called <code class="inline">instance</code>.</p>
<p>In the previous example, no matter how many instances of the <code class="inline">App</code> component, the value of the variable <code class="inline">name</code> is the same and unchanged across the instances:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line"></div><div class="line"><span class="token comment">&lt;!-- gives you --></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p>But, in this example, the variable <code class="inline">name</code> can be changed within 1 instance of the component, so the declaration of the variable <code class="inline">name</code> is now moved into the <code class="inline">instance</code> function:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>App</span> <span class="token punctuation">/></span></span></div><div class="line dim"></div><div class="line dim"><span class="token comment">&lt;!-- could possibly be --></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div><div class="line highlight"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello Svelte<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div><div class="line dim"><span class="token comment">&lt;!-- depending on the inner state of the component --></span></div></code></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#instance-self-props-invalidate" id="instance-self-props-invalidate">instance($$self, $$props, $$invalidate)</a></h3>
<p>The <code class="inline">instance</code> function returns a list of <em>instance</em> variables, which are variables that are:</p>
<ul><li>referenced in the template</li>
<li>mutated or reassigned, (can be changed within 1 instance of the component)</li></ul>
<p>In Svelte, we call this list of instance variables, <strong>ctx</strong>.</p>
<p>In the <code class="inline">init</code> function, Svelte calls the <code class="inline">instance</code> function to create <strong>ctx</strong>, and uses it to create the fragment for the component:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// conceptually,</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">ctx</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">instance</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/*...*/</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">fragment</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">create_fragment</span><span style="color: var(--shiki-color-text)">(ctx);</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// create the fragment</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">fragment</span><span style="color: var(--shiki-token-function)">.c</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// mount the fragment onto the DOM</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">fragment</span><span style="color: var(--shiki-token-function)">.m</span><span style="color: var(--shiki-color-text)">(target);</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Now, instead of accessing the variable <code class="inline">name</code> outside of the component, we refer to the variable <code class="inline">name</code> passed via the <strong>ctx</strong>:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">t1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">text</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]);</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>The reason that ctx is an array instead of a map or an object is because of an optimisation related to bitmask, you can see <a href="https://github.com/sveltejs/svelte/issues/1922" rel="nofollow">the discussion about it here</a></p></section>
<section><h3><a href="#invalidate" id="invalidate">$$invalidate</a></h3>
<p>The secret behind the system of reactivity in Svelte is the <code class="inline">$$invalidate</code> function.</p>
<p>Every variable that has been</p>
<ul><li>reassigned or mutated</li>
<li>referenced in the template</li></ul>
<p>will have the <code class="inline">$$invalidate</code> function inserted right after the assignment or mutation:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">count</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">foo</span><span style="color: var(--shiki-color-text)">.a </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// compiled into something like</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/* name */</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> name);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">count</span><span style="color: var(--shiki-token-keyword)">++</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/* count */</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> count);</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">foo</span><span style="color: var(--shiki-color-text)">.a </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/* foo */</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> foo);</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>The <code class="inline">$$invalidate</code> function marks the variable dirty and schedules an update for the component:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// conceptually...</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">ctx</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">instance</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/*...*/</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">fragment</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">create_fragment</span><span style="color: var(--shiki-color-text)">(ctx);</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// to track which variable has changed</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">dirty</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Set</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> (variable</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> newValue) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// update ctx</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  ctx[variable] </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> newValue;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// mark variable as dirty</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">dirty</span><span style="color: var(--shiki-token-function)">.add</span><span style="color: var(--shiki-color-text)">(variable);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// schedules update for the component</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">scheduleUpdate</span><span style="color: var(--shiki-color-text)">(component);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// gets called when update is scheduled</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">flushUpdate</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// update the fragment</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">fragment</span><span style="color: var(--shiki-token-function)">.p</span><span style="color: var(--shiki-color-text)">(ctx</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> dirty);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// clear the dirty</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-constant)">dirty</span><span style="color: var(--shiki-token-function)">.clear</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div></section>
<section><h3><a href="#adding-event-listeners" id="adding-event-listeners">Adding event listeners</a></h3>
<p>Let&#39;s now add an event listener</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line dim"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div><div class="line dim">	<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span></div><div class="line dim">	<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></div><div class="line dim">		name <span class="token operator">=</span> <span class="token string">'Svelte'</span><span class="token punctuation">;</span></div><div class="line dim">	<span class="token punctuation">&#125;</span></div><div class="line dim"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div><div class="line highlight"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>update<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/5b12ff52c2874f4dbb6405d9133b34da?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<p>And observe the difference:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">create_fragment</span><span style="color: var(--shiki-color-text)">(ctx) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      h1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">element</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;h1&#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      t0 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">text</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;Hello &#39;</span><span style="color: var(--shiki-color-text)">);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      t1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">text</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">m</span><span style="color: var(--shiki-color-text)">(target</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> anchor) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">insert</span><span style="color: var(--shiki-color-text)">(target</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> anchor);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">append</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> t0);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">append</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> t1);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      dispose </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">p</span><span style="color: var(--shiki-color-text)">(ctx</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> [dirty]) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (dirty </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-function)">set_data</span><span style="color: var(--shiki-color-text)">(t1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*name*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">d</span><span style="color: var(--shiki-color-text)">(detaching) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (detaching) </span><span style="color: var(--shiki-token-function)">detach</span><span style="color: var(--shiki-color-text)">(h1);</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">dispose</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">instance</span><span style="color: var(--shiki-color-text)">($$self</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> $$props</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> $$invalidate) &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">let</span><span style="color: var(--shiki-color-text)"> name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;world&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line dim"></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">update</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">$$invalidate</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> (name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Svelte&#39;</span><span style="color: var(--shiki-color-text)">));</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> [name</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> update];</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-token-comment)">// ...</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Some observations:</p>
<ul><li><code class="inline">instance</code> function now returns 2 variables instead of 1</li>
<li>Listen to click event during <strong>mount</strong> and dispose it in <strong>destroy</strong></li></ul>
<p>As I&#39;ve mentioned earlier, <code class="inline">instance</code> function returns variables that are <strong>referenced in the template</strong> and that are <strong>mutated or reassigned</strong>.</p>
<p>Since we&#39;ve just referenced the <code class="inline">update</code> function in the template, it is now returned in the <code class="inline">instance</code> function as part of the <strong>ctx</strong>.</p>
<p>Svelte tries generate as compact JavaScript output as possible, not returning an extra variable if it is not necessary.</p></section>
<section><h3><a href="#listen-and-dispose" id="listen-and-dispose">listen and dispose</a></h3>
<p>Whenever you add <a href="https://svelte.dev/tutorial/dom-events" rel="nofollow">an event listener</a> in Svelte, Svelte will inject code to add an <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener" rel="nofollow">event listener</a> and remove it when the DOM fragment is removed from the DOM.</p>
<p>Try adding more event listeners,</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="prism language-svelte"><code><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span></div><div class="line">	<span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>update<span class="token punctuation">&#125;</span></span></div><div class="line">	<span class="token attr-name"><span class="token namespace">on:</span>mousedown=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>update<span class="token punctuation">&#125;</span></span></div><div class="line">	<span class="token attr-name"><span class="token namespace">on:</span>touchstart=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>update<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span></div><div class="line">  Hello <span class="token language-javascript"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span>!</div><div class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></div></code></pre><!-- HTML_TAG_END --></div>
<p><a href="https://svelte.dev/repl/efde6f2aaf624e708767f1bd3e94e479?version=3.19.1" rel="nofollow">Svelte REPL</a></p>
<p>and observe the compiled output:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">dispose </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> [</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">])</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;mousedown&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">])</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;touchstart&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123; passive</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)"> &#125;)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">];</span></span>
<span class="line dim"><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line highlight"><span style="color: var(--shiki-token-function)">run_all</span><span style="color: var(--shiki-color-text)">(dispose);</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Instead of declaring and creating a new variable to remove each event listener, Svelte assigns all of them to an array:</p>
<div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// instead of</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dispose1 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;click&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dispose2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;mousedown&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]);</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dispose2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">listen</span><span style="color: var(--shiki-color-text)">(h1</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;touchstart&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">/*update*/</span><span style="color: var(--shiki-color-text)"> ctx[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> &#123; passive</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">true</span><span style="color: var(--shiki-color-text)"> &#125;);</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dispose1</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dispose2</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dispose3</span><span style="color: var(--shiki-color-text)">();</span></span></code></pre><!-- HTML_TAG_END --></div>
<p>Minification can compact the variable name, but you can&#39;t remove the brackets.</p>
<p>Again, this is another great example of where Svelte tries to generate compact JavaScript output. Svelte does not create the <code class="inline">dispose</code> array when there&#39;s only 1 event listener.</p></section>
<section><h2><a href="#summary" id="summary">Summary</a></h2>
<p>The Svelte syntax is a superset of HTML.</p>
<p>When you write a Svelte component, the Svelte compiler analyses your code and generates optimised JavaScript code output.</p>
<p>The output can be divided into 3 segments:</p></section>
<section><h3><a href="#1-create-fragment" id="1-create-fragment">1. create_fragment</a></h3>
<ul><li>Returns a fragment, which is an instruction manual on how to build the DOM fragment for the component</li></ul></section>
<section><h3><a href="#2-instance" id="2-instance">2. instance</a></h3>
<ul><li>Most of the code written in the <code class="inline">&lt;script&gt;</code> tag is in here.</li>
<li>Returns a list of instance variables that are referenced in the template</li>
<li><code class="inline">$$invalidate</code> is inserted after every assignment and mutation of the instance variable</li></ul></section>
<section><h3><a href="#3-class-app-extends-sveltecomponent" id="3-class-app-extends-sveltecomponent">3. class App extends SvelteComponent</a></h3>
<ul><li>Initialise the component with <code class="inline">create_fragment</code> and <code class="inline">instance</code> function</li>
<li>Sets up the component internals</li>
<li>Provides the <a href="https://svelte.dev/docs#Client-side_component_API" rel="nofollow">Component API</a></li></ul>
<p>Svelte strives to generate as compact JavaScript as possible, for example:</p>
<ul><li>Breaking text content of <code class="inline">h1</code> into separate text nodes only when part of the text can be updated</li>
<li>Not defining <code class="inline">create_fragment</code> or <code class="inline">instance</code> function when it is not needed</li>
<li>Generate <code class="inline">dispose</code> as an array or a function, depending on the number of event listeners.</li>
<li>...</li></ul></section>
<section><h2><a href="#closing-note" id="closing-note">Closing Note</a></h2>
<p>We&#39;ve covered the basic structure of the Svelte&#39;s compiled output, and this is just the beginning.</p>
<p>If you wish to know more, <a href="https://twitter.com/lihautan" rel="nofollow">follow me on Twitter</a>.</p>
<p>I&#39;ll post it on Twitter when the next part is ready, where I&#39;ll be covering <a href="https://svelte.dev/tutorial/if-blocks" rel="nofollow">logic blocks</a>, <a href="https://svelte.dev/tutorial/slots" rel="nofollow">slots</a>, <a href="https://svelte.dev/tutorial/context-api" rel="nofollow">context</a>, and many others.</p>
<p><strong>   Continue reading on <a href="/compile-svelte-in-your-head-part-2/">Part 2</a>.</strong></p></section></article>

<div style="height: 1px; width: 100%"></div>

</main>

<footer class="svelte-1x8iuzz">
</footer>


		<script type="module" data-hydrate="h56j5y">
		import { start } from "/_app/start-a7ad3b52.js";
		start({
			target: document.querySelector('[data-hydrate="h56j5y"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "always",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-6b949870.js"),
						import("/_app/pages/compile-svelte-in-your-head-part-1/index.md-89713c9b.js")
				],
				params: {}
			}
		});
	</script></div>
		<script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); if (typeof ga === "function") { ga('create', 'UA-135921142-1', 'auto', {}); }</script>
	</body>
</html>
