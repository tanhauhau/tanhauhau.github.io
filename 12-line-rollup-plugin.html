<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://twitter.com/lihautan" rel="me" />
		<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#bd93f9" />
		<link rel="apple-touch-icon" sizes="48x48" href="/icon-48x48.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="/icon-256x256.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />
		<link rel="icon" href="/icon-48x48.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			rel="preload"
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&family=Noto+Sans+SC:wght@500&display=swap"
			as="style"
			onload="this.rel='stylesheet'"
		/>
		<link
			rel="alternate"
			type="application/rss+xml"
			title="Tan Li Hau&#x27;s RSS Feed"
			href="/rss.xml"
		/>
		<link rel="sitemap" type="application/xml" href="/sitemap.xml" />
		<link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
		<link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6Y89Q69VY"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-Z6Y89Q69VY');
		</script>
		
		<link href="https://lihautan.com/_app/immutable/assets/2.CDMtzrzD.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/Links.Barm56k2.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/PreloadingIndicator.CHlB5uuK.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/code-snippet.Ch6n4AYw.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/BlogLayout.D1SVHRXd.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/ldjson.CkgGHe4J.css" rel="stylesheet">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/start.BlJDb2XI.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/entry.DNQT6xOV.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/scheduler.D6VJxl8L.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/app.CKbaQt-q.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.CLAVN-Y5.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/0.DLHgrcY7.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/2.Do_T6dy3.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/stores.CLTM96Gl.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/Links.C4jMQkMc.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/each.DI7TeU31.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.DueORT-9.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/PreloadingIndicator.6QGaXoVk.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/5.ppdsJ12h.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/code-snippet.Gym6WUAG.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/BlogLayout.BPekX0dI.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/ldjson.Hcz0M7wa.js"><title>I wrote a 12-line Rollup plugin | Tan Li Hau</title><!-- HEAD_svelte-1jsbgzp_START --><meta name="description" content="Why would I install a package with so many files and dependencies, just to do a something simple that can be done in 12 lines of code?"><meta name="image" content="https://lihautan.com/_app/immutable/assets/hero-twitter.BdhGu847.jpg"><meta name="og:image" content="https://lihautan.com/_app/immutable/assets/hero-twitter.BdhGu847.jpg"><meta name="og:title" content="I wrote a 12-line Rollup plugin"><meta name="og:description" content="Why would I install a package with so many files and dependencies, just to do a something simple that can be done in 12 lines of code?"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@lihautan"><meta name="twitter:title" content="I wrote a 12-line Rollup plugin"><meta name="twitter:description" content="Why would I install a package with so many files and dependencies, just to do a something simple that can be done in 12 lines of code?"><meta name="twitter:image" content="https://lihautan.com/_app/immutable/assets/hero-twitter.BdhGu847.jpg"><meta name="keywords" content="JavaScript"><meta name="keywords" content="rollup"><meta name="keywords" content="plugin"><meta itemprop="url" content="https://lihautan.com/12-line-rollup-plugin"><meta itemprop="image" content="https://lihautan.com/_app/immutable/assets/hero-twitter.BdhGu847.jpg"><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightYear":"2022","creator":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"publisher":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"description":"Why would I install a package with so many files and dependencies, just to do a something simple that can be done in 12 lines of code?","headline":"I wrote a 12-line Rollup plugin","name":"I wrote a 12-line Rollup plugin","inLanguage":"en"}</script><!-- HTML_TAG_END --><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https://lihautan.com/12-line-rollup-plugin","name":"I wrote a 12-line Rollup plugin"},"name":"I wrote a 12-line Rollup plugin","position":2}]}</script><!-- HTML_TAG_END --><!-- HEAD_svelte-1jsbgzp_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">   <a href="#content" class="skip svelte-1x8iuzz" data-svelte-h="svelte-198b79b">Skip to content</a> <header class="svelte-1x8iuzz"><nav><ul class="mode-sidebar svelte-2qf5mw"><li class="svelte-2qf5mw" data-svelte-h="svelte-1c15i4q"><a href="/" class="svelte-2qf5mw">Tan Li Hau</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-jyiaso"><a data-sveltekit-preload-data href="/about" class="svelte-2qf5mw">About</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-nil8z4"><a data-sveltekit-preload-data href="/blogs" class="svelte-2qf5mw">Writings</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-lr8cqc"><a data-sveltekit-preload-data href="/talks" class="svelte-2qf5mw">Talks</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-1oruudc"><a data-sveltekit-preload-data href="/notes" class="svelte-2qf5mw">Notes</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-18xilfe"><a data-sveltekit-preload-data href="/books" class="svelte-2qf5mw">Books</a></li> <li class="social svelte-2qf5mw" data-svelte-h="svelte-1bsaw7m"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
  10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
  4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a> <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
  0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
  5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
  5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
  3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> <a aria-label="YouTube account" href="https://youtube.com/c/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 461.001 461.001" width="1em" height="1em" class="svelte-2qf5mw"><path d="M365.257 67.393H95.744C42.866 67.393 0 110.259 0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878 0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zm-64.751 169.663-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881c3.748 1.899 3.683 7.274-.109 9.082z"></path></svg></a></li> </ul></nav></header> <div class="sidebar svelte-s9hlkv">  <div class="float svelte-s9hlkv" data-svelte-h="svelte-x1w5me"><svg viewBox="0 0 30 50" width="30" height="50"><circle fill="currentColor" cy="15" cx="15" r="3"></circle><circle fill="currentColor" cy="25" cx="15" r="3"></circle><circle fill="currentColor" cy="35" cx="15" r="3"></circle></svg></div> </div> <main id="content" class="svelte-1x8iuzz"> <h1>I wrote a 12-line Rollup plugin</h1> <div class="date svelte-13b38er">November 30, 2019</div>  <a class="tag svelte-13b38er" href="/tags/JavaScript/">JavaScript</a><a class="tag svelte-13b38er" href="/tags/rollup/">rollup</a><a class="tag svelte-13b38er" href="/tags/plugin/">plugin</a> <section role="navigation" aria-label="Table of Contents" class="svelte-zmasws"><ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#background" class="svelte-zmasws">Background</a>  </li><li class="svelte-zmasws"><a href="#need-something-install-a-plugin" class="svelte-zmasws">Need something? Install a plugin!</a>  </li><li class="svelte-zmasws"><a href="#writing-a-rollup-plugin" class="svelte-zmasws">Writing a Rollup plugin</a>  </li><li class="svelte-zmasws"><a href="#closing-notes" class="svelte-zmasws">Closing Notes</a>  </li></ol> </section> <article class="blog"><section><h2 data-svelte-h="svelte-1uyfvlw"><a href="#background" id="background">Background</a></h2> <p data-svelte-h="svelte-ca0ewt">I was building a web application using <a href="http://svelte.dev/" rel="nofollow">Svelte</a> and <a href="https://rollupjs.org/guide/en/" rel="nofollow">Rollup</a> this morning. I needed to use a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" rel="nofollow">web worker</a>, which the worker script has to be in another file:</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">worker</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Worker</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;/build/worker.js&#39;</span><span style="color: var(--shiki-color-text)">);</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-gfm79o">So naturally, I was thinking of having 2 entries for my rollup application: <em>the main app</em> and <em>the worker</em>.</p> <p data-svelte-h="svelte-1r0q1it">It works fine, except the fact that the <a href="https://www.npmjs.com/package/rollup-plugin-livereload" rel="nofollow">rollup-plugin-livereload</a> injected a livereload script to every output file:</p> <div class="code-section"><!-- HTML_TAG_START --><div class="filename">/build/worker.js</div><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(l</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> r) &#123; </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">l</span><span style="color: var(--shiki-token-function)">.getElementById</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;livereloadscript&#39;</span><span style="color: var(--shiki-color-text)">)) </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)">; r </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">l</span><span style="color: var(--shiki-token-function)">.createElement</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;script&#39;</span><span style="color: var(--shiki-color-text)">); </span><span style="color: var(--shiki-token-constant)">r</span><span style="color: var(--shiki-color-text)">.async </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">; </span><span style="color: var(--shiki-token-constant)">r</span><span style="color: var(--shiki-color-text)">.src </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;//&#39;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">window</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">location</span><span style="color: var(--shiki-color-text)">.host </span><span style="color: var(--shiki-token-keyword)">||</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;localhost&#39;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-function)">.split</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;:&#39;</span><span style="color: var(--shiki-color-text)">)[</span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;:35729/livereload.js?snipver=1&#39;</span><span style="color: var(--shiki-color-text)">; </span><span style="color: var(--shiki-token-constant)">r</span><span style="color: var(--shiki-color-text)">.id </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;livereloadscript&#39;</span><span style="color: var(--shiki-color-text)">; </span><span style="color: var(--shiki-token-constant)">l</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">head</span><span style="color: var(--shiki-token-function)">.appendChild</span><span style="color: var(--shiki-color-text)">(r) &#125;)(</span><span style="color: var(--shiki-token-constant)">window</span><span style="color: var(--shiki-color-text)">.document);</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// worker code ...</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-17ofjhq">The livereload script includes a reference to <code class="inline">window</code>, which is not available to the worker script:</p> <p data-svelte-h="svelte-1mpeno8"><span style="display: block; position: relative; padding-top: 10.306%; width: 100%;"><picture><source type="image/webp" srcset="https://lihautan.com/_app/immutable/assets/window-reference-error.idKowLwW.webp, https://lihautan.com/_app/immutable/assets/window-reference-error.CiO7XSIW.webp 2x"><img src="https://lihautan.com/_app/immutable/assets/window-reference-error.BZaOH-Tl.png" srcset="https://lihautan.com/_app/immutable/assets/window-reference-error.BZaOH-Tl.png, https://lihautan.com/_app/immutable/assets/window-reference-error.DtFdjupq.png 2x" loading="lazy" style="position: absolute; top: 0; width: 100%; height: 100%" alt="window reference error" title="window is not defined"></picture></span></p> <p data-svelte-h="svelte-15b128b">I looked into <a href="https://www.npmjs.com/package/rollup-plugin-livereload" rel="nofollow">the docs of the rollup-plugin-livereload</a>, it doesn&#39;t seemed to have a option to exclude files from adding the <em>livereload script</em>.</p> <p data-svelte-h="svelte-ps5k32">At this point, I was thinking to myself, <em>&quot;I just need to copy the worker.js into the &#39;build/&#39; folder, I don&#39;t need anything else, how hard can that be?&quot;</em></p> <p data-svelte-h="svelte-1ylbhej">It turns out harder than I imagined. 🤮</p></section> <section data-svelte-h="svelte-c962hd"><h2><a href="#need-something-install-a-plugin" id="need-something-install-a-plugin">Need something? Install a plugin!</a></h2> <p>In todays JavaScript landscape, there&#39;s a <em>&quot;node_module&quot;</em> for everything.</p> <p>So I <a href="https://www.google.com/search?q=rollup+plugin+copy+files" rel="nofollow">googled</a> <em>&quot;rollup plugin copy files&quot;</em>, without a suprise, there are multiple rollup plugins published to npm:</p> <p><span style="display: block; position: relative; padding-top: 76.068%; width: 100%;"><picture><source type="image/webp" srcset="https://lihautan.com/_app/immutable/assets/google-search.hvC0ZzkU.webp, https://lihautan.com/_app/immutable/assets/google-search.BXs4x8xB.webp 2x"><img src="https://lihautan.com/_app/immutable/assets/google-search.ZtBWFcLi.png" srcset="https://lihautan.com/_app/immutable/assets/google-search.ZtBWFcLi.png, https://lihautan.com/_app/immutable/assets/google-search.p50474kT.png 2x" loading="lazy" style="position: absolute; top: 0; width: 100%; height: 100%" alt="google search" title="Google result for &quot;rollup plugin copy files&quot;"></picture></span></p> <p>So I decided to install the first plugin, because it has the highest weekly downloads:</p> <p><span style="display: block; position: relative; padding-top: 132.234%; width: 100%;"><picture><source type="image/webp" srcset="https://lihautan.com/_app/immutable/assets/rollup-plugin-copy-usage.BjzUT9E6.webp, https://lihautan.com/_app/immutable/assets/rollup-plugin-copy-usage.DiQCifQI.webp 2x"><img src="https://lihautan.com/_app/immutable/assets/rollup-plugin-copy-usage.ETaSE_IP.png" srcset="https://lihautan.com/_app/immutable/assets/rollup-plugin-copy-usage.ETaSE_IP.png, https://lihautan.com/_app/immutable/assets/rollup-plugin-copy-usage.C4Ue4kEO.png 2x" loading="lazy" style="position: absolute; top: 0; width: 100%; height: 100%" alt="rollup-plugin-copy weekly downloads" title="17K weekly downloads"></picture></span></p> <p>When I installed the plugin, I realise I was installing much more than I needed:</p> <p><span style="display: block; position: relative; padding-top: 161.983%; width: 100%;"><picture><source type="image/webp" srcset="https://lihautan.com/_app/immutable/assets/dependencies.DrzhCoj2.webp, https://lihautan.com/_app/immutable/assets/dependencies.Cq84KB7a.webp 2x"><img src="https://lihautan.com/_app/immutable/assets/dependencies.CPUUiRt_.png" srcset="https://lihautan.com/_app/immutable/assets/dependencies.CPUUiRt_.png, https://lihautan.com/_app/immutable/assets/dependencies.ol4Fw-Jm.png 2x" loading="lazy" style="position: absolute; top: 0; width: 100%; height: 100%" alt="rollup-plugin-copy dependencies"></picture></span></p> <p>Remember, my use case is simple:</p> <blockquote><p><strong>I just need to copy the worker.js into the &#39;build/&#39; folder.</strong></p></blockquote> <p>I <em>don&#39;t need any bells and whistles</em> this plugin is providing me. 🙈</p> <p>So I uninstalled the plugin, thinking:</p> <blockquote><p>How hard is it to <strong>write a plugin</strong> that <strong>just</strong> copy the worker.js into the &#39;build/&#39; folder?</p></blockquote></section> <section><h2 data-svelte-h="svelte-j56zwc"><a href="#writing-a-rollup-plugin" id="writing-a-rollup-plugin">Writing a Rollup plugin</a></h2> <p data-svelte-h="svelte-rt8hhv">Senpai once told me, <em>&quot;writing rollup plugins is very straightforward,&quot;</em>, yet, no one told me how to get started writing it.</p> <p data-svelte-h="svelte-9tufsy">So, I dug into <code class="inline">node_modules/</code>, and start skimming through the rollup plugins I have installed: <a href="https://github.com/sveltejs/rollup-plugin-svelte" rel="nofollow">rollup-plugin-svelte</a>, <a href="https://github.com/rollup/rollup-plugin-node-resolve" rel="nofollow">rollup-plugin-node-resolve</a>, <a href="https://github.com/TrySound/rollup-plugin-terser" rel="nofollow">rollup-plugin-terser</a>, ...</p> <p data-svelte-h="svelte-1yfi72">And I noticed a common pattern:</p> <div class="code-section"><!-- HTML_TAG_START --><div class="filename">rollup-plugin-xxx.js</div><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">module</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">exports</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">(options) &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    name</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;plugin-name&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">load</span><span style="color: var(--shiki-color-text)">() &#123; </span><span style="color: var(--shiki-token-comment)">/* ... */</span><span style="color: var(--shiki-color-text)"> &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">resolveId</span><span style="color: var(--shiki-color-text)">() &#123; </span><span style="color: var(--shiki-token-comment)">/* ... */</span><span style="color: var(--shiki-color-text)"> &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">generateBundle</span><span style="color: var(--shiki-color-text)">() &#123; </span><span style="color: var(--shiki-token-comment)">/* ... */</span><span style="color: var(--shiki-color-text)"> &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1cqx8u5">So I guess, this is the general structure of a rollup plugin:</p> <ul data-svelte-h="svelte-r3s881"><li>It&#39;s an object, ...</li> <li>with a property called <code class="inline">name</code> for the name of the plugin,</li> <li>and functions like <em>&quot;load&quot;</em>, <em>&quot;load&quot;</em>, ... that would be called by rollup when the time is right 🤔</li></ul> <p data-svelte-h="svelte-1sc5iln">OK. I know what I need, I need to copy my <code class="inline">worker.js</code> when rollup is generating a bundle:</p> <div class="code-section"><!-- HTML_TAG_START --><div class="filename">rollup.config.js</div><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  plugins</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> [</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      name</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;copy-worker&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">generateBundle</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">fs</span><span style="color: var(--shiki-token-function)">.copyFileSync</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.resolve</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;./src/worker.js&#39;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.resolve</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;./public/build/worker.js&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        );</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  ]</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-dm0rkp">Great! It works! 😎</p> <p data-svelte-h="svelte-1pq2h6y">But, when I change the <code class="inline">worker.js</code> file, the <code class="inline">build/worker.js</code> is not updated. 😞</p> <p data-svelte-h="svelte-18w3p1m">That&#39;s because the <code class="inline">worker.js</code> is not watched!</p> <p data-svelte-h="svelte-vf9515">After much googling, I ended up reading through the official docs of <a href="https://rollupjs.org/guide/en/#plugin-development" rel="nofollow">Rollup</a>.</p> <p data-svelte-h="svelte-15lsmdg">I learned that the functions like <em>&quot;load&quot;</em>, <em>&quot;generateBundle&quot;</em>, ... are called <a href="https://rollupjs.org/guide/en/#hooks" rel="nofollow">&quot;hooks&quot;</a>, and the docs explained when these hooks will be called, the arguments and the expected return value.</p> <p data-svelte-h="svelte-4vm7dc">In the docs, I found <a href="https://rollupjs.org/guide/en/#thisaddwatchfileid-string--void" rel="nofollow"><code class="inline">this.addWatchFile(id: string)</code></a> under <a href="https://rollupjs.org/guide/en/#plugin-context" rel="nofollow">plugin context</a>, which according to the docs,</p> <blockquote data-svelte-h="svelte-1hbj54l"><p>[...] can be used to add additional files to be monitored by watch mode.</p></blockquote> <p data-svelte-h="svelte-1svsrko">Sounds exactly what I am looking for! 😁</p> <div class="code-section"><!-- HTML_TAG_START --><pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line dim"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">default</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  plugins</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> [</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      name</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;copy-worker&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">load</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.addWatchFile</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.resolve</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;./src/worker.js&#39;</span><span style="color: var(--shiki-color-text)">));</span></span>
<span class="line highlight"><span style="color: var(--shiki-color-text)">      &#125;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      </span><span style="color: var(--shiki-token-function)">generateBundle</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">fs</span><span style="color: var(--shiki-token-function)">.copyFileSync</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.resolve</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;./src/worker.js&#39;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">          </span><span style="color: var(--shiki-token-constant)">path</span><span style="color: var(--shiki-token-function)">.resolve</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;./public/build/worker.js&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">        );</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">      &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">    &#125;</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">  ]</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line dim"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre><!-- HTML_TAG_END --></div> <p data-svelte-h="svelte-1edpr1i">Great! It works! 🎉🎉</p></section> <section data-svelte-h="svelte-yf7767"><h2><a href="#closing-notes" id="closing-notes">Closing Notes</a></h2> <p>After some researching, I wrote simple rollup plugin in 12 lines of code, that copies the worker.js into &quot;build/&quot; folder.</p> <p>This is something custom and specific, and <strong>it works perfectly fine</strong>.</p> <p>So, why would I install a package that has so many files and dependencies, just to do a simple and specific task?</p> <p><strong>Am I going to publish my plugin to npm?</strong></p> <p>No. If you have a similar use case, you are free to copy these 12 lines of code.</p> <p>At the moment, I am having these 12 lines of code in my <code class="inline">rollup.config.js</code> and have no intention to extract it out into its own package.</p> <p><strong>What about DRY? What if you/someone else have the same use case, wouldn&#39;t it great to have it as a package?</strong></p> <p>Sorry. No. Before <strong>DRY (Dont Repeat Yourself)</strong>, there&#39;s <strong>YAGNI (You aren&#39;t gonna need it)</strong>.</p> <p>Abstract code only when you need to.</p></section></article> <div style="height: 1px; width: 100%"></div> </main> <footer class="svelte-1x8iuzz"> </footer> 
			
			<script>
				{
					__sveltekit_1l0zymt = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "https://lihautan.com"
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("https://lihautan.com/_app/immutable/entry/start.BlJDb2XI.js"),
						import("https://lihautan.com/_app/immutable/entry/app.CKbaQt-q.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
