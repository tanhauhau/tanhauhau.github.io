<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="ie=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://twitter.com/lihautan" rel="me" />
		<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#bd93f9" />
		<link rel="apple-touch-icon" sizes="48x48" href="/icon-48x48.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="/icon-256x256.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />
		<link rel="icon" href="/icon-48x48.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			rel="preload"
			href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&family=Noto+Sans+SC:wght@500&display=swap"
			as="style"
			onload="this.rel='stylesheet'"
		/>
		<link
			rel="alternate"
			type="application/rss+xml"
			title="Tan Li Hau&#x27;s RSS Feed"
			href="/rss.xml"
		/>
		<link rel="sitemap" type="application/xml" href="/sitemap.xml" />
		<link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
		<link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6Y89Q69VY"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-Z6Y89Q69VY');
		</script>
		
		<link href="https://lihautan.com/_app/immutable/assets/2.gzLc68w0.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/Links.Wq5uepNt.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/PreloadingIndicator.h5Qebrik.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/code-snippet.oep-AGMM.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/BlogLayout.9UlR0V3c.css" rel="stylesheet">
		<link href="https://lihautan.com/_app/immutable/assets/ldjson.pIBh3uCd.css" rel="stylesheet">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/start.sMHs_51x.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/entry.TlgVV302.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/scheduler.85ImRbsk.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/entry/app.3MNnapNB.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.JMRAb4ib.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/0.OHRWA_yz.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/2.4qHzu_xx.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/stores.EwljHx-e.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/Links.1SNGqlbr.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/each.mrcKafHm.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/index.LtwMzvSK.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/PreloadingIndicator.B8z3iDCH.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/nodes/50.s9GazOqP.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/code-snippet.p32Anx_S.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/BlogLayout.TadBQAnB.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/ldjson.mxRwKhyi.js">
		<link rel="modulepreload" href="https://lihautan.com/_app/immutable/chunks/twitter-card-image.6izpPI6I.js"><title>Yet Another Micro Frontend Proof of Concept | Tan Li Hau</title><!-- HEAD_svelte-1jsbgzp_START --><meta name="description" content="A decentralised router definition"><meta name="image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.GxZuYhTB.jpg"><meta name="og:image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.GxZuYhTB.jpg"><meta name="og:title" content="Yet Another Micro Frontend Proof of Concept"><meta name="og:description" content="A decentralised router definition"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@lihautan"><meta name="twitter:title" content="Yet Another Micro Frontend Proof of Concept"><meta name="twitter:description" content="A decentralised router definition"><meta name="twitter:image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.GxZuYhTB.jpg"><meta itemprop="url" content="https://lihautan.com/micro-frontends-poc"><meta itemprop="image" content="https://lihautan.com/_app/immutable/assets/twitter-card-image.GxZuYhTB.jpg"><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"copyrightYear":"2022","creator":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"publisher":{"@type":"Person","name":"Tan Li Hau","url":"https://lihautan.com/about/"},"description":"A decentralised router definition","headline":"Yet Another Micro Frontend Proof of Concept","name":"Yet Another Micro Frontend Proof of Concept","inLanguage":"en"}</script><!-- HTML_TAG_END --><!-- HTML_TAG_START --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https://lihautan.com/micro-frontends-poc","name":"Yet Another Micro Frontend Proof of Concept"},"name":"Yet Another Micro Frontend Proof of Concept","position":2}]}</script><!-- HTML_TAG_END --><!-- HEAD_svelte-1jsbgzp_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">   <a href="#content" class="skip svelte-1x8iuzz" data-svelte-h="svelte-198b79b">Skip to content</a> <header class="svelte-1x8iuzz"><nav><ul class="mode-sidebar svelte-2qf5mw"><li class="svelte-2qf5mw" data-svelte-h="svelte-1c15i4q"><a href="/" class="svelte-2qf5mw">Tan Li Hau</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-jyiaso"><a data-sveltekit-preload-data href="/about" class="svelte-2qf5mw">About</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-nil8z4"><a data-sveltekit-preload-data href="/blogs" class="svelte-2qf5mw">Writings</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-lr8cqc"><a data-sveltekit-preload-data href="/talks" class="svelte-2qf5mw">Talks</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-1oruudc"><a data-sveltekit-preload-data href="/notes" class="svelte-2qf5mw">Notes</a></li> <li class="desktop svelte-2qf5mw" data-svelte-h="svelte-18xilfe"><a data-sveltekit-preload-data href="/books" class="svelte-2qf5mw">Books</a></li> <li class="social svelte-2qf5mw" data-svelte-h="svelte-1bsaw7m"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
  10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
  4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a> <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-2qf5mw"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-2qf5mw"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
  0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
  5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
  5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
  3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> <a aria-label="YouTube account" href="https://youtube.com/c/lihautan" class="svelte-2qf5mw"><svg viewBox="0 0 461.001 461.001" width="1em" height="1em" class="svelte-2qf5mw"><path d="M365.257 67.393H95.744C42.866 67.393 0 110.259 0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878 0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zm-64.751 169.663-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881c3.748 1.899 3.683 7.274-.109 9.082z"></path></svg></a></li> </ul></nav></header> <div class="sidebar svelte-s9hlkv">  <div class="float svelte-s9hlkv" data-svelte-h="svelte-x1w5me"><svg viewBox="0 0 30 50" width="30" height="50"><circle fill="currentColor" cy="15" cx="15" r="3"></circle><circle fill="currentColor" cy="25" cx="15" r="3"></circle><circle fill="currentColor" cy="35" cx="15" r="3"></circle></svg></div> </div> <main id="content" class="svelte-1x8iuzz"> <h1>Yet Another Micro Frontend Proof of Concept</h1> <div class="date svelte-13b38er">July 15, 2019</div>   <section role="navigation" aria-label="Table of Contents" class="svelte-zmasws"><ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#what-is-this-different" class="svelte-zmasws">What is this different?</a>  </li><li class="svelte-zmasws"><a href="#the-bridge" class="svelte-zmasws">The Bridge</a>  </li><li class="svelte-zmasws"><a href="#the-routing-mechanism" class="svelte-zmasws">The routing mechanism</a>  </li><li class="svelte-zmasws"><a href="#the-global-registry" class="svelte-zmasws">The global registry</a>  </li><li class="svelte-zmasws"><a href="#shared-global-state" class="svelte-zmasws">Shared Global State</a>  </li><li class="svelte-zmasws"><a href="#trying-it-out-locally" class="svelte-zmasws">Trying it out locally</a> <ol class="svelte-zmasws"><li class="svelte-zmasws"><a href="#developing-the-micro-frontend-individually" class="svelte-zmasws">Developing the micro frontend individually</a>  </li> </ol> </li></ol> </section> <article class="blog"><p data-svelte-h="svelte-5sh0nf">Yes, this is <a href="https://github.com/tanhauhau/micro-frontend" rel="nofollow">yet another proof of concept for micro frontend architecture</a>.</p> <p data-svelte-h="svelte-tk73da">Please <a href="https://github.com/tanhauhau/micro-frontend" rel="nofollow">check out the code</a> and try to play with it locally.</p> <section data-svelte-h="svelte-xrygsm"><h2><a href="#what-is-this-different" id="what-is-this-different">What is this different?</a></h2> <ul><li><p><strong>No centralised routing definition</strong></p> <p>Once the main SPA is deployed, new routes can be added to the SPA without redeploying the main SPA.</p></li> <li><p><strong>A central registry</strong></p> <p>Individual micro frontend does not need to bundle in common dependencies like <code class="inline">react</code>, <code class="inline">react-router</code>, eg. Furthermore, they <strong>shouldn&#39;t be</strong> bundled into the micro frontend as multiple instance of <code class="inline">react</code> or <code class="inline">react-router</code> may cause some bugs.</p></li> <li><p><strong>A shared global state</strong></p> <p>In this demo, I am using <a href="https://redux.js.org" rel="nofollow">redux</a> for state management.</p> <p>Each micro-frontend is connected to the same global store, so data is easily shared across the application.</p></li></ul></section> <section data-svelte-h="svelte-1kpefku"><h2><a href="#the-bridge" id="the-bridge">The Bridge</a></h2> <p>The center piece of this micro frontend architecture is <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/Bridge/index.js" rel="nofollow">the Bridge</a>.</p> <p>It contains 2 types of communication method:</p> <ul><li>message passing</li> <li>shared memory</li></ul> <p><strong>Message passing</strong> is done via a pub sub mechanism called <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/Bridge/Channel.js" rel="nofollow">the Channel</a>, whereas <strong>shared memory</strong> is done via <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/Bridge/Registry.js" rel="nofollow">the Registry</a>.</p> <p>I attach the Bridge to the window, so each micro frontend can connect to the bridge.</p></section> <section data-svelte-h="svelte-hol15e"><h2><a href="#the-routing-mechanism" id="the-routing-mechanism">The routing mechanism</a></h2> <p>In the PoC, I used <a href="https://reacttraining.com/react-router/web" rel="nofollow">react-router</a> as the routing library. The <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/App/Routes.js#L17" rel="nofollow">route definition</a> is dynamic, as it listens <code class="inline">&quot;registerRoute&quot;</code> event through <em>the Bridge</em>, and add it to the route definition.</p> <p>One thing to note is that, I use <code class="inline">&lt;Switch /&gt;</code>, which will render the first <code class="inline">&lt;Route /&gt;</code> that matches the url.</p> <p>The magic happens in the last route, which will be rendered when none of the routes in the route definition matches.</p> <p>The last route renders the <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/App/FallbackDiscovery.js" rel="nofollow">Fallback Discovery</a> component, which will based on the current location and some pre-defined rules, tries to find the micro frontend manifest for the unknown route.</p> <p>If the micro frontend manifest does not exist, it will render a 404 page. However, if the manifest exists, it will fetch the manifest file.</p> <p>The micro frontend manifest file is nothing but a json file that contains the <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/App/FallbackDiscovery.js#L31" rel="nofollow">entry asset</a> for the route micro frontend.</p> <p>Once the entry asset is loaded, the new micro frontend itself will register a new route to the route definition via <code class="inline">&quot;registerRoute&quot;</code> event, which has to be the route that matches the current URL.</p> <p>Whenever there&#39;s a new route added, the <code class="inline">react-router</code>&#39;s <code class="inline">&lt;Router /&gt;</code> component will re-render and it will match the newly added route, which renders our newly added micro-frontend.</p></section> <section data-svelte-h="svelte-qhgfj9"><h2><a href="#the-global-registry" id="the-global-registry">The global registry</a></h2> <p>There&#39;s 2 main reasons why I am not bundling <code class="inline">react</code>, <code class="inline">react-redux</code>, and <code class="inline">react-router</code> into each micro frontends:</p> <ul><li><p><strong>Bundle size</strong>, there&#39;s no reason to download duplicate copies of <code class="inline">react</code> or <code class="inline">react-redux</code>.</p></li> <li><p><strong>No multiple instance</strong>, both <code class="inline">react-redux</code> and <code class="inline">react-router</code> uses React Context to pass information down the React component tree. However, this way of data passing disallow multiple instances of the <em>Context</em> object, as each instances has a different memory reference.</p></li></ul> <p>So, the main SPA runtime bundles <code class="inline">react</code>, <code class="inline">react-redux</code>, etc and <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/base/src/initRegistry.js#L9" rel="nofollow">set it into the <code class="inline">Bridge.Registry</code>.</a>.</p> <p>When each micro-frontend is built, the <em>import statement</em> for these modules <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/food/webpack.config.js#L23" rel="nofollow">will be transformed</a> into the <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/build/BridgeAliasPlugin/aliases/react.js" rel="nofollow">some aliases</a>, that reads the module from the <code class="inline">Bridge.Registry</code>.</p></section> <section data-svelte-h="svelte-8x8o42"><h2><a href="#shared-global-state" id="shared-global-state">Shared Global State</a></h2> <p>In the PoC, the micro frontends are <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/food/src/FoodDetail.js#L36" rel="nofollow">connected to the shared global store via <code class="inline">connect()</code> from <code class="inline">react-redux</code></a></p> <p>Interesting to note is that both <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/food/src/FoodDetail.js#L13" rel="nofollow">the food detail</a> and <a href="https://github.com/tanhauhau/micro-frontend/blob/master/packages/foods/src/FoodList.js" rel="nofollow">the food list</a> register the same key for the reducer, but yet both of the works seamlessly.</p> <p>Note that when we transit from Food List page to Food Detail page, we already have the food detail information from the store, therefore there is no need to fetch the food detail anymore.</p></section> <section data-svelte-h="svelte-1tcvc1t"><h2><a href="#trying-it-out-locally" id="trying-it-out-locally">Trying it out locally</a></h2> <p>Run <code class="inline">yarn start</code> in the root folder, which will <a href="https://github.com/tanhauhau/micro-frontend/blob/master/scripts/start-dev-server.js" rel="nofollow">start a simple express server</a>. The express server is used to serve static files based on specific rules.</p> <p>To build individual micro frontends, you need to go to each folder and run <code class="inline">yarn build</code>. Alternatively, you can start the watch mode via <code class="inline">yarn dev</code>.</p></section> <section data-svelte-h="svelte-jyrsaq"><h3><a href="#developing-the-micro-frontend-individually" id="developing-the-micro-frontend-individually">Developing the micro frontend individually</a></h3> <p>WIP</p></section></article> <div style="height: 1px; width: 100%"></div> </main> <footer class="svelte-1x8iuzz"> </footer> 
			
			<script>
				{
					__sveltekit_1rt3a46 = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "https://lihautan.com"
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("https://lihautan.com/_app/immutable/entry/start.sMHs_51x.js"),
						import("https://lihautan.com/_app/immutable/entry/app.3MNnapNB.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 50],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
