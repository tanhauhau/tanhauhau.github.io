{"componentChunkName":"component---src-templates-blog-post-js","path":"/12-line-rollup-plugin/","webpackCompilationHash":"60f7464847d090e4e791","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau"}},"markdownRemark":{"id":"e9d98e62-8bd1-5838-9270-a87ce81de154","excerpt":"","html":"<h2 id=\"background\"><a href=\"#background\" aria-label=\"background permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Background</h2>\n<p>I was building a web application using <a href=\"http://svelte.dev/\">Svelte</a> and <a href=\"https://rollupjs.org/guide/en/\">Rollup</a> this morning. I needed to use a <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\">web worker</a>, which the worker script has to be in another file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/build/worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So naturally, I was thinking of having 2 entries for my rollup application: <em>the main app</em> and <em>the worker</em>.</p>\n<p>It works fine, except the fact that the <a href=\"https://www.npmjs.com/package/rollup-plugin-livereload\">rollup-plugin-livereload</a> injected a livereload script to every output file:</p>\n<p class=\"filename\">/build/worker.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'livereloadscript'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> r <span class=\"token operator\">=</span> l<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> r<span class=\"token punctuation\">.</span><span class=\"token keyword\">async</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> r<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'//'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>host <span class=\"token operator\">||</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">':35729/livereload.js?snipver=1'</span><span class=\"token punctuation\">;</span> r<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token string\">'livereloadscript'</span><span class=\"token punctuation\">;</span> l<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// worker code ...</span></code></pre></div>\n<p>The livereload script includes a reference to <code class=\"language-text\">window</code>, which is not available to the worker script:</p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/b70f409cb0f800a56ece98c2cbc5071c/2232e/window-reference-error.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.30640668523677%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdklEQVQI1yWMywqDQBRD/f8/U6cqiiJVrJuZ8bFwV2iv7em1dxFITkKSp7vxrmukKJA8R7ru78+mMXZ1w2ByzvI0IW2L9D1SlrpTzTNyHCTfGGHbYBx56fk9y3ikKbGq8Hr48d76VeUDXPt9h2VRtloOwZge/gAZ45M1hHQl3wAAAABJRU5ErkJggg==&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"window reference error\" title=\"window is not defined\" src=\"/static/b70f409cb0f800a56ece98c2cbc5071c/623ee/window-reference-error.png\" srcset=\"/static/b70f409cb0f800a56ece98c2cbc5071c/816c5/window-reference-error.png 148w, /static/b70f409cb0f800a56ece98c2cbc5071c/c766b/window-reference-error.png 295w, /static/b70f409cb0f800a56ece98c2cbc5071c/623ee/window-reference-error.png 590w, /static/b70f409cb0f800a56ece98c2cbc5071c/2232e/window-reference-error.png 718w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>window is not defined</figcaption></figure>\n  \n  </a>\n    </p>\n<p>I looked into <a href=\"https://www.npmjs.com/package/rollup-plugin-livereload\">the docs of the rollup-plugin-livereload</a>, it doesnâ€™t seemed to have a option to exclude files from adding the <em>livereload script</em>.</p>\n<p>At this point, I was thinking to myself, <em>â€œI just need to copy the worker.js into the â€˜build/â€™ folder, I donâ€™t need anything else, how hard can that be?â€</em></p>\n<p>It turns out harder than I imagined. <span class=\"emoji\">ğŸ¤®</span></p>\n<h2 id=\"need-something-install-a-plugin\"><a href=\"#need-something-install-a-plugin\" aria-label=\"need something install a plugin permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Need something? Install a plugin!</h2>\n<p>In todays JavaScript landscape, thereâ€™s a <em>â€œnode_moduleâ€</em> for everything.</p>\n<p>So I <a href=\"https://www.google.com/search?q=rollup+plugin+copy+files\">googled</a> <em>â€œrollup plugin copy filesâ€</em>, without a suprise, there are multiple rollup plugins published to npm:</p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/aebafa83426227cc9c3de65a779be923/78dc5/google%20search.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.06837606837607%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRklEQVQ4y5VUiZacIBCc//+4HLPZze7cjheCgieKqJWGjJOdvGxe4nttNyBldXXDZlkWtF2HqqpQNw3qukFD3s07m2dn8y2e73Pr+jhO6PoJxs4AFmzoja5tkOcCSkpUpURZlm7ab1ifd+HD2jJN6AcLwr0BOobDBG0BqYHagP46EuMa1k6o6holsdd9D6VKv+YymAhoGAb/nTEDxb3/wcbRj/IOSUEb6UNVtyRBi6qp0bStBzCj8QCrt9b69F3s1p135lj7lMfWYCgHaNVDk+8bGjcjRkf7P5474OmUYPv1gOftCd+ejjjsQ+x3VxyCK/JWIixSpCVHojJo098L5FithVrNA8paIc0ZiqpAlEVggnmLWISYJbhEAbKc4xKS5xwlael0dOa6w4E+MJRKIk4SsCxDFMe0KQMXHBmNWcZwvYYQXPjNTr+VzUO1b94DWj2TjiR6Y31sWuvjeVgwDfNfNfvde8DjPsKXTztsPx/wRFq+PgV42Z7x8nrC6RgjUikiybyGYZGgJx2p5R60+wVIcWc7KF2iHiowxSAqTmOJjABEKZDwlIwhzhKkpG1eFL753wM9pNxLC81HdNxAixE6N2jSAaakUyBH6quP0/1j21zChNI74m13wfPbAbv9Bd8p3ef9HsdziF14xplfEYgIJxYgJeZ2JJ2N8bYW6s6QS4EgviJMI/IBBI2LsgCjVpKVRErpplRtXghqpwwFdYWruEtbKYWOLpcHwLZp6WJQdEEU/mx2nYbWPfp++OnJlnn5p5PyA6CxhpexuEcjAAAAAElFTkSuQmCC&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"google search\" title=\"Google result for \" rollup=\"\" plugin=\"\" copy=\"\" files&#x22;&#x22;=\"\" src=\"/static/aebafa83426227cc9c3de65a779be923/623ee/google%20search.png\" srcset=\"/static/aebafa83426227cc9c3de65a779be923/816c5/google%20search.png 148w, /static/aebafa83426227cc9c3de65a779be923/c766b/google%20search.png 295w, /static/aebafa83426227cc9c3de65a779be923/623ee/google%20search.png 590w, /static/aebafa83426227cc9c3de65a779be923/e5345/google%20search.png 885w, /static/aebafa83426227cc9c3de65a779be923/7a439/google%20search.png 1180w, /static/aebafa83426227cc9c3de65a779be923/78dc5/google%20search.png 1404w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>Google result for \"rollup plugin copy files\"</figcaption></figure>\n  \n  </a>\n    </p>\n<p>So I decided to install the first plugin, because it has the highest weekly downloads:</p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/166384ba54e016b033d0672f6d0dcb9d/193f7/rollup-plugin-copy%20usage.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 132.23350253807106%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABYlAAAWJQFJUiTwAAACRklEQVRIx51ViXbaMBD0//9S+gm8lCvQx6PQGMplYzCn76lmFYFQDCFd3rDGkla7swdeWZYIggCz2QxpmoJSVdVDPBKPG06nk+BZ4Rk64oLvvaIoxBj1fD7H4XBAHMdYr9fiOfVyuRS93W7lOc/zm0jsZ4+WkyQRgzTGsPn7fD7jeDzKZfv9XjTXdrud7L3xsrI8NAu2/jpkh+eSZ/Q58ZCerFYrCYdhE0yS7/sXbvVFlXzMYVuUGRT5R8hxvEUUrZWRv8YHC/q3jkAjS4A4qLBdAdEMmP8GRk0gOSoPSbDvTzEcjtBpvyn31W3FFTQUzYH3LuC/GVR4V1qg3k9+Acs/QK6qztPuVoro6uK69uSqGcrpmCJNcuRZebnI5lS/+6jDMAwUfwuVwbgmZH1QUzJTGd/dcOrCYylMp1OMRiNJznXzNZuU19efmEwmMBHptc+QpDCTrEG3YO3CZVE/05qe21L32so1dLf1+GVqkJqwPTVi9iwWC+GS7enukcLOskz6lAs0RLibeHsURaLNHuP1p2lDg/ZtddDFHzsJe4JD2yOXm7rx5XJ5mTacIAQzaUrHFa5vNhvBbX/XDFgzsQnDlTvrxuOxDA3WLBPEEVYXunDYaDTQbDbR7XbR7/fR6/XA90aKIsfLjxe0Wi10Oh20222ZmbVZNpmrq8dH/yM2jzce8ovT2UxodgzDcTe7SbibZS6GYSjcmcK2vfiuyHAg4cPhUPgZDAbCIbn8HxEPzT8dy4bP9Nh0T13P3sPdwn6UnK/wD/sb8/HvmQQxAAAAAElFTkSuQmCC&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"rollup-plugin-copy weekly downloads\" title=\"17K weekly downloads\" src=\"/static/166384ba54e016b033d0672f6d0dcb9d/623ee/rollup-plugin-copy%20usage.png\" srcset=\"/static/166384ba54e016b033d0672f6d0dcb9d/816c5/rollup-plugin-copy%20usage.png 148w, /static/166384ba54e016b033d0672f6d0dcb9d/c766b/rollup-plugin-copy%20usage.png 295w, /static/166384ba54e016b033d0672f6d0dcb9d/623ee/rollup-plugin-copy%20usage.png 590w, /static/166384ba54e016b033d0672f6d0dcb9d/193f7/rollup-plugin-copy%20usage.png 788w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>17K weekly downloads</figcaption></figure>\n  \n  </a>\n    </p>\n<p>When I installed the plugin, I realise I was installing much more than I needed:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1749d330dd8aadfa4e61f44da2731189/d0798/dependencies.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 161.9834710743802%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAABYlAAAWJQFJUiTwAAACjUlEQVRIx6WW6Y6iUBCFcRcEcUNBQdx3E9//5Wr8alKd7owjQv+ooMR77lnq1tVxIke0Eke8kSfbzVayLJPRaCSz2UziONY6Ho+y3++15vO5LBYLqdVq4jjOz+pFibiTWCaLSPJ1Llma6YLz+SyHw0GffN9sNtJsNqXT6Ui73db6B4wK/FB8vy/pPJXVaiVJkigjmPDkHexgOx6PFfQlkFW3NxDXH8vsuTjLUmUCs+v1qrK2260yhJnv+69l/mAYRhKOnmDLpaTpQhkBkqapLJ/v2ABmQRCI67pabwEHg1CSeKaMkAkI8qIoUoan00lBd7udTKdT8TyvCHCgXt3vdwUkYSQCCtDlcvlKutvtvgczQIIgTQBgCDMkr9drDYQNkP0RYL/fVykwASDPcwXDS+TyZINGo1EMZoDIw0MAYYN/SIfx4/H4YliYMDUcDpUhkkkXyQDfbjfdaDKZfAb03UMWWiiwMu+Qz9N8LWwZY8i5BQjv7JziHxsBRhj1ev0zpoBxAjAfRgDACg/5HIbh53L1pDxPALJZDAhyYUffEU4psO+SkUnBjkD4jPzCYfAKkNYhYXykCAd2vP/vmHrnIT7hH0kjGXalvbNiIaEAiIcwtR7kSFYC5BQwAylYWvswAyuFQso2HGCHDZweeq8SIJIBhBmgtI2xrATIecU7hqglDMNKoSAXUBgSDIAwtMldum04KYRiw9UmDYkju3IfAmTN/atetFDwD4b2zwB2sKfwmN/wufAo2rSBkV0BAOMp79iA64HfEVar1Sq+Arga7T6mmDQAA0hopRrcJNtfDlgSCO8ZqFxOpRo8CHq6GGawomCITI6h+fcxYDxui+e2nrfe3xlIQyOTkGBaNuU/HGTgTEGgn+4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"rollup-plugin-copy dependencies\"\n        title=\"\"\n        src=\"/static/1749d330dd8aadfa4e61f44da2731189/623ee/dependencies.png\"\n        srcset=\"/static/1749d330dd8aadfa4e61f44da2731189/816c5/dependencies.png 148w,\n/static/1749d330dd8aadfa4e61f44da2731189/c766b/dependencies.png 295w,\n/static/1749d330dd8aadfa4e61f44da2731189/623ee/dependencies.png 590w,\n/static/1749d330dd8aadfa4e61f44da2731189/d0798/dependencies.png 726w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Remember, my use case is simple:</p>\n<blockquote>\n<p><strong>I just need to copy the worker.js into the â€˜build/â€™ folder.</strong></p>\n</blockquote>\n<p>I <em>donâ€™t need any bells and whistles</em> this plugin is providing me. <span class=\"emoji\">ğŸ™ˆ</span></p>\n<p>So I uninstalled the plugin, thinking:</p>\n<blockquote>\n<p>How hard is it to <strong>write a plugin</strong> that <strong>just</strong> copy the worker.js into the â€˜build/â€™ folder?</p>\n</blockquote>\n<h2 id=\"writing-a-rollup-plugin\"><a href=\"#writing-a-rollup-plugin\" aria-label=\"writing a rollup plugin permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Writing a Rollup plugin</h2>\n<p>Senpai once told me, <em>â€œwriting rollup plugins is very straightforward,â€</em>, yet, no one told me how to get started writing it.</p>\n<p>So, I dug into <code class=\"language-text\">node_modules/</code>, and start skimming through the rollup plugins I have installed: <a href=\"https://github.com/sveltejs/rollup-plugin-svelte\">rollup-plugin-svelte</a>, <a href=\"https://github.com/rollup/rollup-plugin-node-resolve\">rollup-plugin-node-resolve</a>, <a href=\"https://github.com/TrySound/rollup-plugin-terser\">rollup-plugin-terser</a>, â€¦</p>\n<p>And I noticed a common pattern:</p>\n<p class=\"filename\">rollup-plugin-xxx.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">'plugin-name'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">resolveId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">generateBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So I guess, this is the general structure of a rollup plugin:</p>\n<ul>\n<li>Itâ€™s an object, â€¦</li>\n<li>with a property called <code class=\"language-text\">name</code> for the name of the plugin,</li>\n<li>and functions like <em>â€œloadâ€</em>, <em>â€œloadâ€</em>, â€¦ that would be called by rollup when the time is right <span class=\"emoji\">ğŸ¤”</span></li>\n</ul>\n<p>OK. I know what I need, I need to copy my <code class=\"language-text\">worker.js</code> when rollup is generating a bundle:</p>\n<p class=\"filename\">rollup.config.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'copy-worker'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">generateBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        fs<span class=\"token punctuation\">.</span><span class=\"token function\">copyFileSync</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">          path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/build/worker.js'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Great! It works! <span class=\"emoji\">ğŸ˜</span></p>\n<p>But, when I change the <code class=\"language-text\">worker.js</code> file, the <code class=\"language-text\">build/worker.js</code> is not updated. <span class=\"emoji\">ğŸ˜</span></p>\n<p>Thatâ€™s because the <code class=\"language-text\">worker.js</code> is not watched!</p>\n<p>After much googling, I ended up reading through the official docs of <a href=\"https://rollupjs.org/guide/en/#plugin-development\">Rollup</a>.</p>\n<p>I learned that the functions like <em>â€œloadâ€</em>, <em>â€œgenerateBundleâ€</em>, â€¦ are called <a href=\"https://rollupjs.org/guide/en/#hooks\">â€œhooksâ€</a>, and the docs explained when these hooks will be called, the arguments and the expected return value.</p>\n<p>In the docs, I found <a href=\"https://rollupjs.org/guide/en/#thisaddwatchfileid-string--void\"><code class=\"language-text\">this.addWatchFile(id: string)</code></a> under <a href=\"https://rollupjs.org/guide/en/#plugin-context\">plugin context</a>, which according to the docs,</p>\n<blockquote>\n<p>[â€¦] can be used to add additional files to be monitored by watch mode.</p>\n</blockquote>\n<p>Sounds exactly what I am looking for! <span class=\"emoji\">ğŸ˜</span></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'copy-worker'</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addWatchFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span>      <span class=\"token function\">generateBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        fs<span class=\"token punctuation\">.</span><span class=\"token function\">copyFileSync</span><span class=\"token punctuation\">(</span>\n          path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/build/worker.js'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Great! It works! <span class=\"emoji\">ğŸ‰</span><span class=\"emoji\">ğŸ‰</span></p>\n<h2 id=\"closing-notes\"><a href=\"#closing-notes\" aria-label=\"closing notes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Closing Notes</h2>\n<p>After some researching, I wrote simple rollup plugin in 12 lines of code, that copies the worker.js into â€œbuild/â€ folder.</p>\n<p>This is something custom and specific, and <strong>it works perfectly fine</strong>.</p>\n<p>So, why would I install a package that has so many files and dependencies, just to do a simple and specific task?</p>\n<p><strong>Am I going to publish my plugin to npm?</strong></p>\n<p>No. If you have a similar use case, you are free to copy these 12 lines of code.</p>\n<p>At the moment, I am having these 12 lines of code in my <code class=\"language-text\">rollup.config.js</code> and have no intention to extract it out into its own package.</p>\n<p><strong>What about DRY? What if you/someone else have the same use case, wouldnâ€™t it great to have it as a package?</strong></p>\n<p>Sorry. No. Before <strong>DRY (Dont Repeat Yourself)</strong>, thereâ€™s <strong>YAGNI (You arenâ€™t gonna need it)</strong>.</p>\n<p>Abstract code only when you need to.</p>","fields":{"slug":"/12-line-rollup-plugin/","wip":false},"frontmatter":{"title":"I wrote a 12-line Rollup plugin","date":"November 30, 2019","lastUpdated":null,"description":"Why would I install a package with so many files and dependencies, just to do a something simple that can be done in 12 lines of code?","tags":"JavaScript,rollup,plugin"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/12-line-rollup-plugin/","type":"blog","noteDate":null,"noteTitle":null,"wip":false,"heroImageUrl":null,"heroTwitterImageUrl":"/static/hero-twitter-90e763067d2dff493c9c25a186a01060.jpg","previous":{"id":"15b35b51-ab30-5266-9017-0b598f1a726c","fields":{"slug":"/manipulating-ast-with-javascript/","type":"blog","noteDate":null,"noteTitle":null,"wip":false},"frontmatter":{"title":"Manipulating AST with JavaScript"}},"next":null}}}